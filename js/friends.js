function URLbase64Encode(a){if(["uf4te.cn","github.com","gitee.com","tencent.com","aliyun.com","csdn.net","juejin.cn","jianshu.com","cnblogs.com","zhihu.com","bilibili.com","feishu.cn","yuque.com","kdocs.cn","microsoft.com","52pojie.cn","kanxue.com","anquanke.com","freebuf.com","sec-wiki.com","qq.com","163.com","hexo.io","nodejs.org","butterfly.js.org"].some((t=>a.includes(t))))return a;const t=(new TextEncoder).encode(a);let e="";return t.forEach((a=>{e+=String.fromCharCode(a)})),"https://www.uf4te.cn/go.html?target="+window.btoa(e)}var fdata={jsonurl:"",apiurl:"https://friends.uf4te.cn/",apipublieurl:"https://fcircle-pub.rct.cool/",initnumber:20,stepnumber:10,article_sort:"created",error_img:"/img/404/loading_404.gif"};if("undefined"!=typeof fdataUser)for(var key in fdataUser)fdataUser[key]&&(fdata[key]=fdataUser[key]);var article_num="",sortNow="",UrlNow="",friends_num="",container=document.getElementById("cf-container")||document.getElementById("fcircleContainer"),localSortNow=localStorage.getItem("sortNow"),localUrlNow=sessionStorage.getItem("urlNow");function loadStatistical(a){article_num=a.article_num,friends_num=a.friends_num,container.innerHTML="";var t=`\n    <div id="cf-state" class="cf-new-add">\n      <div class="cf-state-data">\n        <div class="cf-data-friends">\n          <span class="cf-label">订阅</span>\n          <span class="cf-message">${a.friends_num}</span>\n        </div>\n        <div class="cf-data-active">\n          <span class="cf-label">活跃</span>\n          <span class="cf-message">${a.active_num}</span>\n        </div>\n        <div class="cf-data-article">\n          <span class="cf-label">日志</span>\n          <span class="cf-message">${a.article_num}</span>\n        </div>\n      </div>\n      <div id="cf-changeandclear">\n          <span id="cf-change-egg" onclick="changeEgg()" title="本地文章库与公共文章库切换"><i class="fa-solid fa-plane-departure"></i> 切换资源 </span> | <span id="cf-clear-local" onclick="clearLocal()" title="刷新朋友圈缓存"><i class="fa-solid fa-arrows-rotate"></i> 刷新缓存</span>\n      </div>\n      <div id="cf-change">\n          <span id="cf-change-created" data-sort="created" onclick="changeSort(event)" class="${"created"==sortNow?"cf-change-now":""}" title="按创建时间排序"><i class="fa-solid fa-pen-to-square"></i> 创建时间 </span> | <span id="cf-change-updated" data-sort="updated" onclick="changeSort(event)" class="${"updated"==sortNow?"cf-change-now":""}" title="按更新时间排序"><i class="fa-solid fa-clock"></i> 更新时间 </span>\n      </div>\n    </div>\n    `,e=`\n      <div id="cf-more" class="cf-new-add" onclick="loadNextArticle()"><i class="fas fa-angle-double-down"></i></div>\n      <div id="cf-footer" class="cf-new-add">\n       <span id="cf-version-up" onclick="checkVersion()"></span>\n       <span class="cf-data-lastupdated">更新于：${a.last_updated_time}</span>\n        Powered by <a target="_blank" href="https://github.com/Rock-Candy-Tea/hexo-circle-of-friends" target="_blank">FriendCircle</a>\n      </div>\n      <div id="cf-overlay" class="cf-new-add" onclick="closeShow()"></div>\n      <div id="cf-overshow" class="cf-new-add"></div>\n    `;container&&(container.insertAdjacentHTML("beforebegin",t),container.insertAdjacentHTML("afterend",e))}function loadArticleItem(a,t,e){var l="",r=e;if(e>article_num&&(r=article_num),t<article_num){for(var n=t;n<r;n++){var o=a[n];if(o&&o.link){var c=URLbase64Encode(extractDomainFromUrl(o.link));l+=`\n          <div class="cf-article">\n            <a class="cf-article-title" href="${URLbase64Encode(o.link)}" target="_blank" rel="noopener nofollow" data-title="${o.title}" title="前往查看这篇文章">${o.title}</a>\n            <span class="cf-article-floor">${o.floor}</span>\n            <div class="cf-article-avatar no-lightbox flink-item-icon">\n              <a href="${c}" title="访问该用户的主页" target="_blank" rel="noopener nofollow">\n                <img class="cf-img-avatar avatar" src="${o.avatar}" alt="avatar" onerror="this.src='${fdata.error_img}'; this.onerror = null;">\n              </a>\n              <a target="_blank" rel="noopener nofollow" href="${c}" title="访问该用户的主页"><span class="cf-article-author">${o.author}</span></a>\n              <span class="cf-article-time">\n                <span class="cf-time-created" style="${"created"==sortNow?"":"display:none"}"><i class="iconfont icon-calendar">发表于</i>${o.created}</span>\n                <span class="cf-time-updated" style="${"updated"==sortNow?"":"display:none"}"><i class="iconfont icon-gengxinshijian1">更新于</i>${o.updated}</span>\n              </span>\n            </div>\n          </div>\n          `}}container.insertAdjacentHTML("beforeend",l),fetchNextArticle()}else document.getElementById("cf-more").outerHTML='<div id="cf-more" class="cf-new-add" onclick="loadNoArticle()"><small>一切皆有尽头！</small></div>'}function fetchNextArticle(){var start=document.getElementsByClassName("cf-article").length,end=start+fdata.stepnumber,articleNum=article_num;if(end>articleNum&&(end=articleNum),start<articleNum){UrlNow=sessionStorage.getItem("urlNow");var fetchUrl=UrlNow+"rule="+sortNow+"&start="+start+"&end="+end;fetch(fetchUrl).then((a=>a.json())).then((json=>{var nextArticle=eval(json.article_data);localStorage.setItem("nextArticle",JSON.stringify(nextArticle))}))}else(start=articleNum)&&(document.getElementById("cf-more").outerHTML='<div id="cf-more" class="cf-new-add" onclick="loadNoArticle()"><small>一切皆有尽头！</small></div>')}function loadNextArticle(){for(var a=JSON.parse(localStorage.getItem("nextArticle")),t="",e=0;e<a.length;e++){var l=a[e];if(l&&l.link){var r=URLbase64Encode(extractDomainFromUrl(l.link));t+=`\n          <div class="cf-article">\n            <a class="cf-article-title" href="${URLbase64Encode(l.link)}" target="_blank" rel="noopener nofollow" data-title="${l.title}" title="前往查看这篇文章">${l.title}</a>\n            <span class="cf-article-floor">${l.floor}</span>\n            <div class="cf-article-avatar no-lightbox flink-item-icon">\n              <img class="cf-img-avatar avatar" src="${l.avatar}" alt="avatar" onerror="this.src='${fdata.error_img}'; this.onerror = null;">\n              <a target="_blank" rel="noopener" href="${r}" title="访问文章作者的主页"><span class="cf-article-author">${l.author}</span></a>\n              <span class="cf-article-time">\n                <span class="cf-time-created" style="${"created"==sortNow?"":"display:none"}"><i class="far fa-calendar-alt">发表于</i>${l.created}</span>\n                <span class="cf-time-updated" style="${"updated"==sortNow?"":"display:none"}"><i class="fas fa-history">更新于</i>${l.updated}</span>\n              </span>\n            </div>\n          </div>\n          `}}container.insertAdjacentHTML("beforeend",t),fetchNextArticle()}function loadNoArticle(){var a=sortNow+"ArticleData";localStorage.removeItem(a),localStorage.removeItem("statisticalData"),document.getElementById("cf-more").remove(),window.scrollTo(0,document.getElementsByClassName("cf-state").offsetTop)}function clearLocal(){localStorage.removeItem("updatedArticleData"),localStorage.removeItem("createdArticleData"),localStorage.removeItem("nextArticle"),localStorage.removeItem("statisticalData"),localStorage.removeItem("sortNow"),sessionStorage.removeItem("urlNow"),location.reload()}function checkVersion(){var a=fdata.apiurl+"version";fetch(a).then((a=>a.json())).then((a=>{var t=a.status,e=a.current_version,l=a.latest_version,r=document.getElementById("cf-version-up");r.innerHTML=0==t?"当前版本：v"+e:1==t?"发现新版本：v"+e+" ↦ "+l:"网络错误，检测失败！"}))}function changeEgg(){if(fdata.jsonurl||fdata.apiurl){document.querySelectorAll(".cf-new-add").forEach((a=>a.remove())),localStorage.removeItem("updatedArticleData"),localStorage.removeItem("createdArticleData"),localStorage.removeItem("nextArticle"),localStorage.removeItem("statisticalData"),container.innerHTML="与主机通讯中……",UrlNow=sessionStorage.getItem("urlNow");var a=fdata.apipublieurl+"all?";UrlNow!==a?changeUrl=fdata.apipublieurl+"all?":fdata.jsonurl?changeUrl=fdata.apipublieurl+"postjson?jsonlink="+fdata.jsonurl+"&":fdata.apiurl&&(changeUrl=fdata.apiurl+"all?"),sessionStorage.setItem("urlNow",changeUrl),FetchFriendCircle(sortNow,changeUrl)}else clearLocal()}function FetchFriendCircle(sortNow,changeUrl){var end=fdata.initnumber,fetchUrl=UrlNow+"rule="+sortNow+"&start=0&end="+end;changeUrl&&(fetchUrl=changeUrl+"rule="+sortNow+"&start=0&end="+end),fetch(fetchUrl).then((a=>a.json())).then((json=>{var statisticalData=json.statistical_data,articleData=eval(json.article_data),articleSortData=sortNow+"ArticleData";loadStatistical(statisticalData),loadArticleItem(articleData,0,end),localStorage.setItem("statisticalData",JSON.stringify(statisticalData)),localStorage.setItem(articleSortData,JSON.stringify(articleData))}))}function changeSort(a){sortNow=a.currentTarget.dataset.sort,localStorage.setItem("sortNow",sortNow),document.querySelectorAll(".cf-new-add").forEach((a=>a.remove())),container.innerHTML="",changeUrl=sessionStorage.getItem("urlNow"),initFriendCircle(sortNow,changeUrl),fdata.apiurl&&checkVersion()}function closeShow(){document.getElementById("cf-overlay").className-="cf-show-now",document.getElementById("cf-overshow").className-="cf-show-now",document.getElementById("cf-overshow").innerHTML=""}function initFriendCircle(sortNow,changeUrl){var articleSortData=sortNow+"ArticleData",localStatisticalData=JSON.parse(localStorage.getItem("statisticalData")),localArticleData=JSON.parse(localStorage.getItem(articleSortData));if(container.innerHTML="与主机通讯中……",localStatisticalData&&localArticleData){loadStatistical(localStatisticalData),loadArticleItem(localArticleData,0,fdata.initnumber);var fetchUrl=UrlNow+"rule="+sortNow+"&start=0&end="+fdata.initnumber;fetch(fetchUrl).then((a=>a.json())).then((json=>{var statisticalData=json.statistical_data,articleData=eval(json.article_data),localSnum=localStatisticalData.article_num,newSnum=statisticalData.article_num,localAtile=localArticleData[0].title,newAtile=articleData[0].title;if(localSnum!==newSnum||localAtile!==newAtile){document.getElementById("cf-state").remove(),document.getElementById("cf-more").remove(),document.getElementById("cf-footer").remove(),container.innerHTML="与主机通讯中……";var articleSortData=sortNow+"ArticleData";loadStatistical(statisticalData),loadArticleItem(articleData,0,fdata.initnumber),localStorage.setItem("statisticalData",JSON.stringify(statisticalData)),localStorage.setItem(articleSortData,JSON.stringify(articleData))}}))}else FetchFriendCircle(sortNow,changeUrl)}function extractDomainFromUrl(a){for(var t=-1,e=0,l=0;e<a.length;e++)if("/"===a[e]&&3===++l){t=e;break}return-1!==t?a.substring(0,t):a}localSortNow&&localUrlNow?(sortNow=localSortNow,UrlNow=localUrlNow):(sortNow=fdata.article_sort,UrlNow=fdata.jsonurl?fdata.apipublieurl+"postjson?jsonlink="+fdata.jsonurl+"&":fdata.apiurl?fdata.apiurl+"all?":fdata.apipublieurl+"all?",sessionStorage.setItem("urlNow",UrlNow),localStorage.setItem("sortNow",sortNow)),initFriendCircle(sortNow);